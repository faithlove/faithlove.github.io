<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kaithmy&#39;s blog</title>
  <subtitle>你看见过我的小熊吗</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://faithlove.github.io/"/>
  <updated>2018-08-08T10:28:11.303Z</updated>
  <id>https://faithlove.github.io/</id>
  
  <author>
    <name>Kaithmy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Github停用TLS 1.0和TLS 1.1引起的血案</title>
    <link href="https://faithlove.github.io/2018/08/06/Github%E5%81%9C%E7%94%A8TLS-1-0%E5%92%8CTLS-1-1%E5%BC%95%E8%B5%B7%E7%9A%84%E8%A1%80%E6%A1%88/"/>
    <id>https://faithlove.github.io/2018/08/06/Github停用TLS-1-0和TLS-1-1引起的血案/</id>
    <published>2018-08-06T07:11:40.000Z</published>
    <updated>2018-08-08T10:28:11.303Z</updated>
    
    <content type="html"><![CDATA[<p>本想整理一下之前的笔记写成文章发上来，但是新项目赶着上线，各种奇葩问题频出，也就暂时搁置了。好不容易写了抽空写了一篇居然发不上来，<code>deploy</code>的时候老是提示<code>SSL Exception</code>啥的，于是搜了一下解决方案，大多数都是说要加大<code>git</code>的<code>size</code>，其实和<code>git</code>的<code>size</code>无关，这是由于Github最近停用了TLS 1.0和v 1.1导致的。</p>
<h3 id="我们停用TLSv1-TLSv1-1啦"><a href="#我们停用TLSv1-TLSv1-1啦" class="headerlink" title="我们停用TLSv1/TLSv1.1啦"></a>我们停用TLSv1/TLSv1.1啦</h3><p>以下是<a href="https://githubengineering.com/crypto-removal-notice/" target="_blank" rel="noopener">原文</a><br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Last year we announced the deprecation of several weak cryptographic standards. Then we provided a status update toward the end of last year outlining some changes we’d made to make the transition easier for clients. We quickly approached the February 1, 2018 cutoff date we mentioned in previous posts and, as a result, pushed back our schedule by one week. On February 8, 2018 we’ll start disabling the following:</span><br><span class="line"></span><br><span class="line">TLSv1/TLSv1.1: This applies to all HTTPS connections, including web, API, and git connections to https://github.com and https://api.github.com.</span><br><span class="line">diffie-hellman-group1-sha1: This applies to all SSH connections to github.com</span><br><span class="line">diffie-hellman-group14-sha1: This applies to all SSH connections to github.com</span><br><span class="line">We’ll disable the algorithms in two stages:</span><br><span class="line"></span><br><span class="line">February 8, 2018 19:00 UTC (11:00 am PST): Disable deprecated algorithms for one hour</span><br><span class="line">February 22, 2018 19:00 UTC (11:00 am PST): Permanently disable deprecated algorithms</span><br><span class="line">While only a small fraction of traffic currently makes use of the deprecated algorithms, and many clients will automatically transition and start using the new algorithms, there is invariably going to be a small fraction of clients that will be impacted. We expect most of these are older systems that are no longer maintained, but continue to access Git/the GitHub API using the deprecated algorithms. To help mitigate this, we will temporarily disable support for the deprecated algorithms for one hour on February 8, 2018 19::00 UTC. By disabling support for the deprecated algorithms for a small window, these systems will temporarily fail to connect to GitHub. We will then restore support for the deprecated algorithms and provide a two week grace period for these systems to upgrade their libraries before we disable support for the deprecated algorithms permanently on February 22, 2018.</span><br><span class="line"></span><br><span class="line">Known incompatible clients</span><br><span class="line">As noted above, the vast majority of traffic should be unaffected by this change. However, there are a few remaining clients that we anticipate will be affected. Fortunately, the majority of clients can be updated to work with TLSv1.2.</span><br><span class="line"></span><br><span class="line">Git-Credential-Manager-for-Windows &lt; v1.14.0</span><br><span class="line">Git-Credential-Manager-for-Windows &lt; v1.14.0 does not support TLSv1.2. This can be addressed by updating to v1.14.0.</span><br><span class="line"></span><br><span class="line">Git on Red Hat 5, &lt; 6.8, and &lt; 7.2</span><br><span class="line">Red Hat 5, 6, and 7 shipped with Git clients that did not support TLSv1.2. This can be addressed by updating to versions 6.8 and 7.2 (or greater) respectively. Unfortunately, Red Hat 5 does not have a point release that supports TLSv1.2. We advise that users of Red Hat 5 upgrade to a newer version of the operating system.</span><br><span class="line"></span><br><span class="line">Java releases &lt; JDK 8</span><br><span class="line">As noted in this blog post by Oracle, TLSv1 was used by default for JDK releases prior to JDK 8. JDK 8 changed this behavior and defaults to TLSv1.2. Any client (ex. JGit is one such popular client) that runs on older versions of the JDK is affected. This can be addressed by updating to JDK &gt;= 8 or explicitly opting in to TLSv1.2 in JDK 7 (look at the https.protocols JSSE tuning parameter). Unfortunately, versions of the JDK &lt;= 6 do not support TLSv1.2. We advise users of JDK &lt;= 6 to upgrade to a newer version of the JDK.</span><br><span class="line"></span><br><span class="line">Visual Studio</span><br><span class="line">Visual Studio ships with specific versions of Git for Windows and the Git Credential Manager for Windows (GCM). Microsoft has updated the latest versions of Visual Studio 2017 to work with TLSv1.2 Git servers. We advise users of Visual Studio to upgrade to the latest release by clicking on the in-product notification flag or by checking for an update directly from the IDE. Microsoft has provided additional guidance on the Visual Studio developer community support forum.</span><br><span class="line"></span><br><span class="line">Conclusion</span><br><span class="line">As always, if you have any questions or concerns related to this announcement, please don’t hesitate to contact us.</span><br></pre></td></tr></table></figure></p>
<h3 id="如何解决？"><a href="#如何解决？" class="headerlink" title="如何解决？"></a>如何解决？</h3><ol>
<li>下载安装最新的<a href="https://github.com/Microsoft/Git-Credential-Manager-for-Windows" target="_blank" rel="noopener"><code>Git Credential Manager for Windows</code></a></li>
<li>更新<a href="https://github.com/git/git/releases" target="_blank" rel="noopener"><code>Git</code></a>到最新的版本，至少要到<code>v2.16.0</code></li>
<li>然后重启就可以了</li>
</ol>
<p>Tips：<br>推荐将<code>repository</code>改为<code>HTTPS</code>形式的</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本想整理一下之前的笔记写成文章发上来，但是新项目赶着上线，各种奇葩问题频出，也就暂时搁置了。好不容易写了抽空写了一篇居然发不上来，&lt;code&gt;deploy&lt;/code&gt;的时候老是提示&lt;code&gt;SSL Exception&lt;/code&gt;啥的，于是搜了一下解决方案，大多数都是说
    
    </summary>
    
      <category term="Hexo" scheme="https://faithlove.github.io/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://faithlove.github.io/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>不可能的需求</title>
    <link href="https://faithlove.github.io/2018/08/02/%E4%B8%8D%E5%8F%AF%E8%83%BD%E7%9A%84%E9%9C%80%E6%B1%82/"/>
    <id>https://faithlove.github.io/2018/08/02/不可能的需求/</id>
    <published>2018-08-02T05:44:58.000Z</published>
    <updated>2018-08-03T02:02:10.899Z</updated>
    
    <content type="html"><![CDATA[<p>由于开发过程中需要对图片进行处理，需要对图片获取尽可能详细的信息，比如图片的Exif通常包含一些照片拍摄修改的时间，分辨率，大小,经纬度等信息，突然一天新增了一个需求：需要获取图片是前置摄像头拍摄还是后置摄像头拍摄的。得知需求后查询了一众资料，两大搜索Google，百度，Android Developer官方文档，MediaStore中关于Image的类属性、方法，Exif等元数据解析等等，均未看到有标记前后置摄像头的属性，于是反馈，后被告知一加6拍摄的照片有相应字段，于是乎单独拿出来分析了。</p>
<h3 id="不可能的需求"><a href="#不可能的需求" class="headerlink" title="不可能的需求?"></a>不可能的需求?</h3><p>已知需求：获取图片是前置摄像头拍摄还是后置摄像头拍摄的<br>尝试方法：</p>
<ol>
<li>两大搜索(Google,Baidu)</li>
<li>Android Developer官方文档以及MediaStore中关于Image的类属性、方法</li>
<li>MetaData数据分析</li>
</ol>
<p>尝试结果：</p>
<ol>
<li>失败</li>
<li>失败</li>
</ol>
<h3 id="图片的MetaData数据分析"><a href="#图片的MetaData数据分析" class="headerlink" title="图片的MetaData数据分析"></a>图片的MetaData数据分析</h3><p>什么是图片的Metadata？摘一段Wiki的解释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Photographs</span><br><span class="line">Metadata may be written into a digital photo file that will identify who owns it, copyright and contact information, what brand or model of camera created the file, along with exposure information (shutter speed, f-stop, etc.) and descriptive information, such as keywords about the photo, making the file or image searchable on a computer and/or the Internet. Some metadata is created by the camera and some is input by the photographer and/or software after downloading to a computer. Most digital cameras write metadata about model number, shutter speed, etc., and some enable you to edit it;[35] this functionality has been available on most Nikon DSLRs since the Nikon D3, on most new Canon cameras since the Canon EOS 7D, and on most Pentax DSLRs since the Pentax K-3. Metadata can be used to make organizing in post-production easier with the use of key-wording. Filters can be used to analyze a specific set of photographs and create selections on criteria like rating or capture time.</span><br><span class="line"></span><br><span class="line">Photographic Metadata Standards are governed by organizations that develop the following standards. They include, but are not limited to:</span><br><span class="line"></span><br><span class="line">IPTC Information Interchange Model IIM (International Press Telecommunications Council),</span><br><span class="line">IPTC Core Schema for XMP</span><br><span class="line">XMP – Extensible Metadata Platform (an ISO standard)</span><br><span class="line">Exif – Exchangeable image file format, Maintained by CIPA (Camera &amp; Imaging Products Association) and published by JEITA (Japan Electronics and Information Technology Industries Association)</span><br><span class="line">Dublin Core (Dublin Core Metadata Initiative – DCMI)</span><br><span class="line">PLUS (Picture Licensing Universal System).</span><br><span class="line">VRA Core (Visual Resource Association)[36]</span><br></pre></td></tr></table></figure></p>
<p>Wiki对Exif的解释-<code>https://zh.wikipedia.org/wiki/EXIF</code><br>Wiki对XMP的解释-<code>https://zh.wikipedia.org/wiki/XMP</code></p>
<p>如果你需要查看一张图片的MetaData信息，在不下载任何程序的情况下，当然是放网站上识别了，如：<code>http://metapicz.com/#landing</code><br>现在我有一张图使用魅族6 Note拍摄，如下：<br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/M6.jpg" alt=""><br>将其使用网站识别的结果如下：<br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/M6MetaData.png" alt=""><br>可以看出，除了基本的Exif信息，就没有其余的多余信息了，同时还测试了一加5T，vivo，华为，三星，小米等几部手机，都一样没有，贴个一加5T的，其他的就不贴了，如下：<br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/OnePlus5T.jpg" alt=""><br>将其使用网站识别的结果如下：<br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/OnePlus5TMetaData.png" alt=""><br>网站显示没有XMP数据，但是你如果信以为真，那你就错了，网站展示的XMP数据只是对标准XMP数据而言，但是对于非标准XMP数据，网站是不识别的。下面我不使用很专业的分析工具，我们使用PhotoShop，它用来分析图片MetaData很是方便。<br>具体步骤</p>
<ol>
<li>将图片使用PhotoShop打开</li>
<li>使用快捷键<code>CTRL+ALT+SHFIT+I</code>打开MetaData面板</li>
<li>点击<code>原始数据</code></li>
</ol>
<p>下面分别是魅族拍摄的照片的元数据和一加5T拍摄的照片的元数据<br>魅族6 Note 前置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>Meizu Camera<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T15:27:15.043670<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T15:27:15<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T15:27:15.043670<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T15:27:15.072032704<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>BF515DD22603ACF5DFF3D111542D91CE<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>BF515DD22603ACF5DFF3D111542D91CE<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Meizu<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>M6 Note<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T15:27:15<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/50<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>123<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5644/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>248/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3519/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>25<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>043670<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>043670<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>043670<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.8173N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.1615E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T07:27:14Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSImgDirectionRef</span>&gt;</span>M<span class="tag">&lt;/<span class="name">exif:GPSImgDirectionRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSImgDirection</span>&gt;</span>0/1<span class="tag">&lt;/<span class="name">exif:GPSImgDirection</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSProcessingMethods</span>&gt;</span>NETWORK<span class="tag">&lt;/<span class="name">exif:GPSProcessingMethods</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>魅族6 Note 后置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>Meizu Camera<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T15:26:52.141073<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T15:26:52<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T15:26:52.141073<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T15:26:51.339079232<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>0782F6701AFCAD765F7A8E128F350371<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>0782F6701AFCAD765F7A8E128F350371<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4000<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Meizu<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>M6 Note<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>4000<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T15:26:52<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/25<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>190/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>109<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>4643/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>1851999/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>132/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3940/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>24<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>141073<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>141073<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>141073<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.8173N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.1615E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>190/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T07:26:43Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSImgDirectionRef</span>&gt;</span>M<span class="tag">&lt;/<span class="name">exif:GPSImgDirectionRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSImgDirection</span>&gt;</span>14/1<span class="tag">&lt;/<span class="name">exif:GPSImgDirection</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSProcessingMethods</span>&gt;</span>NETWORK<span class="tag">&lt;/<span class="name">exif:GPSProcessingMethods</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>OnePlus 5T 前置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:OPMedia</span>=<span class="string">"http://ns.oneplus.com/media/1.0"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:CaptureMode</span>&gt;</span>Photo<span class="tag">&lt;/<span class="name">OPMedia:CaptureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:IsHDRActive</span>&gt;</span>False<span class="tag">&lt;/<span class="name">OPMedia:IsHDRActive</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:LensFacing</span>&gt;</span>Front<span class="tag">&lt;/<span class="name">OPMedia:LensFacing</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>OnePlus5T-user 8.1.0 OPM1.171019.011 87 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-07-31T10:53:50.002856<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-07-31T10:53:50<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-07-31T10:53:50.002856<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-07-31T10:53:48.561032704<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>3341B1440498773B1C38052765AA3CC1<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>3341B1440498773B1C38052765AA3CC1<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>OnePlus<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>ONEPLUS A5010<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-07-31T10:53:50<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/25<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>200<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>4643/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>0/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3519/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>20<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>002856<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>002856<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>002856<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.6128N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.4536E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-07-31T02:53:48Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>OnePlus 5T 后置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:OPMedia</span>=<span class="string">"http://ns.oneplus.com/media/1.0"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:CaptureMode</span>&gt;</span>Photo<span class="tag">&lt;/<span class="name">OPMedia:CaptureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:Scene</span>&gt;</span>AutoHDR<span class="tag">&lt;/<span class="name">OPMedia:Scene</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:IsHDRActive</span>&gt;</span>False<span class="tag">&lt;/<span class="name">OPMedia:IsHDRActive</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:LensFacing</span>&gt;</span>Back<span class="tag">&lt;/<span class="name">OPMedia:LensFacing</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>OnePlus5T-user 8.1.0 OPM1.171019.011 87 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-07-30T17:02:51.100627<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-07-30T17:02:51<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-07-30T17:02:51.100627<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-07-30T17:02:52.842752192<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>9FE8455EBCFE4DD43B7C0F1A77AE16AD<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>9FE8455EBCFE4DD43B7C0F1A77AE16AD<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>2304<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>OnePlus<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>ONEPLUS A5010<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>2304<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-07-30T17:02:51<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/33<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>170/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1000<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>1531069/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>-222/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>4103/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>24<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>100627<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>100627<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>100627<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.6128N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.4536E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-07-30T09:02:50Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可以看出，一加自己定义了一个<code>XML</code>标签，并且使用该标签写入了自己的数据,其中<code>&lt;OPMedia:LensFacing&gt;Back&lt;/OPMedia:LensFacing&gt;</code>便是我们寻找的，键<code>LensFacing</code>对应的值为<code>Back</code>,表明这张图片使用后置摄像头拍摄，那么是不是所有的机型都有写入这个信息呢？下面是其他机型拍摄的照片的元数据：<br>OnePlus 6 前置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:OPMedia</span>=<span class="string">"http://ns.oneplus.com/media/1.0"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:CaptureMode</span>&gt;</span>Photo<span class="tag">&lt;/<span class="name">OPMedia:CaptureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:Scene</span>&gt;</span>AutoHDR<span class="tag">&lt;/<span class="name">OPMedia:Scene</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:IsHDRActive</span>&gt;</span>False<span class="tag">&lt;/<span class="name">OPMedia:IsHDRActive</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:LensFacing</span>&gt;</span>Front<span class="tag">&lt;/<span class="name">OPMedia:LensFacing</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-01T09:57:04.333801<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-01T09:57:04<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-01T09:57:04.333801<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-01T09:57:02.793550912<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>037F51FB2EE58CABACEA2D3E5655CECB<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>037F51FB2EE58CABACEA2D3E5655CECB<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>OnePlus<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>ONEPLUS A6000<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-01T09:57:04<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>500/10000<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>20000/10000<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>500<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>-316/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureBiasValue</span>&gt;</span>0/6<span class="tag">&lt;/<span class="name">exif:ExposureBiasValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MaxApertureValue</span>&gt;</span>153/100<span class="tag">&lt;/<span class="name">exif:MaxApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:LightSource</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:LightSource</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3480/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>25<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.7098<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.4435E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-01T01:57:04Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>OnePlus 6 后置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:OPMedia</span>=<span class="string">"http://ns.oneplus.com/media/1.0"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:CaptureMode</span>&gt;</span>Photo<span class="tag">&lt;/<span class="name">OPMedia:CaptureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:Scene</span>&gt;</span>AutoHDR<span class="tag">&lt;/<span class="name">OPMedia:Scene</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:IsHDRActive</span>&gt;</span>False<span class="tag">&lt;/<span class="name">OPMedia:IsHDRActive</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">OPMedia:LensFacing</span>&gt;</span>Back<span class="tag">&lt;/<span class="name">OPMedia:LensFacing</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-05-25T17:21:18.333801<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-05-25T17:21:18<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-05-25T17:21:18.333801<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-05-25T17:21:16.793550912<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>2C0E6CBC34D567743E5B9DF66D8FF4AF<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>2C0E6CBC34D567743E5B9DF66D8FF4AF<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>OnePlus<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>ONEPLUS A6000<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-05-25T17:21:18<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>100/10000<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>17000/10000<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>400<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>1531069/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>-316/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureBiasValue</span>&gt;</span>0/6<span class="tag">&lt;/<span class="name">exif:ExposureBiasValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MaxApertureValue</span>&gt;</span>153/100<span class="tag">&lt;/<span class="name">exif:MaxApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:LightSource</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:LightSource</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>4250/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>25<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>333801<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.7104<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.4342E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>0/1000<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-05-25T09:21:18Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>vivo X9 前置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>msm8953_64-user 7.1.2 N2G47H eng.compil.20180716.175053 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T14:48:40.675561<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T14:48:40<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T14:48:40.675561<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T14:48:41.251134528<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>37EE2F012E274C22C2D5506C2A1902CF<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>37EE2F012E274C22C2D5506C2A1902CF<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3840<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>5120<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>vivo<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>vivo X9<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3840<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>5120<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T14:48:40<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>10/333<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>311<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>59/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>387/100<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>26<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>675561<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>675561<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>675561<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T06:48:40Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>vivo X9 后置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>msm8953_64-user 7.1.2 N2G47H eng.compil.20180716.175053 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T14:48:14.666509<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T14:48:14<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T14:48:14.666509<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T14:48:14.78906912<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>5EFA5DBFD6539AE7059A28B40B79AEAE<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>5EFA5DBFD6539AE7059A28B40B79AEAE<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>vivo<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>vivo X9<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3456<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>4608<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T14:48:14<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>10/333<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>320<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>34/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>388/100<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>26<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>666509<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>666509<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>666509<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T06:48:14Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Pixel 2 前置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:GCamera</span>=<span class="string">"http://ns.google.com/photos/1.0/camera/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:aux</span>=<span class="string">"http://ns.adobe.com/exif/1.0/aux/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideo</span>&gt;</span>1<span class="tag">&lt;/<span class="name">GCamera:MicroVideo</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoVersion</span>&gt;</span>1<span class="tag">&lt;/<span class="name">GCamera:MicroVideoVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoOffset</span>&gt;</span>1691842<span class="tag">&lt;/<span class="name">GCamera:MicroVideoOffset</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoPresentationTimestampUs</span>&gt;</span>233612<span class="tag">&lt;/<span class="name">GCamera:MicroVideoPresentationTimestampUs</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>HDR+ 1.0.198487984zb<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T14:41:39.404620<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T14:41:39<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T14:41:39.404620<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aux:ApproximateFocusDistance</span>&gt;</span>0/1<span class="tag">&lt;/<span class="name">aux:ApproximateFocusDistance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T14:41:40.807294336<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>4B7EC3C4B26F6A5AF1C59D786A893518<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>4B7EC3C4B26F6A5AF1C59D786A893518<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3264<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>2448<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Google<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>Pixel 2<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3264<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>2448<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T14:41:39<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>33333/1000000<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>240/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>119<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>491/100<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2526069/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>218/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureBiasValue</span>&gt;</span>0/6<span class="tag">&lt;/<span class="name">exif:ExposureBiasValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MaxApertureValue</span>&gt;</span>253/100<span class="tag">&lt;/<span class="name">exif:MaxApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubjectDistance</span>&gt;</span>0/1<span class="tag">&lt;/<span class="name">exif:SubjectDistance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3380/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:CustomRendered</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:CustomRendered</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DigitalZoomRatio</span>&gt;</span>0/1<span class="tag">&lt;/<span class="name">exif:DigitalZoomRatio</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>25<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Contrast</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Contrast</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Saturation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Saturation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Sharpness</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Sharpness</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubjectDistanceRange</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SubjectDistanceRange</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>404620<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>404620<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>404620<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSVersionID</span>&gt;</span>2.2.0.0<span class="tag">&lt;/<span class="name">exif:GPSVersionID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.826N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.1655E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>3220/100<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T06:41:29Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSDOP</span>&gt;</span>15812/1000<span class="tag">&lt;/<span class="name">exif:GPSDOP</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSProcessingMethods</span>&gt;</span>fused<span class="tag">&lt;/<span class="name">exif:GPSProcessingMethods</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Pixel 2 后置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:GCamera</span>=<span class="string">"http://ns.google.com/photos/1.0/camera/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:aux</span>=<span class="string">"http://ns.adobe.com/exif/1.0/aux/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideo</span>&gt;</span>1<span class="tag">&lt;/<span class="name">GCamera:MicroVideo</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoVersion</span>&gt;</span>1<span class="tag">&lt;/<span class="name">GCamera:MicroVideoVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoOffset</span>&gt;</span>2470328<span class="tag">&lt;/<span class="name">GCamera:MicroVideoOffset</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">GCamera:MicroVideoPresentationTimestampUs</span>&gt;</span>799652<span class="tag">&lt;/<span class="name">GCamera:MicroVideoPresentationTimestampUs</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>HDR+ 1.0.198487984z<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T14:41:46.148686<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T14:41:46<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T14:41:46.148686<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">aux:ApproximateFocusDistance</span>&gt;</span>588/1000<span class="tag">&lt;/<span class="name">aux:ApproximateFocusDistance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T14:41:44.36214464<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>C6041F60CBB2044037D860457E7203A4<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>C6041F60CBB2044037D860457E7203A4<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3024<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4032<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Google<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>Pixel 2<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>3024<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>4032<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T14:41:46<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>10002/1000000<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>180/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>127<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>664/100<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>1695994/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>299/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureBiasValue</span>&gt;</span>0/6<span class="tag">&lt;/<span class="name">exif:ExposureBiasValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MaxApertureValue</span>&gt;</span>170/100<span class="tag">&lt;/<span class="name">exif:MaxApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubjectDistance</span>&gt;</span>588/1000<span class="tag">&lt;/<span class="name">exif:SubjectDistance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>4442/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:CustomRendered</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:CustomRendered</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DigitalZoomRatio</span>&gt;</span>0/1<span class="tag">&lt;/<span class="name">exif:DigitalZoomRatio</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>27<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Contrast</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Contrast</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Saturation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Saturation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Sharpness</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Sharpness</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubjectDistanceRange</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SubjectDistanceRange</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>148686<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>148686<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>148686<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSVersionID</span>&gt;</span>2.2.0.0<span class="tag">&lt;/<span class="name">exif:GPSVersionID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLatitude</span>&gt;</span>31,12.826N<span class="tag">&lt;/<span class="name">exif:GPSLatitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSLongitude</span>&gt;</span>121,27.1655E<span class="tag">&lt;/<span class="name">exif:GPSLongitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitude</span>&gt;</span>3220/100<span class="tag">&lt;/<span class="name">exif:GPSAltitude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T06:41:29Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSDOP</span>&gt;</span>15812/1000<span class="tag">&lt;/<span class="name">exif:GPSDOP</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSProcessingMethods</span>&gt;</span>fused<span class="tag">&lt;/<span class="name">exif:GPSProcessingMethods</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>红米 5 Plus 前置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>vince-user 7.1.2 N2G47H 8.7.12 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T15:50:10.111306<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T15:50:10<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T15:50:10.111306<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T15:50:09.636850304<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>CDE79A1CEBA00CD1FC459DBA269EF0B4<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>CDE79A1CEBA00CD1FC459DBA269EF0B4<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>1944<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>2592<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Xiaomi<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>Redmi 5 Plus<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>2592<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>1944<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T15:50:10<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/33<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>242<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5058/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2000000/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>62/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>2639/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>3<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>111306<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>111306<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>111306<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>200/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T07:50:09Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>红米 5 Plus 后置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">x:xmpmeta</span> <span class="attr">xmlns:x</span>=<span class="string">"adobe:ns:meta/"</span> <span class="attr">x:xmptk</span>=<span class="string">"Adobe XMP Core 5.6-c142 79.160924, 2017/07/13-01:06:39        "</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">rdf:RDF</span> <span class="attr">xmlns:rdf</span>=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">rdf:Description</span> <span class="attr">rdf:about</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmp</span>=<span class="string">"http://ns.adobe.com/xap/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:photoshop</span>=<span class="string">"http://ns.adobe.com/photoshop/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:xmpMM</span>=<span class="string">"http://ns.adobe.com/xap/1.0/mm/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tiff</span>=<span class="string">"http://ns.adobe.com/tiff/1.0/"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:exif</span>=<span class="string">"http://ns.adobe.com/exif/1.0/"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreatorTool</span>&gt;</span>vince-user 7.1.2 N2G47H 8.7.12 release-keys<span class="tag">&lt;/<span class="name">xmp:CreatorTool</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:ModifyDate</span>&gt;</span>2018-08-02T15:49:54.799201<span class="tag">&lt;/<span class="name">xmp:ModifyDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:CreateDate</span>&gt;</span>2018-08-02T15:49:54<span class="tag">&lt;/<span class="name">xmp:CreateDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmp:MetadataDate</span>&gt;</span>2018-08-02T15:49:54.799201<span class="tag">&lt;/<span class="name">xmp:MetadataDate</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:DateCreated</span>&gt;</span>2018-08-02T15:49:54.337082944<span class="tag">&lt;/<span class="name">photoshop:DateCreated</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ColorMode</span>&gt;</span>3<span class="tag">&lt;/<span class="name">photoshop:ColorMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">photoshop:ICCProfile</span>&gt;</span>sRGB IEC61966-2.1<span class="tag">&lt;/<span class="name">photoshop:ICCProfile</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:DocumentID</span>&gt;</span>DCE86D08DEBFAFC48F5631CDA52CCB7E<span class="tag">&lt;/<span class="name">xmpMM:DocumentID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">xmpMM:InstanceID</span>&gt;</span>DCE86D08DEBFAFC48F5631CDA52CCB7E<span class="tag">&lt;/<span class="name">xmpMM:InstanceID</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">dc:format</span>&gt;</span>image/jpeg<span class="tag">&lt;/<span class="name">dc:format</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageWidth</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">tiff:ImageWidth</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ImageLength</span>&gt;</span>4000<span class="tag">&lt;/<span class="name">tiff:ImageLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>8<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">tiff:BitsPerSample</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:PhotometricInterpretation</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:PhotometricInterpretation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Orientation</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:Orientation</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:SamplesPerPixel</span>&gt;</span>3<span class="tag">&lt;/<span class="name">tiff:SamplesPerPixel</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YCbCrPositioning</span>&gt;</span>1<span class="tag">&lt;/<span class="name">tiff:YCbCrPositioning</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:XResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:XResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:YResolution</span>&gt;</span>72/1<span class="tag">&lt;/<span class="name">tiff:YResolution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:ResolutionUnit</span>&gt;</span>2<span class="tag">&lt;/<span class="name">tiff:ResolutionUnit</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Make</span>&gt;</span>Xiaomi<span class="tag">&lt;/<span class="name">tiff:Make</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tiff:Model</span>&gt;</span>Redmi 5 Plus<span class="tag">&lt;/<span class="name">tiff:Model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExifVersion</span>&gt;</span>0220<span class="tag">&lt;/<span class="name">exif:ExifVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FlashpixVersion</span>&gt;</span>0100<span class="tag">&lt;/<span class="name">exif:FlashpixVersion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ColorSpace</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:ColorSpace</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>0<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ComponentsConfiguration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelXDimension</span>&gt;</span>4000<span class="tag">&lt;/<span class="name">exif:PixelXDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:PixelYDimension</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">exif:PixelYDimension</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:DateTimeOriginal</span>&gt;</span>2018-08-02T15:49:54<span class="tag">&lt;/<span class="name">exif:DateTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureTime</span>&gt;</span>1/50<span class="tag">&lt;/<span class="name">exif:ExposureTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FNumber</span>&gt;</span>220/100<span class="tag">&lt;/<span class="name">exif:FNumber</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureProgram</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureProgram</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">rdf:li</span>&gt;</span>400<span class="tag">&lt;/<span class="name">rdf:li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">rdf:Seq</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:ISOSpeedRatings</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ShutterSpeedValue</span>&gt;</span>5643/1000<span class="tag">&lt;/<span class="name">exif:ShutterSpeedValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ApertureValue</span>&gt;</span>2275007/1000000<span class="tag">&lt;/<span class="name">exif:ApertureValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:BrightnessValue</span>&gt;</span>96/100<span class="tag">&lt;/<span class="name">exif:BrightnessValue</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:MeteringMode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:MeteringMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:Flash</span> <span class="attr">rdf:parseType</span>=<span class="string">"Resource"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Fired</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Fired</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Return</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:Return</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Mode</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:Mode</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:Function</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:Function</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exif:RedEyeMode</span>&gt;</span>False<span class="tag">&lt;/<span class="name">exif:RedEyeMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exif:Flash</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLength</span>&gt;</span>3819/1000<span class="tag">&lt;/<span class="name">exif:FocalLength</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SensingMethod</span>&gt;</span>2<span class="tag">&lt;/<span class="name">exif:SensingMethod</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneType</span>&gt;</span>1<span class="tag">&lt;/<span class="name">exif:SceneType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:ExposureMode</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:ExposureMode</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:WhiteBalance</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:WhiteBalance</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span>26<span class="tag">&lt;/<span class="name">exif:FocalLengthIn35mmFilm</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SceneCaptureType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">exif:SceneCaptureType</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTime</span>&gt;</span>799201<span class="tag">&lt;/<span class="name">exif:SubSecTime</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeOriginal</span>&gt;</span>799201<span class="tag">&lt;/<span class="name">exif:SubSecTimeOriginal</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:SubSecTimeDigitized</span>&gt;</span>799201<span class="tag">&lt;/<span class="name">exif:SubSecTimeDigitized</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSAltitudeRef</span>&gt;</span>220/100<span class="tag">&lt;/<span class="name">exif:GPSAltitudeRef</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exif:GPSTimeStamp</span>&gt;</span>2018-08-02T07:49:54Z<span class="tag">&lt;/<span class="name">exif:GPSTimeStamp</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">rdf:Description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">rdf:RDF</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">x:xmpmeta</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="一加可行"><a href="#一加可行" class="headerlink" title="一加可行"></a>一加可行</h3><p>由上面的结果可知，目前只有一加在自定义属性中添加了<code>LensFacing</code>用来标记前后置摄像头，其余机型均为有相应字段用来标记前后置摄像头，所以在编码时只针对一加进行编码就行，若后续有其他机型也增加了标记字段，则进行补充编码即可。</p>
<h3 id="编码进行时"><a href="#编码进行时" class="headerlink" title="编码进行时"></a>编码进行时</h3><p>由于时间紧迫，加上重复造轮子过于复杂和耗时，我选择了<a href="https://github.com/drewnoakes/metadata-extractor/" target="_blank" rel="noopener">metadata-extractor</a>这个库，具体使用与示例请参照对应wiki及源码，这里贴个简陋的Demo的MainActivity<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kaithmy.metadatademo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.view.Menu</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> com.adobe.xmp.properties.XMPPropertyInfo</span><br><span class="line"><span class="keyword">import</span> com.drew.imaging.ImageMetadataReader</span><br><span class="line"><span class="keyword">import</span> com.drew.metadata.xmp.XmpDirectory</span><br><span class="line"><span class="keyword">import</span> kotlinx.android.synthetic.main.activity_main.*</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> IMAGE_PICKER_REQUESTCODE = <span class="number">10086</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        setSupportActionBar(toolbar)</span><br><span class="line"></span><br><span class="line">        fab.setOnClickListener &#123; view -&gt;</span><br><span class="line">            <span class="keyword">val</span> intent = Intent(Intent.ACTION_GET_CONTENT)</span><br><span class="line">            intent.type = <span class="string">"image/*"</span></span><br><span class="line">            startActivityForResult(intent, IMAGE_PICKER_REQUESTCODE)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateOptionsMenu</span><span class="params">(menu: <span class="type">Menu</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        menuInflater.inflate(R.menu.menu_main, menu)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOptionsItemSelected</span><span class="params">(item: <span class="type">MenuItem</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">when</span> (item.itemId) &#123;</span><br><span class="line">            R.id.action_settings -&gt; <span class="literal">true</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="keyword">super</span>.onOptionsItemSelected(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (requestCode == IMAGE_PICKER_REQUESTCODE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">data</span> == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">val</span> uri = <span class="keyword">data</span>.<span class="keyword">data</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> openInputStream = contentResolver.openInputStream(uri)</span><br><span class="line">                <span class="keyword">val</span> metadata = ImageMetadataReader.readMetadata(openInputStream)</span><br><span class="line">                <span class="keyword">val</span> xmpDirectory = metadata.getDirectoriesOfType(XmpDirectory::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">                xmpDirectory.forEach &#123;</span><br><span class="line">                    <span class="keyword">val</span> xmpMeta = it.xmpMeta</span><br><span class="line">                    <span class="keyword">for</span> (any <span class="keyword">in</span> xmpMeta) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (any <span class="keyword">is</span> XMPPropertyInfo &amp;&amp; <span class="string">"OPMedia:LensFacing"</span> == any.path) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="string">"Front"</span> == any.value) &#123;</span><br><span class="line">                                Toast.makeText(<span class="keyword">this</span>, <span class="string">"Front"</span>, Toast.LENGTH_LONG).show()</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">if</span> (<span class="string">"Back"</span> == any.value) &#123;</span><br><span class="line">                                Toast.makeText(<span class="keyword">this</span>, <span class="string">"Back"</span>, Toast.LENGTH_LONG).show()</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="突发情况？"><a href="#突发情况？" class="headerlink" title="突发情况？"></a>突发情况？</h3><p>程序在其他手机上跑的好好的，突然在魅族6 Note上突然崩溃了，报错信息如下：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">E/AndroidRuntime: FATAL EXCEPTION: main</span><br><span class="line">                  Process: com.kaithmy.metadatademo, PID: <span class="number">26896</span></span><br><span class="line">                  java.lang.NoSuchMethodError: No <span class="class"><span class="keyword">interface</span> <span class="title">method</span> <span class="title">getValue</span></span>()Ljava/lang/String; <span class="keyword">in</span> <span class="class"><span class="keyword">class</span> <span class="title">Lcom</span>/<span class="title">adobe</span>/<span class="title">xmp</span>/<span class="title">properties</span>/<span class="title">XMPPropertyInfo</span>; <span class="title">or</span> <span class="title">its</span> <span class="title">super</span> <span class="title">classes</span> </span>(declaration of <span class="string">'com.adobe.xmp.properties.XMPPropertyInfo'</span> appears <span class="keyword">in</span> /system/framework/framework.jar:classes2.dex)</span><br><span class="line">                      at com.kaithmy.metadatademo.MainActivity.onActivityResult(MainActivity.kt:<span class="number">57</span>)</span><br><span class="line">                      at android.app.Activity.dispatchActivityResult(Activity.java:<span class="number">7060</span>)</span><br><span class="line">                      at android.app.ActivityThread.deliverResults(ActivityThread.java:<span class="number">4279</span>)</span><br><span class="line">                      at android.app.ActivityThread.handleSendResult(ActivityThread.java:<span class="number">4326</span>)</span><br><span class="line">                      at android.app.ActivityThread.-wrap20(ActivityThread.java)</span><br><span class="line">                      at android.app.ActivityThread$H.handleMessage(ActivityThread.java:<span class="number">1640</span>)</span><br><span class="line">                      at android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">                      at android.os.Looper.loop(Looper.java:<span class="number">154</span>)</span><br><span class="line">                      at android.app.ActivityThread.main(ActivityThread.java:<span class="number">6321</span>)</span><br><span class="line">                      at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">                      at com.android.<span class="keyword">internal</span>.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">939</span>)</span><br><span class="line">                      at com.android.<span class="keyword">internal</span>.os.ZygoteInit.main(ZygoteInit.java:<span class="number">829</span>)</span><br></pre></td></tr></table></figure></p>
<p>接口类方法<code>getValue</code>找不到？，吓得我赶紧点进去看了看<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// =================================================================================================</span></span><br><span class="line"><span class="comment">// ADOBE SYSTEMS INCORPORATED</span></span><br><span class="line"><span class="comment">// Copyright 2006 Adobe Systems Incorporated</span></span><br><span class="line"><span class="comment">// All Rights Reserved</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// NOTICE:  Adobe permits you to use, modify, and distribute this file in accordance with the terms</span></span><br><span class="line"><span class="comment">// of the Adobe license agreement accompanying it.</span></span><br><span class="line"><span class="comment">// =================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.adobe.xmp.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.adobe.xmp.options.PropertyOptions;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This interface is used to return a property together with its path and namespace.</span></span><br><span class="line"><span class="comment"> * It is returned when properties are iterated with the &lt;code&gt;XMPIterator&lt;/code&gt;.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   06.07.2006</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">XMPPropertyInfo</span> <span class="keyword">extends</span> <span class="title">XMPProperty</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the namespace of the property</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getNamespace</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the path of the property, but only if returned by the iterator.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getPath</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the value of the property.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getValue</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the options of the property.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">PropertyOptions <span class="title">getOptions</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中<code>getValue()</code>和<code>getOptions()</code>继承自接口<code>XMPProperty</code><br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/XMPPropertyInfo.jpg" alt=""><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// =================================================================================================</span></span><br><span class="line"><span class="comment">// ADOBE SYSTEMS INCORPORATED</span></span><br><span class="line"><span class="comment">// Copyright 2006 Adobe Systems Incorporated</span></span><br><span class="line"><span class="comment">// All Rights Reserved</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// NOTICE:  Adobe permits you to use, modify, and distribute this file in accordance with the terms</span></span><br><span class="line"><span class="comment">// of the Adobe license agreement accompanying it.</span></span><br><span class="line"><span class="comment">// =================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.adobe.xmp.properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.adobe.xmp.XMPMeta;</span><br><span class="line"><span class="keyword">import</span> com.adobe.xmp.options.PropertyOptions;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This interface is used to return a text property together with its and options.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span>   23.01.2006</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">XMPProperty</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the value of the property.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getValue</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the options of the property.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">PropertyOptions <span class="title">getOptions</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Only set by &#123;<span class="doctag">@link</span> XMPMeta#getLocalizedText(String, String, String, String)&#125;. </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> Returns the language of the alt-text item.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">getLanguage</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>明明有啊，这不坑爹嘛这是！难道是混淆了？于是在混淆配置文件中添加了<code>-keep class com.adobe.xmp.** { *; }</code>，结果还是没用。查看一下生成的apk中的dex里有没有<br><img src="https://faithlove.github.io/pic/2018/XMPPropertyInfo/dexInfo.jpg" alt=""><br>是有的，那为什么会找不到呢？看了看错误中的<code>/system/framework/framework.jar</code>，立即将<code>framework.jar</code>从手机中导了出来，但是里面居然是空的，只有个文件夹<code>META-INF</code>中包含一个<code>MANIFEST.MF</code>文件，那么问题也不在这里。仔细想了想，会不会是因为是魅族改过framework层呢，或者说是手机被root过而受了影响呢？于是乎借了一部root过的Nexus 5装上了验证Demo进行测试，结果是能正常运行并展示结果，由此排除了受root而导致的接口方法找不到。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>基于以上验证结果，浅显地认为是魅族的ROM导致的吧ㄟ( ▔, ▔ )ㄏ</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于开发过程中需要对图片进行处理，需要对图片获取尽可能详细的信息，比如图片的Exif通常包含一些照片拍摄修改的时间，分辨率，大小,经纬度等信息，突然一天新增了一个需求：需要获取图片是前置摄像头拍摄还是后置摄像头拍摄的。得知需求后查询了一众资料，两大搜索Google，百度，A
    
    </summary>
    
      <category term="Android" scheme="https://faithlove.github.io/categories/Android/"/>
    
    
      <category term="Android" scheme="https://faithlove.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Hexo Next如何在文章摘要展示图片</title>
    <link href="https://faithlove.github.io/2018/07/18/Hexo-Next%E5%A6%82%E4%BD%95%E5%9C%A8%E6%96%87%E7%AB%A0%E6%91%98%E8%A6%81%E5%B1%95%E7%A4%BA%E5%9B%BE%E7%89%87/"/>
    <id>https://faithlove.github.io/2018/07/18/Hexo-Next如何在文章摘要展示图片/</id>
    <published>2018-07-18T09:43:44.000Z</published>
    <updated>2018-07-18T17:32:09.884Z</updated>
    
    <content type="html"><![CDATA[<p>由于之前的文章一直没有配图，并且在文章摘要中出现代码会出现乱码字符现象，于是乎想要给每篇文章配图，避免这种现象，同时配上图的摘要感觉很好看</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="100%" height="auto" src="//music.163.com/outchain/player?type=2&id=729317&auto=1&height=auto"></iframe>

<h2 id="在文章的属性列表中添加photos属性"><a href="#在文章的属性列表中添加photos属性" class="headerlink" title="在文章的属性列表中添加photos属性"></a>在文章的属性列表中添加<code>photos</code>属性</h2><p>编写的文章属性中<code>photos</code>默认为文章的配图，这是我目前最喜欢的配图方式，但是有一个缺点，它不能自定义裁剪和缩略比，展示的是原图，这相当于如果你的每张配图大小比例不一致将会很影响美观性，目前没有很好的解决方案，所以只好自己裁剪好再引入。<br>如这篇文章：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Hexo Next如何在文章摘要展示图片</span><br><span class="line">date: 2018-07-18 17:43:44</span><br><span class="line">tags: Hexo</span><br><span class="line">categories: Hexo</span><br><span class="line">photos:</span><br><span class="line"><span class="code">    - "https://faithlove.github.io/pic/2018/HexoThumb/topPicPre.png"</span></span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<h2 id="在你的正文中使用-lt-more-gt-进行截断"><a href="#在你的正文中使用-lt-more-gt-进行截断" class="headerlink" title="在你的正文中使用&lt;!-- more --&gt;进行截断"></a>在你的正文中使用<code>&lt;!-- more --&gt;</code>进行截断</h2><p>由于<code>markdown</code>是支持原生<code>html</code>的，所以我们可以在正文引用<code>img</code>来为我们的文章设置摘要配图,在<code>&lt;!-- more --&gt;</code>之前的内容都会展示到摘要中(同时与你主题文件中配置的摘要字数有关).<br>如：<br><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Hexo Next如何在文章摘要展示图片</span><br><span class="line">date: 2018-07-18 17:43:44</span><br><span class="line">tags: Hexo</span><br><span class="line">categories: Hexo</span><br><span class="line">---</span><br><span class="line">&lt;img src="https://faithlove.github.io/pic/2018/RMTP_1/topPicPre.png" width=50% /&gt;</span><br><span class="line">哇，漂亮的小姐姐(❤ ω ❤)</span><br><span class="line">&lt;!--more--&gt;</span><br></pre></td></tr></table></figure></p>
<p>参考：</p>
<ol>
<li><a href="https://segmentfault.com/q/1010000004840061" target="_blank" rel="noopener">https://segmentfault.com/q/1010000004840061</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于之前的文章一直没有配图，并且在文章摘要中出现代码会出现乱码字符现象，于是乎想要给每篇文章配图，避免这种现象，同时配上图的摘要感觉很好看&lt;/p&gt;
&lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheigh
    
    </summary>
    
      <category term="Hexo" scheme="https://faithlove.github.io/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="https://faithlove.github.io/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>教你从零搭建RMTP直播推流服务</title>
    <link href="https://faithlove.github.io/2018/07/17/%E6%95%99%E4%BD%A0%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BARMTP%E7%9B%B4%E6%92%AD%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1/"/>
    <id>https://faithlove.github.io/2018/07/17/教你从零搭建RMTP直播推流服务/</id>
    <published>2018-07-17T09:04:59.000Z</published>
    <updated>2018-07-18T16:48:14.251Z</updated>
    
    <content type="html"><![CDATA[<p>之前由于向同学分享内容的时候发现手机端没有屏幕共享的应用，而直播软件大都需要实名注册，并且没有房间密码，隐私性很低，不符合需求，于是想自己开发一款，但苦于时间不允许，由此开个坑，慢慢填。</p>
<p>市面上的第三方直播推流供应商很多，集成起来也很方便，但是大都需要付费，而且价格不菲，于是乎决定自行搭建服务，同时加深对推流服务的理解。</p>
<h2 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h2><p><code>Linux</code>,<code>Nginx(OpenResty)</code>,<code>nginx-rtmp-module</code></p>
<h2 id="什么是OpenResty"><a href="#什么是OpenResty" class="headerlink" title="什么是OpenResty"></a>什么是OpenResty</h2><p>基于<a href="http://openresty.org/cn/" target="_blank" rel="noopener">官网</a>的介绍，<code>OpenResty® 是一个基于 Nginx 与 Lua 的高性能 Web 平台</code>,详细介绍大家去<a href="http://openresty.org/cn/" target="_blank" rel="noopener">官网</a>看吧，这里就不多做解释了。</p>
<h2 id="卸载或替换之前的nginx版本"><a href="#卸载或替换之前的nginx版本" class="headerlink" title="卸载或替换之前的nginx版本"></a>卸载或替换之前的nginx版本</h2><p>如果你已经有安装过<code>nginx</code>，那么请备份好自己的数据，在此我将安装nginx,并展示如何卸载它，由于我自己的<code>nginx</code>里什么内容都没有，所以我进行完全卸载(以下命令全部在root下进行)。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装启动过程省略</span></span><br><span class="line">//停止nginx</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># nginx -s stop</span></span><br><span class="line"></span><br><span class="line">//查找nginx位置</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/sbin/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"></span><br><span class="line">//使用apt移除卸载nginx</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># apt --purge remove nginx</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">Package <span class="string">'nginx'</span> is not installed, so not removed</span><br><span class="line">The following packages were automatically installed and are no longer required:</span><br><span class="line">  libgd3 libvpx3 libxpm4 libxslt1.1 linux-headers-4.4.0-124 linux-headers-4.4.0-124-generic linux-headers-4.4.0-127</span><br><span class="line">  linux-headers-4.4.0-127-generic linux-image-4.4.0-124-generic linux-image-4.4.0-127-generic linux-image-extra-4.4.0-124-generic</span><br><span class="line">  linux-image-extra-4.4.0-127-generic nginx-common nginx-core</span><br><span class="line">Use <span class="string">'apt autoremove'</span> to remove them.</span><br><span class="line">0 upgraded, 0 newly installed, 0 to remove and 25 not upgraded.</span><br><span class="line"></span><br><span class="line">//查找nginx位置</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/sbin/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"></span><br><span class="line">//删除/usr/sbin/nginx</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># rm -r /usr/sbin/nginx</span></span><br><span class="line"></span><br><span class="line">//删除/etc/nginx</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># rm -r /etc/nginx</span></span><br><span class="line"></span><br><span class="line">//删除/usr/share/nginx/</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># rm -r /usr/share/nginx/</span></span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># whereis nginx</span></span><br><span class="line">nginx:</span><br><span class="line"></span><br><span class="line">//查看nginx进程</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root      7970  7499  0 19:18 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure></p>
<h2 id="下载安装OpenResty"><a href="#下载安装OpenResty" class="headerlink" title="下载安装OpenResty"></a>下载安装OpenResty</h2><p>到官网下载最新的安装包并安装，具体过程请参考<a href="http://openresty.org/cn/installation.html" target="_blank" rel="noopener">OpenResty-安装</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">//下载nginx压缩包</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP<span class="comment"># wget https://openresty.org/download/openresty-1.13.6.2.tar.gz</span></span><br><span class="line">--2018-07-18 19:21:35--  https://openresty.org/download/openresty-1.13.6.2.tar.gz</span><br><span class="line">Resolving openresty.org (openresty.org)... 120.24.93.123</span><br><span class="line">Connecting to openresty.org (openresty.org)|120.24.93.123|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 4635916 (4.4M) [application/x-gzip]</span><br><span class="line">Saving to: ‘openresty-1.13.6.2.tar.gz’</span><br><span class="line"></span><br><span class="line">openresty-1.13.6.2.tar.gz            100%[====================================================================&gt;]   4.42M  5.13MB/s    <span class="keyword">in</span> 0.9s</span><br><span class="line"></span><br><span class="line">2018-07-18 19:21:36 (5.13 MB/s) - ‘openresty-1.13.6.2.tar.gz’ saved [4635916/4635916]</span><br><span class="line"></span><br><span class="line">//解压</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP<span class="comment"># tar -zxf openresty-1.13.6.2.tar.gz</span></span><br><span class="line"></span><br><span class="line">//安装必要类库</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP<span class="comment"># apt-get install libpcre3-dev \</span></span><br><span class="line">&gt;     libssl-dev perl make build-essential curl</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">build-essential is already the newest version (12.1ubuntu2).</span><br><span class="line">libpcre3-dev is already the newest version (2:8.38-3.1).</span><br><span class="line">make is already the newest version (4.1-6).</span><br><span class="line">curl is already the newest version (7.47.0-1ubuntu2.8).</span><br><span class="line">libssl-dev is already the newest version (1.0.2g-1ubuntu4.13).</span><br><span class="line">perl is already the newest version (5.22.1-9ubuntu0.5).</span><br><span class="line">The following packages were automatically installed and are no longer required:</span><br><span class="line">  libgd3 libvpx3 libxpm4 libxslt1.1 linux-headers-4.4.0-124 linux-headers-4.4.0-124-generic linux-headers-4.4.0-127</span><br><span class="line">  linux-headers-4.4.0-127-generic linux-image-4.4.0-124-generic linux-image-4.4.0-127-generic linux-image-extra-4.4.0-124-generic</span><br><span class="line">  linux-image-extra-4.4.0-127-generic nginx-common nginx-core</span><br><span class="line">Use <span class="string">'apt autoremove'</span> to remove them.</span><br><span class="line">0 upgraded, 0 newly installed, 0 to remove and 25 not upgraded.</span><br><span class="line"></span><br><span class="line">//进入openresty的文件夹</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP<span class="comment"># cd openresty-1.13.6.2</span></span><br><span class="line"></span><br><span class="line">//生成编译配置文件</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># ./configure</span></span><br><span class="line">platform: linux (linux)</span><br><span class="line">cp -rp bundle/ build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"><span class="built_in">cd</span> LuaJIT-2.1-20180420</span><br><span class="line">INFO: found -msse4.2 <span class="keyword">in</span> cc.</span><br><span class="line">make TARGET_STRIP=@: CCDEBUG=-g XCFLAGS=<span class="string">'-DLUAJIT_ENABLE_LUA52COMPAT -msse4.2'</span> CC=cc PREFIX=/usr/<span class="built_in">local</span>/openresty/luajit</span><br><span class="line">==== Building LuaJIT 2.1.0-beta3 ====</span><br><span class="line">make -C src</span><br><span class="line">make[1]: Entering directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/LuaJIT-2.1-20180420/src'</span></span><br><span class="line">HOSTCC    host/minilua.o</span><br><span class="line">HOSTLINK  host/minilua</span><br><span class="line">DYNASM    host/buildvm_arch.h</span><br><span class="line">//省略一部分输出。。。。。</span><br><span class="line">creating objs/Makefile</span><br><span class="line"></span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + using system OpenSSL library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: <span class="string">"/usr/local/openresty/nginx"</span></span><br><span class="line">  nginx binary file: <span class="string">"/usr/local/openresty/nginx/sbin/nginx"</span></span><br><span class="line">  nginx modules path: <span class="string">"/usr/local/openresty/nginx/modules"</span></span><br><span class="line">  nginx configuration prefix: <span class="string">"/usr/local/openresty/nginx/conf"</span></span><br><span class="line">  nginx configuration file: <span class="string">"/usr/local/openresty/nginx/conf/nginx.conf"</span></span><br><span class="line">  nginx pid file: <span class="string">"/usr/local/openresty/nginx/logs/nginx.pid"</span></span><br><span class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/usr/local/openresty/nginx/logs/error.log"</span></span><br><span class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/usr/local/openresty/nginx/logs/access.log"</span></span><br><span class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></span><br><span class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></span><br><span class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></span><br><span class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></span><br><span class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ../..</span><br><span class="line">Type the following commands to build and install:</span><br><span class="line">    make</span><br><span class="line">    make install</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># make		//编译</span></span><br><span class="line">//省略一部分输出。。。。。</span><br><span class="line">objs/addon/src/ngx_stream_lua_ssl.o \</span><br><span class="line">objs/addon/src/ngx_stream_lua_balancer.o \</span><br><span class="line">objs/addon/src/ngx_stream_lua_logby.o \</span><br><span class="line">objs/addon/src/ngx_stream_lua_prereadby.o \</span><br><span class="line">objs/ngx_modules.o \</span><br><span class="line">-L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -Wl,-rpath,/usr/<span class="built_in">local</span>/openresty/luajit/lib -Wl,-E -Wl,-E -ldl -lpthread -lcrypt -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -lluajit-5.1 -lm -ldl -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -lluajit-5.1 -lm -ldl -lpcre -lssl -lcrypto -ldl -lz \</span><br><span class="line">-Wl,-E</span><br><span class="line">sed -e <span class="string">"s|%%PREFIX%%|/usr/local/openresty/nginx|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%PID_PATH%%|/usr/local/openresty/nginx/logs/nginx.pid|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%CONF_PATH%%|/usr/local/openresty/nginx/conf/nginx.conf|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%ERROR_LOG_PATH%%|/usr/local/openresty/nginx/logs/error.log|"</span> \</span><br><span class="line">	&lt; docs/man/nginx.8 &gt; objs/nginx.8</span><br><span class="line">make[2]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line">make[1]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line"></span><br><span class="line">//编译安装</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># make install</span></span><br><span class="line">	|| mkdir -p <span class="string">'/usr/local/openresty/nginx/logs'</span></span><br><span class="line"><span class="built_in">test</span> -d <span class="string">'/usr/local/openresty/nginx/html'</span> \</span><br><span class="line">	|| cp -R docs/html <span class="string">'/usr/local/openresty/nginx'</span></span><br><span class="line"><span class="built_in">test</span> -d <span class="string">'/usr/local/openresty/nginx/logs'</span> \</span><br><span class="line">	|| mkdir -p <span class="string">'/usr/local/openresty/nginx/logs'</span></span><br><span class="line">make[2]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line">make[1]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/openresty/site/lualib /usr/<span class="built_in">local</span>/openresty/site/pod /usr/<span class="built_in">local</span>/openresty/site/manifest</span><br><span class="line">ln -sf /usr/<span class="built_in">local</span>/openresty/nginx/sbin/nginx /usr/<span class="built_in">local</span>/openresty/bin/openresty</span><br><span class="line"></span><br><span class="line">//为了方便，软链接nginx</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># ln -s /usr/local/openresty/nginx/sbin/nginx /usr/sbin/nginx</span></span><br><span class="line"></span><br><span class="line">//启动</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># nginx</span></span><br><span class="line"></span><br><span class="line">//验证是否启动成功</span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># curl 111.231.243.184</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to OpenResty!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to OpenResty!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the OpenResty web platform is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">"https://openresty.org/"</span>&gt;openresty.org&lt;/a&gt;.&lt;br/&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> flying OpenResty.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="下载安装nginx的RMTP模块nginx-rtmp-module"><a href="#下载安装nginx的RMTP模块nginx-rtmp-module" class="headerlink" title="下载安装nginx的RMTP模块nginx-rtmp-module"></a>下载安装<code>nginx</code>的RMTP模块<code>nginx-rtmp-module</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># nginx -s stop</span></span><br><span class="line">root@VM-53-84-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># ./configure --add-module=/home/ubuntu/RTTMP/nginx-rtmp-module-master</span></span><br><span class="line">platform: linux (linux)</span><br><span class="line">cp -rp bundle/ build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"><span class="built_in">cd</span> LuaJIT-2.1-20180420</span><br><span class="line">INFO: found -msse4.2 <span class="keyword">in</span> cc.</span><br><span class="line">make TARGET_STRIP=@: CCDEBUG=-g XCFLAGS=<span class="string">'-DLUAJIT_ENABLE_LUA52COMPAT -msse4.2'</span> CC=cc PREFIX=/usr/<span class="built_in">local</span>/openresty/luajit</span><br><span class="line">==== Building LuaJIT 2.1.0-beta3 ====</span><br><span class="line">make -C src</span><br><span class="line">make[1]: Entering directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/LuaJIT-2.1-20180420/src'</span></span><br><span class="line">HOSTCC    host/minilua.o</span><br><span class="line">HOSTLINK  host/minilua</span><br><span class="line">DYNASM    host/buildvm_arch.h</span><br><span class="line">HOSTCC    host/buildvm.o</span><br><span class="line">HOSTCC    host/buildvm_asm.o</span><br><span class="line">checking <span class="keyword">for</span> OpenSSL library ... found</span><br><span class="line">checking <span class="keyword">for</span> zlib library ... found</span><br><span class="line">creating objs/Makefile</span><br><span class="line">//省略一部分输出。。。。。</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + using system OpenSSL library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: <span class="string">"/usr/local/openresty/nginx"</span></span><br><span class="line">  nginx binary file: <span class="string">"/usr/local/openresty/nginx/sbin/nginx"</span></span><br><span class="line">  nginx modules path: <span class="string">"/usr/local/openresty/nginx/modules"</span></span><br><span class="line">  nginx configuration prefix: <span class="string">"/usr/local/openresty/nginx/conf"</span></span><br><span class="line">  nginx configuration file: <span class="string">"/usr/local/openresty/nginx/conf/nginx.conf"</span></span><br><span class="line">  nginx pid file: <span class="string">"/usr/local/openresty/nginx/logs/nginx.pid"</span></span><br><span class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/usr/local/openresty/nginx/logs/error.log"</span></span><br><span class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/usr/local/openresty/nginx/logs/access.log"</span></span><br><span class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></span><br><span class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></span><br><span class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></span><br><span class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></span><br><span class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ../..</span><br><span class="line">Type the following commands to build and install:</span><br><span class="line">    make</span><br><span class="line">    make install</span><br><span class="line">root@VM-53-47-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># make</span></span><br><span class="line">//省略一部分输出。。。。。</span><br><span class="line">objs/addon/dash/ngx_rtmp_mp4.o \</span><br><span class="line">objs/addon/nginx-rtmp-module-master/ngx_rtmp_stat_module.o \</span><br><span class="line">objs/addon/nginx-rtmp-module-master/ngx_rtmp_control_module.o \</span><br><span class="line">objs/ngx_modules.o \</span><br><span class="line">-L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -Wl,-rpath,/usr/<span class="built_in">local</span>/openresty/luajit/lib -Wl,-E -Wl,-E -ldl -lpthread -lcrypt -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -lluajit-5.1 -lm -ldl -L/home/ubuntu/RMTP/openresty-1.13.6.2/build/luajit-root/usr/<span class="built_in">local</span>/openresty/luajit/lib -lluajit-5.1 -lm -ldl -lpcre -lssl -lcrypto -ldl -lz \</span><br><span class="line">-Wl,-E</span><br><span class="line">sed -e <span class="string">"s|%%PREFIX%%|/usr/local/openresty/nginx|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%PID_PATH%%|/usr/local/openresty/nginx/logs/nginx.pid|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%CONF_PATH%%|/usr/local/openresty/nginx/conf/nginx.conf|"</span> \</span><br><span class="line">	-e <span class="string">"s|%%ERROR_LOG_PATH%%|/usr/local/openresty/nginx/logs/error.log|"</span> \</span><br><span class="line">	&lt; docs/man/nginx.8 &gt; objs/nginx.8</span><br><span class="line">make[2]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line">make[1]: Leaving directory <span class="string">'/home/ubuntu/RMTP/openresty-1.13.6.2/build/nginx-1.13.6'</span></span><br><span class="line"></span><br><span class="line">//拷贝新生成的nginx文件到OpenResty安装目录下</span><br><span class="line">root@VM-53-47-ubuntu:/home/ubuntu/RMTP/openresty-1.13.6.2<span class="comment"># cp build/nginx-1.13.6/objs/nginx /usr/local/openresty/nginx/sbin</span></span><br></pre></td></tr></table></figure>
<p>接着修改<code>nginx.conf</code>配置文件，修改后的<code>nginx.conf</code>配置文件如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:/home/kaithmy/RTMP<span class="comment"># cat /usr/local/openresty/nginx/conf/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;<span class="comment"># 选择epoll模型可以达到最佳的IO性能</span></span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rtmp &#123;                <span class="comment">#RTMP服务</span></span><br><span class="line">    server &#123;</span><br><span class="line">       listen 1935;  <span class="comment">#//服务端口</span></span><br><span class="line">       chunk_size 4096;   <span class="comment">#//数据传输块的大小</span></span><br><span class="line">       application vod &#123;</span><br><span class="line">           play /opt/video; <span class="comment">#//视频文件存放位置。</span></span><br><span class="line">       &#125;</span><br><span class="line">       application rtmplive &#123;</span><br><span class="line">          live on;</span><br><span class="line">          <span class="comment">#为 rtmp 引擎设置最大连接数。默认为 off</span></span><br><span class="line">          max_connections 1024;</span><br><span class="line">       &#125;</span><br><span class="line">       application live&#123; <span class="comment">#直播</span></span><br><span class="line">           live on;</span><br><span class="line">           hls on; <span class="comment">#这个参数把直播服务器改造成实时回放服务器。</span></span><br><span class="line">           wait_key on; <span class="comment">#对视频切片进行保护，这样就不会产生马赛克了。</span></span><br><span class="line">           hls_path /opt/video/hls; <span class="comment">#切片视频文件存放位置。</span></span><br><span class="line">           hls_fragment  600s;     <span class="comment">#设置HLS片段长度。</span></span><br><span class="line">           hls_playlist_length 10m;  <span class="comment">#设置HLS播放列表长度，这里设置的是10分钟。</span></span><br><span class="line">           hls_continuous on; <span class="comment">#连续模式。</span></span><br><span class="line">           hls_cleanup on;    <span class="comment">#对多余的切片进行删除。</span></span><br><span class="line">           hls_nested on;     <span class="comment">#嵌套模式。</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">    <span class="comment">#                  '$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">    <span class="comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        location /<span class="built_in">stat</span> &#123;</span><br><span class="line">           rtmp_stat all;</span><br><span class="line">           rtmp_stat_stylesheet stat.xsl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /stat.xsl &#123;</span><br><span class="line">            root /home/kaithmy/RTMP/nginx-rtmp-module-master/;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /live &#123;  <span class="comment">#这里也是需要添加的字段。</span></span><br><span class="line">            types &#123;  </span><br><span class="line">               application/vnd.apple.mpegurl m3u8;  </span><br><span class="line">               video/mp2t ts;  </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">alias</span> /opt/video/hls;</span><br><span class="line">            expires -1;</span><br><span class="line">            add_header Cache-Control no-cache; </span><br><span class="line">            add_header Access-Control-Allow-Origin *;</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache's document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx's one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ol>
<li><p>首先测试推流服务<br> 启动<code>nginx</code>后，我们往服务器的<code>/opt/video</code>目录下上传一个<code>flv</code>视频，如我上传的是<code>01a.flv</code>,接着我们使用<code>potplayer</code>打开我们的推流地址<code>rtmp://119.29.162.191:1935/vod/01a.flv</code>,接着我们就可以观看我们上传的视频了<br><img src="https://faithlove.github.io/pic/2018/RMTP_1/01aflv.png" alt=""></p>
</li>
<li><p>接着测试直播功能<br> 测试直播功能需要用到<code>OBS Studio</code>，一款非常好用的软件，我们在软件的设置里设置好我们的推流地址，如我的是<code>rtmp://119.29.162.191/live</code>，点击开始推流后就可以开始直播了，其他人则可以通过地址<code>http://119.29.162.191/live/index.m3u8</code>观看我们的直播<br><img src="https://faithlove.github.io/pic/2018/RMTP_1/live.png" alt=""><br> 由于开启了回放，所以直播的会被缓存下来，并且以分片形式存放，具体参数与配置参考<code>nginx.conf</code><br><img src="https://faithlove.github.io/pic/2018/RMTP_1/livePart.png" alt=""></p>
</li>
</ol>
<p>参考：</p>
<ol>
<li><a href="https://blog.52itstyle.com/archives/2254/" target="_blank" rel="noopener">https://blog.52itstyle.com/archives/2254/</a></li>
<li><a href="https://blog.52itstyle.com/archives/1764/" target="_blank" rel="noopener">https://blog.52itstyle.com/archives/1764/</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前由于向同学分享内容的时候发现手机端没有屏幕共享的应用，而直播软件大都需要实名注册，并且没有房间密码，隐私性很低，不符合需求，于是想自己开发一款，但苦于时间不允许，由此开个坑，慢慢填。&lt;/p&gt;
&lt;p&gt;市面上的第三方直播推流供应商很多，集成起来也很方便，但是大都需要付费，而
    
    </summary>
    
      <category term="RMTP" scheme="https://faithlove.github.io/categories/RMTP/"/>
    
    
      <category term="RMTP" scheme="https://faithlove.github.io/tags/RMTP/"/>
    
  </entry>
  
  <entry>
    <title>jvm(10):JVM演讲PPT分享</title>
    <link href="https://faithlove.github.io/2017/10/29/jvm-10-JVM%E6%BC%94%E8%AE%B2PPT%E5%88%86%E4%BA%AB/"/>
    <id>https://faithlove.github.io/2017/10/29/jvm-10-JVM演讲PPT分享/</id>
    <published>2017-10-29T14:04:55.000Z</published>
    <updated>2017-10-29T14:12:32.365Z</updated>
    
    <content type="html"><![CDATA[<p>JVM PPT的演进文稿分享</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt1.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt2.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt3.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt4.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt5.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt6.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt7.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt8.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt9.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt10.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt11.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt12.png" alt="">  </p>
<blockquote>
<p>此PPT长达46页，不方便在页面中全部展示，文中只展示了文稿的前十二页。</p>
</blockquote>
<p><strong>获取完整版请在公众号内回复“JVM”。</strong></p>
<p>或者点击如下链接：<a href="https://faithlove.github.io/file/JVM体系结构与GC调优.pptx">https://faithlove.github.io/file/JVM体系结构与GC调优.pptx</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JVM PPT的演进文稿分享&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://faithlove.github.io/pic/2017/jvm/ppt/jvmppt1.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://faithlove.github.i
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(9):如何优化Java GC「译」</title>
    <link href="https://faithlove.github.io/2017/10/29/jvm-9-%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96Java-GC%E3%80%8C%E8%AF%91%E3%80%8D/"/>
    <id>https://faithlove.github.io/2017/10/29/jvm-9-如何优化Java-GC「译」/</id>
    <published>2017-10-29T13:23:02.000Z</published>
    <updated>2017-10-29T13:33:13.998Z</updated>
    
    <content type="html"><![CDATA[<p>本文由<a href="https://crowhawk.github.io/" target="_blank" rel="noopener">CrowHawk</a>翻译，地址：<a href="https://crowhawk.github.io/2017/08/21/jvm_4/" target="_blank" rel="noopener">如何优化Java GC「译」</a>，是Java GC调优的经典佳作。</p>
<p>Sangmin Lee发表在<a href="http://www.cubrid.org/blog" target="_blank" rel="noopener">Cubrid</a>上的”Become a Java GC Expert”系列文章的第三篇<a href="http://www.cubrid.org/blog/how-to-tune-java-garbage-collection" target="_blank" rel="noopener">《How to Tune Java Garbage Collection》</a>,本文的作者是韩国人，写在JDK 1.8发布之前，虽然有些地方有些许过时，但整体内容还是非常有价值的。译者此前也看到有人翻译了本文，发现其中有许多错漏生硬和语焉不详之处，因此决定自己翻译一份，供大家分享。</p>
<p>本文是“成为Java GC专家”系列文章的第三篇，在系列的第一篇文章<a href="http://www.cubrid.org/blog/understanding-java-garbage-collection" target="_blank" rel="noopener">《理解Java GC》</a>中，我们了解到了不同GC算法的执行过程、GC的工作原理、新生代和老年代的概念、JDK 7中你需要了解的5种GC类型以及每一种GC对性能的影响。</p>
<p>在系列的第二篇文章<a href="http://www.cubrid.org/blog/how-to-monitor-java-garbage-collection" target="_blank" rel="noopener">《如何监控Java GC》</a>中笔者已经解释了JVM进行实时GC的原理、监控GC的方法以及可以使这一过程更加迅速高效的工具。</p>
<p>在第三篇文章中，笔者将基于实际生产环境中的案例，介绍几个GC优化的最佳参数设置。在此我们假设你已经理解了本系列前两篇文章的内容，因此为了更深入的理解本文所讲内容，我建议你在阅读本篇文章之前先仔细阅读这两篇文章。</p>
<h2 id="GC优化是必要的吗？"><a href="#GC优化是必要的吗？" class="headerlink" title="GC优化是必要的吗？"></a>GC优化是必要的吗？</h2><p>或者更准确地说，GC优化对Java基础服务来说是必要的吗？答案是否定的，事实上GC优化对Java基础服务来说在有些场合是可以省去的，但前提是这些正在运行的Java系统，必须包含以下参数或行为：</p>
<ul>
<li>内存大小已经通过<strong>-Xms</strong>和<strong>-Xmx</strong>参数指定过</li>
<li>运行在server模式下（使用<strong>-server</strong>参数）</li>
<li>系统中没有残留超时日志之类的错误日志</li>
</ul>
<p>换句话说，如果你在运行时没有手动设置内存大小并且打印出了过多的超时日志，那你就需要对系统进行GC优化。</p>
<p>不过你需要时刻谨记一句话：<strong>GC tuning is the last task to be done.</strong></p>
<p>现在来想一想GC优化的最根本原因，垃圾收集器的工作就是清除Java创建的对象，垃圾收集器需要清理的对象数量以及要执行的GC数量均取决于已创建的对象数量。因此，为了使你的系统在GC上表现良好，首先需要减少创建对象的数量。</p>
<p>俗话说“冰冻三尺非一日之寒”，我们在编码时要首先要把下面这些小细节做好，否则一些琐碎的不良代码累积起来将让GC的工作变得繁重而难于管理：</p>
<ul>
<li>使用<code>StringBuilder</code>或<code>StringBuffer</code>来代替<code>String</code></li>
<li>尽量少输出日志</li>
</ul>
<p>尽管如此，仍然会有我们束手无策的情况。XML和JSON解析过程往往占用了最多的内存，即使我们已经尽可能地少用String、少输出日志，仍然会有大量的临时内存（大约10-100MB）被用来解析XML或JSON文件，但我们又很难弃用XML和JSON。在此，你只需要知道这一过程会占据大量内存即可。</p>
<p>如果在经过几次重复的优化后应用程序的内存用量情况有所改善，那么久可以启动GC优化了。</p>
<p>笔者总结了GC优化的两个目的：</p>
<ol>
<li><strong>将进入老年代的对象数量降到最低</strong></li>
<li><strong>减少Full GC的执行时间</strong></li>
</ol>
<h2 id="将进入老年代的对象数量降到最低"><a href="#将进入老年代的对象数量降到最低" class="headerlink" title="将进入老年代的对象数量降到最低"></a>将进入老年代的对象数量降到最低</h2><p>除了可以在JDK 7及更高版本中使用的G1收集器以外，其他分代GC都是由Oracle JVM提供的。关于分代GC，就是对象在Eden区被创建，随后被转移到Survivor区，在此之后剩余的对象会被转入老年代。也有一些对象由于占用内存过大，在Eden区被创建后会直接被传入老年代。老年代GC相对来说会比新生代GC更耗时，因此，减少进入老年代的对象数量可以显著降低Full GC的频率。你可能会以为减少进入老年代的对象数量意味着把它们留在新生代，事实正好相反，新生代内存的大小是可以调节的。</p>
<h2 id="降低Full-GC的时间"><a href="#降低Full-GC的时间" class="headerlink" title="降低Full GC的时间"></a>降低Full GC的时间</h2><p>Full GC的执行时间比Minor GC要长很多，因此，如果在Full GC上花费过多的时间（超过1s），将可能出现超时错误。</p>
<ul>
<li>如果<strong>通过减小老年代内存来减少Full GC时间</strong>，可能会引起<code>OutOfMemoryError</code>或者导致Full GC的频率升高。</li>
<li>另外，如果<strong>通过增加老年代内存来降低Full GC的频率</strong>，Full GC的时间可能因此增加。</li>
</ul>
<p>因此，<strong>你需要把老年代的大小设置成一个“合适”的值</strong>。</p>
<h2 id="影响GC性能的参数"><a href="#影响GC性能的参数" class="headerlink" title="影响GC性能的参数"></a>影响GC性能的参数</h2><p>正如我在系列的第一篇文章<a href="http://www.cubrid.org/blog/understanding-java-garbage-collection" target="_blank" rel="noopener">《理解Java GC》</a>末尾提到的，不要幻想着“如果有人用他设置的GC参数获取了不错的性能，我们为什么不复制他的参数设置呢？”，因为对于不用的Web服务，它们创建的对象大小和生命周期都不相同。</p>
<p>举一个简单的例子，如果一个任务的执行条件是A，B，C，D和E，另一个完全相同的任务执行条件只有A和B，那么哪一个任务执行速度更快呢？作为常识来讲，答案很明显是后者。</p>
<p>Java GC参数的设置也是这个道理，设置好几个参数并不会提升GC执行的速度，反而会使它变得更慢。<strong>GC优化的基本原则</strong>是将不同的GC参数应用到两个及以上的服务器上然后比较它们的性能，然后将那些被证明可以提高性能或减少GC执行时间的参数应用于最终的工作服务器上。</p>
<p>下面这张表展示了与内存大小相关且会影响GC性能的GC参数</p>
<center><strong>表1：GC优化需要考虑的JVM参数</strong></center>

<table>
<thead>
<tr>
<th style="text-align:left"><strong>类型</strong></th>
<th style="text-align:left"><strong>参数</strong></th>
<th style="text-align:left"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">堆内存大小</td>
<td style="text-align:left"><code>-Xms</code></td>
<td style="text-align:left">启动JVM时堆内存的大小</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>-Xmx</code></td>
<td style="text-align:left">堆内存最大限制</td>
</tr>
<tr>
<td style="text-align:left">新生代空间大小</td>
<td style="text-align:left"><code>-XX:NewRatio</code></td>
<td style="text-align:left">新生代和老年代的内存比</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>-XX:NewSize</code></td>
<td style="text-align:left">新生代内存大小</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>-XX:SurvivorRatio</code></td>
<td style="text-align:left">Eden区和Survivor区的内存比</td>
</tr>
</tbody>
</table>
<p>笔者在进行GC优化时最常用的参数是<code>-Xms</code>,<code>-Xmx</code>和<code>-XX:NewRatio</code>。<code>-Xms</code>和<code>-Xmx</code>参数通常是必须的，所以<code>NewRatio</code>的值将对GC性能产生重要的影响。</p>
<p>有些人可能会问<strong>如何设置永久代内存大小</strong>，你可以用<code>-XX:PermSize</code>和<code>-XX:MaxPermSize</code>参数来进行设置，但是要记住，只有当出现<code>OutOfMemoryError</code>错误时你才需要去设置永久代内存。</p>
<p>还有一个会影响GC性能的因素是<a href="https://crowhawk.github.io/2017/08/15/jvm_3/" target="_blank" rel="noopener">垃圾收集器的类型</a>,下表展示了关于GC类型的可选参数（基于JDK 6.0）：</p>
<center><strong>表2：GC类型可选参数</strong></center>

<table>
<thead>
<tr>
<th style="text-align:left"><strong>GC类型</strong></th>
<th style="text-align:left"><strong>参数</strong></th>
<th style="text-align:left"><strong>备注</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Serial GC</td>
<td style="text-align:left">-XX:+UseSerialGC</td>
</tr>
<tr>
<td style="text-align:left">Parallel GC</td>
<td style="text-align:left">-XX:+UseParallelGC<br>-XX:ParallelGCThreads=value</td>
</tr>
<tr>
<td style="text-align:left">Parallel Compacting GC</td>
<td style="text-align:left">-XX:+UseParallelOldGC</td>
</tr>
<tr>
<td style="text-align:left">CMS GC</td>
<td style="text-align:left">-XX:+UseConcMarkSweepGC<br>-XX:+UseParNewGC<br>-XX:+CMSParallelRemarkEnabled<br>-XX:CMSInitiatingOccupancyFraction=value<br>-XX:+UseCMSInitiatingOccupancyOnly</td>
</tr>
<tr>
<td style="text-align:left">G1</td>
<td style="text-align:left">-XX:+UnlockExperimentalVMOptions<br>-XX:+UseG1GC</td>
<td style="text-align:left">在JDK 6中这两个参数必须配合使用</td>
</tr>
</tbody>
</table>
<p>除了G1收集器外，可以通过设置上表中每种类型第一行的参数来切换GC类型，最常见的非侵入式GC就是Serial GC，它针对客户端系统进行了特别的优化。</p>
<p>会影响GC性能的参数还有很多，但是上述的参数会带来最显著的效果，请切记，设置太多的参数并不一定会提升GC的性能。</p>
<h2 id="GC优化的过程"><a href="#GC优化的过程" class="headerlink" title="GC优化的过程"></a>GC优化的过程</h2><p>GC优化的过程和大多数常见的提升性能的过程相似，下面是笔者使用的流程：</p>
<h3 id="1-监控GC状态"><a href="#1-监控GC状态" class="headerlink" title="1.监控GC状态"></a>1.监控GC状态</h3><p>你需要监控GC从而检查系统中运行的GC的各种状态，具体方法请查看系列的第二篇文章<a href="http://www.cubrid.org/blog/how-to-monitor-java-garbage-collection" target="_blank" rel="noopener">《如何监控Java GC》</a></p>
<h3 id="2-分析监控结果后决定是否需要优化GC"><a href="#2-分析监控结果后决定是否需要优化GC" class="headerlink" title="2.分析监控结果后决定是否需要优化GC"></a>2.分析监控结果后决定是否需要优化GC</h3><p>在检查GC状态后，你需要分析监控结构并决定是否需要进行GC优化。如果分析结果显示运行GC的时间只有0.1-0.3秒，那么就不需要把时间浪费在GC优化上，但如果运行GC的时间达到1-3秒，甚至大于10秒，那么GC优化将是很有必要的。</p>
<p>但是，如果你已经分配了大约10GB内存给Java，并且这些内存无法省下，那么就无法进行GC优化了。在进行GC优化之前，你需要考虑为什么你需要分配这么大的内存空间，如果你分配了1GB或2GB大小的内存并且出现了<code>OutOfMemoryError</code>，那你就应该执行<strong>堆转储（heap dump）</strong>来消除导致异常的原因。</p>
<blockquote>
<p>注意：</p>
<p><strong>堆转储（heap dump）</strong>是一个用来检查Java内存中的对象和数据的内存文件。该文件可以通过执行JDK中的<code>jmap</code>命令来创建。在创建文件的过程中，所有Java程序都将暂停，因此，不要再系统执行过程中创建该文件。</p>
<p>你可以在互联网上搜索heap dump的详细说明。对于韩国读者，可以直接参考我去年发布的书：<a href="http://book.naver.com/bookdb/book_detail.nhn?bid=6654751" target="_blank" rel="noopener">《The story of troubleshooting for Java developers and system operators》</a> (Sangmin Lee, Hanbit Media, 2011, 416 pages)</p>
</blockquote>
<h3 id="3-设置GC类型-内存大小"><a href="#3-设置GC类型-内存大小" class="headerlink" title="3.设置GC类型/内存大小"></a>3.设置GC类型/内存大小</h3><p>如果你决定要进行GC优化，那么你需要选择一个GC类型并且为它设置内存大小。此时如果你有多个服务器，请如上文提到的那样，在每台机器上设置不同的GC参数并分析它们的区别。</p>
<h3 id="4-分析结果"><a href="#4-分析结果" class="headerlink" title="4.分析结果"></a>4.分析结果</h3><p>在设置完GC参数后就可以开始收集数据，请在收集至少24小时后再进行结果分析。如果你足够幸运，你可能会找到系统的最佳GC参数。如若不然，你还需要分析输出日志并检查分配的内存，然后需要通过不断调整GC类型/内存大小来找到系统的最佳参数。</p>
<h3 id="5-如果结果令人满意，将参数应用到所有服务器上并结束GC优化"><a href="#5-如果结果令人满意，将参数应用到所有服务器上并结束GC优化" class="headerlink" title="5.如果结果令人满意，将参数应用到所有服务器上并结束GC优化"></a>5.如果结果令人满意，将参数应用到所有服务器上并结束GC优化</h3><p>如果GC优化的结果令人满意，就可以将参数应用到所有服务器上，并停止GC优化。</p>
<p>在下面的章节中，你将会看到上述每一步所做的具体工作。</p>
<h2 id="监控GC状态并分析结果"><a href="#监控GC状态并分析结果" class="headerlink" title="监控GC状态并分析结果"></a>监控GC状态并分析结果</h2><p>在运行中的Web应用服务器（Web Application Server,WAS）上查看GC状态的最佳方式就是使用<code>jstat</code>命令。笔者在<a href="http://www.cubrid.org/blog/how-to-monitor-java-garbage-collection" target="_blank" rel="noopener">《如何监控Java GC》</a>中已经介绍过了<code>jstat</code>命令，所以在本篇文章中我将着重关注数据部分。</p>
<p>下面的例子展示了某个还没有执行GC优化的JVM的状态（虽然它并不是运行服务器）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcutil 21719 1s</span><br><span class="line">S0    S1    E    O    P    YGC    YGCT    FGC    FGCT GCT</span><br><span class="line">48.66 0.00 48.10 49.70 77.45 3428 172.623 3 59.050 231.673</span><br><span class="line">48.66 0.00 48.10 49.70 77.45 3428 172.623 3 59.050 231.673</span><br></pre></td></tr></table></figure>
<p>我们先看一下YGC（从应用程序启动到采样时发生 Young GC 的次数）和YGCT（从应用程序启动到采样时 Young GC 所用的时间(秒)），计算YGCT/YGC会得出，平均每次新生代的GC耗时50ms，这是一个很小的数字，通过这个结果可以看出，我们大可不必关注新生代GC对GC性能的影响。</p>
<p>现在来看一下FGC（    从应用程序启动到采样时发生 Full GC 的次数）和FGCT（从应用程序启动到采样时 Full GC 所用的时间(秒)），计算FGCT/FGC会得出，平均每次老年代的GC耗时19.68s。有可能是执行了三次Full GC，每次耗时19.68s，也有可能是有两次只花了1s,另一次花了58s。不管是哪一种情况，GC优化都是很有必要的。</p>
<p>使用<code>jstat</code>命令可以很容易地查看GC状态，但是分析GC的最佳方式是加上<code>-verbosegc</code>参数来生成日志。在之前的文章中笔者已经解释了如何分析这些日志。<strong>HPJMeter</strong>是笔者最喜欢的用于分析<code>-verbosegc</code>生成的日志的工具，它简单易用，使用HPJmeter可以很容易地查看GC执行时间以及GC发生频率。</p>
<p>此外，如果GC执行时间满足下列所有条件，就没有必要进行GC优化了：</p>
<ul>
<li>Minor GC执行非常迅速（50ms以内）</li>
<li>Minor GC没有频繁执行（大约10s执行一次）</li>
<li>Full GC执行非常迅速（1s以内）</li>
<li>Full GC没有频繁执行（大约10min执行一次）</li>
</ul>
<p>括号中的数字并不是绝对的，它们也随着服务的状态而变化。有些服务可能要求一次Full GC在0.9s以内，而有些则会放得更宽一些。因此，对于不同的服务，需要按照不同的标准考虑是否需要执行GC优化。</p>
<p>当检查GC状态时，不能只查看Minor GC和Full GC的时间，还必须要<strong>关注GC执行的次数</strong>。如果新生代空间太小，Minor GC将会非常频繁地执行（有时每秒会执行一次，甚至更多）。此外，传入老年代的对象数目会上升，从而导致Full GC的频率升高。因此，在执行<code>jstat</code>命令时，请使用<code>-gccapacity</code>参数来查看具体占用了多少空间。</p>
<h2 id="设置GC类型-内存大小"><a href="#设置GC类型-内存大小" class="headerlink" title="设置GC类型/内存大小"></a>设置GC类型/内存大小</h2><h3 id="设置GC类型"><a href="#设置GC类型" class="headerlink" title="设置GC类型"></a>设置GC类型</h3><p>Oracle JVM有5种垃圾收集器，但是在JDK 7以前的版本中，你只能在Parallel GC, Parallel Compacting GC 和CMS GC之中选择，至于具体选择哪个，则没有具体的原则和规则。</p>
<p>既然这样的话，<strong>我们如何来选择GC呢？</strong>最好的方法是把三种都用上，但是有一点必须明确——CMS GC通常比其他并行（Parallel）GC都要快（这是因为CMS GC是并发的GC），如果确实如此，那只选择CMS GC就可以了，不过CMS GC也不总是更快，当出现<strong>concurrent mode failure</strong>时，CMS GC就会比并行GC更慢了。</p>
<big><strong>Concurrent mode failure</strong></big>

<p>现在让我们来深入地了解一下<strong>concurrent mode failure</strong>。</p>
<p>并行GC和CMS GC的最大区别是并行GC采用“标记-整理”(Mark-Compact)算法而CMS GC采用“标记-清除”(Mark-Sweep)算法（具体内容可参照译者的文章<a href="https://crowhawk.github.io/2017/08/10/jvm_2/" target="_blank" rel="noopener">《GC算法与内存分配策略》</a>）,compact步骤就是通过移动内存来消除内存碎片，从而消除分配的内存之间的空白区域。</p>
<p>对于并行GC来说，无论何时执行Full GC，都会进行compact工作，这消耗了太多的时间。不过在执行完Full GC后，下次内存分配将会变得更快（因为直接顺序分配相邻的内存）。</p>
<p>相反，CMS GC没有compact的过程，因此CMS GC运行的速度更快。但是也是由于没有整理内存，在进行磁盘清理之前，内存中会有很多零碎的空白区域，这也导致没有足够的空间分配给大对象。例如，在老年代还有300MB可用空间，但是连一个10MB的对象都没有办法被顺序存储在老年代中，在这种情况下，会报出<strong>“concurrent mode failure”</strong>的warning，然后系统执行compact操作。但是CMS GC在这种情况下执行的compact操作耗时要比并行GC高很多，并且这还会导致另一个问题，关于<strong>“concurrent mode failure”</strong>的详细说明，可用参考Oracle工程师撰写的<a href="https://blogs.oracle.com/poonam/understanding-cms-gc-logs" target="_blank" rel="noopener">《Understanding CMS GC Logs》</a>。</p>
<p>综上所述，你需要根据你的系统情况为其选择一个最适合的GC类型。</p>
<p>每个系统都有最适合它的GC类型等着你去寻找，如果你有6台服务器，我建议你每两个服务器设置相同的参数，然后加上<code>-verbosegc</code>参数再分析结果。</p>
<h3 id="设置内存大小"><a href="#设置内存大小" class="headerlink" title="设置内存大小"></a>设置内存大小</h3><p>下面展示了内存大小、GC运行次数和GC运行时间之间的关系：</p>
<p><strong>大内存空间</strong></p>
<ul>
<li>减少了GC的次数</li>
<li>提高了GC的运行时间</li>
</ul>
<p><strong>小内存空间</strong></p>
<ul>
<li>增多了GC的次数</li>
<li>降低了GC的运行时间</li>
</ul>
<p>关于如何设置内存的大小，没有一个标准答案，如果服务器资源充足并且Full GC能在1s内完成，把内存设为10GB也是可以的，但是大部分服务器并不处在这种状态中，当内存设为10GB时，Full GC会耗时10-30s,具体的时间自然与对象的大小有关。</p>
<p>既然如此，<strong>我们该如何设置内存大小呢？</strong>通常我推荐设为500MB，这不是说你要通过<code>-Xms500m</code>和<code>-Xmx500m</code>参数来设置WAS内存。根据GC优化之前的状态，如果Full GC后还剩余300MB的空间，那么把内存设为1GB是一个不错的选择（300MB（默认程序占用）+ 500MB（老年代最小空间）+200MB（空闲内存））。这意味着你需要为老年代设置至少500MB空间，因此如果你有三个运行服务器，可以把它们的内存分别设置为1GB，1.5GB，2GB，然后检查结果。</p>
<p>理论上来说，GC执行速度应该遵循1GB&gt; 1.5GB&gt; 2GB，1GB内存时GC执行速度最快。然而，理论上的1GB内存Full GC消耗1s、2GB内存Full GC消耗2 s在现实里是无法保证的，实际的运行时间还依赖于服务器的性能和对象大小。因此，最好的方法是创建尽可能多的测量数据并监控它们。</p>
<p>在设置内存空间大小时，你还需要设置一个参数：<code>NewRatio</code>。<code>NewRatio</code>的值是新生代和老年代空间大小的比例。如果<code>XX:NewRatio=1</code>，则新生代空间:老年代空间=1:1，如果堆内存为1GB，则新生代:老年代=500MB:500MB。如果<code>NewRatio</code>等于2，则新生代:老年代=1:2，因此，<code>NewRatio</code>的值设置得越大，则老年代空间越大，新生代空间越小。</p>
<p>你可能会认为把<code>NewRatio</code>设为1会是最好的选择，然而事实并非如此，根据笔者的经验，当<code>NewRatio</code>设为2或3时，整个GC的状态表现得更好。</p>
<p><strong>完成GC优化最快地方法是什么？</strong>答案是比较性能测试的结果。为了给每台服务器设置不同的参数并监控它们，最好查看的是一或两天后的数据。当通过性能测试来进行GC优化时，你需要在不同的测试时保证它们有相同的负载和运行环境。然而，即使是专业的性能测试人员，想精确地控制负载也很困难，并且需要大量的时间准备。因此，更加方便容易的方式是直接设置参数来运行，然后等待运行的结果（即使这需要消耗更多的时间）。</p>
<h2 id="分析GC优化的结果"><a href="#分析GC优化的结果" class="headerlink" title="分析GC优化的结果"></a>分析GC优化的结果</h2><p>在设置了GC参数和<code>-verbosegc</code>参数后，可以使用tail命令确保日志被正确地生成。如果参数设置得不正确或日志未生成，那你的时间就被白白浪费了。如果日志收集没有问题的话，在收集一或两天数据后再检查结果。最简单的方法是把日志从服务器移到你的本地PC上，然后用<strong>HPJMeter</strong>分析数据。</p>
<p>在分析结果时，请关注下列几点（这个优先级是笔者根据自己的经验拟定的，我认为选取GC参数时应考虑的最重要的因素是Full GC的运行时间。）：</p>
<ul>
<li>单次Full GC运行时间</li>
<li>单次Minor GC运行时间</li>
<li>Full GC运行间隔</li>
<li>Minor GC运行间隔</li>
<li>整个Full GC的时间</li>
<li>整个Minor GC的运行时间</li>
<li>整个GC的运行时间</li>
<li>Full GC的执行次数</li>
<li>Minor GC的执行次数</li>
</ul>
<p>找到最佳的GC参数是件非常幸运的，然而在大多数时候，我们并不会如此幸运，在进行GC优化时一定要小心谨慎，因为当你试图一次完成所有的优化工作时，可能会出现<code>OutOfMemoryError</code>错误。</p>
<h2 id="优化案例"><a href="#优化案例" class="headerlink" title="优化案例"></a>优化案例</h2><p>到目前为止，我们一直在从理论上介绍GC优化，现在是时候将这些理论付诸实践了，我们将通过几个例子来更深入地理解GC优化。</p>
<h3 id="示例1"><a href="#示例1" class="headerlink" title="示例1"></a>示例1</h3><p>下面这个例子是针对<strong>Service S</strong>的优化，对于最近刚开发出来的Service S，执行Full GC需要消耗过多的时间。</p>
<p>现在看一下执行<code>jstat -gcutil</code>的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S0 S1 E O P YGC YGCT FGC FGCT GCT</span><br><span class="line">12.16 0.00 5.18 63.78 20.32 54 2.047 5 6.946 8.993</span><br></pre></td></tr></table></figure>
<p>左边的Perm区的值对于最初的GC优化并不重要，而YGC参数的值更加对于这次优化更为重要。</p>
<p>平均执行一次Minor GC和Full GC消耗的时间如下表所示：</p>
<center><strong>表3：Service S的Minor GC 和Full GC的平均执行时间</strong></center>

<table>
<thead>
<tr>
<th style="text-align:left"><strong>GC类型</strong></th>
<th style="text-align:left"><strong>GC执行次数</strong></th>
<th style="text-align:left">GC执行时间</th>
<th style="text-align:left">平均值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Minor GC</td>
<td style="text-align:left">54</td>
<td style="text-align:left">2.047s</td>
<td style="text-align:left">37ms</td>
</tr>
<tr>
<td style="text-align:left">Full GC</td>
<td style="text-align:left">5</td>
<td style="text-align:left">6.946s</td>
<td style="text-align:left">1.389s</td>
</tr>
</tbody>
</table>
<p><strong>37ms</strong>对于Minor GC来说还不赖，但1.389s对于Full GC来说意味着当GC发生在数据库Timeout设置为1s的系统中时，可能会频繁出现超时现象。</p>
<p>首先，你需要检查开始GC优化前内存的使用情况。使用<code>jstat -gccapacity</code>命令可以检查内存用量情况。在笔者的服务器上查看到的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NGCMN NGCMX NGC S0C S1C EC OGCMN OGCMX OGC OC PGCMN PGCMX PGC PC YGC FGC</span><br><span class="line">212992.0 212992.0 212992.0 21248.0 21248.0 170496.0 1884160.0 1884160.0 1884160.0 1884160.0 262144.0 262144.0 262144.0 262144.0 54 5</span><br></pre></td></tr></table></figure>
<p>其中的关键值如下：</p>
<ul>
<li>新生代内存用量：212,992 KB</li>
<li>老年代内存用量：1,884,160 KB</li>
</ul>
<p>因此，除了永久代以外，被分配的内存空间加起来有2GB，并且新生代：老年代=1：9，为了得到比使用<code>jstat</code>更细致的结果，还需加上<code>-verbosegc</code>参数获取日志，并把三台服务器按照如下方式设置（除此以外没有使用任何其他参数）：</p>
<ul>
<li>NewRatio=2</li>
<li>NewRatio=3</li>
<li>NewRatio=4</li>
</ul>
<p>一天后我得到了系统的GC log，幸运的是，在设置完NewRatio后系统没有发生任何Full GC。</p>
<p><strong>这是为什么呢？</strong>这是因为大部分对象在创建后很快就被回收了，所有这些对象没有被传入老年代，而是在新生代就被销毁回收了。</p>
<p>在这样的情况下，就没有必要去改变其他的参数值了，只要选择一个最合适的<code>NewRatio</code>值即可。那么，<strong>如何确定最佳的NewRatio值呢？</strong>为此，我们分析一下每种<code>NewRatio</code>值下Minor GC的平均响应时间。</p>
<p>在每种参数下Minor GC的平均响应时间如下：</p>
<ul>
<li>NewRatio=2：45ms</li>
<li>NewRatio=3：34ms</li>
<li>NewRatio=4：30ms</li>
</ul>
<p>我们可以根据GC时间的长短得出NewRatio=4是最佳的参数值（尽管NewRatio=4时新生代空间是最小的）。在设置完GC参数后，服务器没有发生Full GC。</p>
<p>为了说明这个问题，下面是服务执行一段时间后执行<code>jstat –gcutil</code>的结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S0 S1 E O P YGC YGCT FGC FGCT GCT</span><br><span class="line">8.61 0.00 30.67 24.62 22.38 2424 30.219 0 0.000 30.219</span><br></pre></td></tr></table></figure>
<p>你可能会认为是服务器接收的请求少才使得GC发生的频率较低，实际上，虽然Full GC没有执行过，但Minor GC被执行了2424次。</p>
<h3 id="示例2"><a href="#示例2" class="headerlink" title="示例2"></a>示例2</h3><p>这是一个Service A的例子。我们通过公司内部的应用性能管理系统（APM）发现JVM暂停了相当长的时间（超过8秒），因此我们进行了GC优化。我们努力寻找JVM暂停的原因，后来发现是因为Full GC执行时间过长，因此我们决定进行GC优化。</p>
<p>在GC优化的开始阶段，我们加上了<code>-verbosegc</code>参数，结果如下图所示：</p>
<center><img src="https://faithlove.github.io/pic/2017/jvm/a24f4e9b.png"></center>

<center><strong>图1：进行GC优化之前STW的时间</strong></center>

<p>上图是由HPJMeter生成的图片之一。横坐标表示JVM执行的时间，纵坐标表示每次GC的时间。CMS为绿点，表示Full GC的结果，而Parallel Scavenge为蓝点，表示Minor GC的结果。</p>
<p>之前我说过CMS GC是最快的GC，但是上面的结果显示在一些时候CMS耗时达到了15s。<strong>是什么导致了这一结果？</strong>请记住我之前说的：CMS在执行compact（整理）操作时会显著变慢。此外，服务的内存通过<code>-Xms1g</code>和<code>=Xmx4g</code>设置了，而分配的内存只有4GB。</p>
<p>因此笔者将GC类型从CMS GC改为了Parallel GC，把内存大小设为2GB，并把<code>NewRatio</code>设为3。在执行<code>jstat -gcutil</code>几小时后的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S0 S1 E O P YGC YGCT FGC FGCT GCT</span><br><span class="line">0.00 30.48 3.31 26.54 37.01 226 11.131 4 11.758 22.890</span><br></pre></td></tr></table></figure>
<p>Full GC的时间缩短了，变成了每次3s，跟15s比有了显著提升。但是3s依然不够快，为此笔者创建了以下6种情况：</p>
<ul>
<li>Case 1: <code>-XX:+UseParallelGC -Xms1536m -Xmx1536m -XX:NewRatio=2</code></li>
<li>Case 2: <code>-XX:+UseParallelGC -Xms1536m -Xmx1536m -XX:NewRatio=3</code></li>
<li>Case 3: <code>-XX:+UseParallelGC -Xms1g -Xmx1g -XX:NewRatio=3</code></li>
<li>Case 4: <code>-XX:+UseParallelOldGC -Xms1536m -Xmx1536m -XX:NewRatio=2</code></li>
<li>Case 5: <code>-XX:+UseParallelOldGC -Xms1536m -Xmx1536m -XX:NewRatio=3</code></li>
<li>Case 6: <code>-XX:+UseParallelOldGC -Xms1g -Xmx1g -XX:NewRatio=3</code></li>
</ul>
<p><strong>上面哪一种情况最快？</strong>结果显示，内存空间越小，运行结果最少。下图展示了性能最好的Case 6的结果图，它的最慢响应时间只有1.7s，并且响应时间的平均值已经被控制到了1s以内。</p>
<center><img src="https://faithlove.github.io/pic/2017/jvm/dd3bdbb9.png"></center>

<center><strong>图2：Case 6的持续时间图</strong></center>

<p>基于上图的结果，按照Case 6调整了GC参数，但这却导致每晚都会发生<code>OutOfMemoryError</code>。很难解释发生异常的具体原因，简单地说，应该是批处理程序导致了内存泄漏，我们正在解决相关的问题。</p>
<p>如果只对GC日志做一些短时间的分析就将相关参数部署到所有服务器上来执行GC优化，这将是非常危险的。切记，只有当你同时仔细分析服务的执行情况和GC日志后，才能保证GC优化没有错误地执行。</p>
<p>在上文中，我们通过两个GC优化的例子来说明了GC优化是怎样执行的。正如上文中提到的，例子中设置的GC参数可以设置在相同的服务器之上，但前提是他们具有相同的CPU、操作系统、JDK版本并且运行着相同的服务。此外，不要把我使用的参数照搬到你的应用上，它们可能在你的机器上并不能起到同样良好的效果。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>笔者没有执行heap dump并分析内存的详细内容，而是通过自己的经验进行GC优化。精确地分析内存可以得到更好的优化效果，不过这种分析一般只适用于内存使用量相对固定的场景。如果服务严重过载并占有了大量的内存，则建议你根据之前的经验进行GC优化。</p>
<p>笔者已经在一些服务上设置了G1 GC参数并进行了性能测试，但还没有应用于正式的生产环境。G1 GC的速度快于任何其他的GC类型，但是你必须要升级到JDK 7。此外，暂时还无法保证它的稳定性，没有人知道运行时是否会出现致命的错误，因此G1<br>GC暂时还不适合投入应用。</p>
<p>等未来JDK 7真正稳定了（这并不是说它现在不稳定），并且WAS针对JDK 7进行优化后，G1 GC最终能按照预期的那样来工作，等到那一天我们可能就不再需要GC优化了。</p>
<p>想了解关于GC优化的更多细节，请前往<a href="https://www.slideshare.net/" target="_blank" rel="noopener">Slideshare.com</a> 查看相关资料。强烈推荐<a href="https://www.slideshare.net/aszegedi/everything-i-ever-learned-about-jvm-performance-tuning-twitter" target="_blank" rel="noopener">Everything I Ever Learned About JVM Performance Tuning @Twitter</a>,作者是Attila Szegedi, 一名Twitter工程师，请花些时间好好阅读它。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文由&lt;a href=&quot;https://crowhawk.github.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CrowHawk&lt;/a&gt;翻译，地址：&lt;a href=&quot;https://crowhawk.github.io/2017/08/21/
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(8):jvm知识点总览</title>
    <link href="https://faithlove.github.io/2017/10/27/jvm-8-jvm%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E8%A7%88/"/>
    <id>https://faithlove.github.io/2017/10/27/jvm-8-jvm知识点总览/</id>
    <published>2017-10-27T07:49:56.000Z</published>
    <updated>2017-10-27T07:55:03.110Z</updated>
    
    <content type="html"><![CDATA[<p>在江湖中要练就绝世武功必须内外兼备，精妙的招式和深厚的内功，武功的基础是内功。对于武功低（就像江南七怪）的人，招式更重要，因为他们不能靠内功直接去伤人，只能靠招式，利刃上优势来取胜了，但是练到高手之后，内功就更主要了。一个内功低的人招式在奇妙也打不过一个内功高的人。比如，你剑法再厉害，一剑刺过来，别人一掌打断你的剑，你还怎么使剑法，你一掌打到一个武功高的人身上，那人没什么事，却把你震伤了，你还怎么打。同样两者也是相辅相成的，内功深厚之后，原来普通的一招一式威力也会倍增。</p>
<p>对于搞开发的我们其实也是一样，现在流行的框架越来越多，封装的也越来越完善，各种框架可以搞定一切，几乎不用关注底层的实现，初级程序员只要熟悉基本的使用方法，便可以快速的开发上线；但对于高级程序员来讲，内功的修炼却越发的重要，比如算法、设计模式、底层原理等，只有把这些基础熟练之后，才能在开发过程中知其然知其所以然，出现问题时能快速定位到问题的本质。</p>
<p>对于Java程序员来讲，spring全家桶几乎可以搞定一切，spring全家桶便是精妙的招式，jvm就是内功心法很重要的一块，线上出现性能问题，jvm调优更是不可回避的问题。因此JVM基础知识对于高级程序员的重要性不必言语，我司在面试高级开发的时候，jvm相关知识也必定是考核的标准之一。本篇文章会根据之前写的jvm系列文章梳理出jvm需要关注的所有考察点。</p>
<h2 id="jvm-总体梳理"><a href="#jvm-总体梳理" class="headerlink" title="jvm 总体梳理"></a>jvm 总体梳理</h2><p>jvm体系总体分四大块：</p>
<ul>
<li>类的加载机制    </li>
<li>jvm内存结构  </li>
<li>GC算法 垃圾回收</li>
<li>GC分析 命令调优</li>
</ul>
<p><em>当然这些知识点在之前的文章中都有详细的介绍，这里只做主干的梳理</em></p>
<p>这里画了一个思维导图，将所有的知识点进行了陈列，因为图比较大可以点击右键下载了放大查看。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/JVM.jpg" alt=""></p>
<blockquote>
<p>公众号内回复：”jvm”,可查看大图。</p>
</blockquote>
<h2 id="类的加载机制"><a href="#类的加载机制" class="headerlink" title="类的加载机制"></a>类的加载机制</h2><p>主要关注点：</p>
<ul>
<li>什么是类的加载  </li>
<li>类的生命周期  </li>
<li>类加载器  </li>
<li>双亲委派模型  </li>
</ul>
<p><strong>什么是类的加载</strong></p>
<p>类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的方法区内，然后在堆区创建一个java.lang.Class对象，用来封装类在方法区内的数据结构。类的加载的最终产品是位于堆区中的Class对象，Class对象封装了类在方法区内的数据结构，并且向Java程序员提供了访问方法区内的数据结构的接口。 </p>
<p><strong>类的生命周期</strong></p>
<p>类的生命周期包括这几个部分，加载、连接、初始化、使用和卸载，其中前三部是类的加载的过程,如下图；</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/class.png" alt=""></p>
<ul>
<li>加载，查找并加载类的二进制数据，在Java堆中也创建一个java.lang.Class类的对象  </li>
<li>连接，连接又包含三块内容：验证、准备、初始化。1）验证，文件格式、元数据、字节码、符号引用验证；2）准备，为类的静态变量分配内存，并将其初始化为默认值；3）解析，把类中的符号引用转换为直接引用  </li>
<li>初始化，为类的静态变量赋予正确的初始值  </li>
<li>使用，new出对象程序中使用   </li>
<li>卸载，执行垃圾回收  </li>
</ul>
<blockquote>
<p> <em>几个小问题？</em><br> <em>1、JVM初始化步骤 ？ 2、类初始化时机 ？3、哪几种情况下，Java虚拟机将结束生命周期？</em><br> <em>答案参考这篇文章<a href="http://www.cnblogs.com/ityouknow/p/5603287.html" target="_blank" rel="noopener">jvm系列(一):java类的加载机制</a></em></p>
</blockquote>
<p><strong>类加载器</strong></p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/calssloader.png" alt=""></p>
<ul>
<li>启动类加载器：Bootstrap ClassLoader，负责加载存放在JDK\jre\lib(JDK代表JDK的安装目录，下同)下，或被-Xbootclasspath参数指定的路径中的，并且能被虚拟机识别的类库  </li>
<li>扩展类加载器：Extension ClassLoader，该加载器由sun.misc.Launcher$ExtClassLoader实现，它负责加载DK\jre\lib\ext目录中，或者由java.ext.dirs系统变量指定的路径中的所有类库（如javax.*开头的类），开发者可以直接使用扩展类加载器。  </li>
<li>应用程序类加载器：Application ClassLoader，该类加载器由sun.misc.Launcher$AppClassLoader来实现，它负责加载用户类路径（ClassPath）所指定的类，开发者可以直接使用该类加载器</li>
</ul>
<p><strong>类加载机制</strong></p>
<ul>
<li>全盘负责，当一个类加载器负责加载某个Class时，该Class所依赖的和引用的其他Class也将由该类加载器负责载入，除非显示使用另外一个类加载器来载入  </li>
<li>父类委托，先让父类加载器试图加载该类，只有在父类加载器无法加载该类时才尝试从自己的类路径中加载该类  </li>
<li>缓存机制，缓存机制将会保证所有加载过的Class都会被缓存，当程序中需要使用某个Class时，类加载器先从缓存区寻找该Class，只有缓存区不存在，系统才会读取该类对应的二进制数据，并将其转换成Class对象，存入缓存区。这就是为什么修改了Class后，必须重启JVM，程序的修改才会生效</li>
</ul>
<h2 id="jvm内存结构"><a href="#jvm内存结构" class="headerlink" title="jvm内存结构"></a>jvm内存结构</h2><p>主要关注点：</p>
<ul>
<li>jvm内存结构都是什么</li>
<li>对象分配规则 </li>
</ul>
<p><strong>jvm内存结构</strong></p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/structure.png" alt="">  </p>
<blockquote>
<p>方法区和堆是所有线程共享的内存区域；而java栈、本地方法栈和程序计数器是运行是线程私有的内存区域。</p>
</blockquote>
<ul>
<li>Java堆（Heap）,是Java虚拟机所管理的内存中最大的一块。Java堆是被所有线程共享的一块内存区域，在虚拟机启动时创建。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例都在这里分配内存。  </li>
<li>方法区（Method Area）,方法区（Method Area）与Java堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。  </li>
<li>程序计数器（Program Counter Register）,程序计数器（Program Counter Register）是一块较小的内存空间，它的作用可以看做是当前线程所执行的字节码的行号指示器。  </li>
<li>JVM栈（JVM Stacks）,与程序计数器一样，Java虚拟机栈（Java Virtual Machine Stacks）也是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法被执行的时候都会同时创建一个栈帧（Stack Frame）用于存储局部变量表、操作栈、动态链接、方法出口等信息。每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。  </li>
<li>本地方法栈（Native Method Stacks）,本地方法栈（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别不过是虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的Native方法服务。</li>
</ul>
<p><strong>对象分配规则</strong></p>
<ul>
<li>对象优先分配在Eden区，如果Eden区没有足够的空间时，虚拟机执行一次Minor GC。  </li>
<li>大对象直接进入老年代（大对象是指需要大量连续内存空间的对象）。这样做的目的是避免在Eden区和两个Survivor区之间发生大量的内存拷贝（新生代采用复制算法收集内存）。  </li>
<li>长期存活的对象进入老年代。虚拟机为每个对象定义了一个年龄计数器，如果对象经过了1次Minor GC那么对象会进入Survivor区，之后每经过一次Minor GC那么对象的年龄加1，知道达到阀值对象进入老年区。  </li>
<li>动态判断对象的年龄。如果Survivor区中相同年龄的所有对象大小的总和大于Survivor空间的一半，年龄大于或等于该年龄的对象可以直接进入老年代。  </li>
<li>空间分配担保。每次进行Minor GC时，JVM会计算Survivor区移至老年区的对象的平均大小，如果这个值大于老年区的剩余值大小则进行一次Full GC，如果小于检查HandlePromotionFailure设置，如果true则只进行Monitor GC,如果false则进行Full GC。   </li>
</ul>
<blockquote>
<p><em>如何通过参数来控制个各个内存区域</em><br><em>参考此文章：<a href="http://www.cnblogs.com/ityouknow/p/5610232.html" target="_blank" rel="noopener">jvm系列(二):JVM内存结构</a></em></p>
</blockquote>
<h2 id="GC算法-垃圾回收"><a href="#GC算法-垃圾回收" class="headerlink" title="GC算法 垃圾回收"></a>GC算法 垃圾回收</h2><p>主要关注点：</p>
<ul>
<li>对象存活判断</li>
<li>GC算法   </li>
<li>垃圾回收器 </li>
</ul>
<p><strong>对象存活判断</strong>  </p>
<p>判断对象是否存活一般有两种方式： </p>
<ul>
<li>引用计数：每个对象有一个引用计数属性，新增一个引用时计数加1，引用释放时计数减1，计数为0时可以回收。此方法简单，无法解决对象相互循环引用的问题。  </li>
<li>可达性分析（Reachability Analysis）：从GC Roots开始向下搜索，搜索所走过的路径称为引用链。当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的，不可达对象。</li>
</ul>
<p><strong>GC算法</strong></p>
<p>GC最基础的算法有三种：标记 -清除算法、复制算法、标记-压缩算法，我们常用的垃圾回收器一般都采用分代收集算法。</p>
<ul>
<li>标记 -清除算法，“标记-清除”（Mark-Sweep）算法，如它的名字一样，算法分为“标记”和“清除”两个阶段：首先标记出所有需要回收的对象，在标记完成后统一回收掉所有被标记的对象。  </li>
<li>复制算法，“复制”（Copying）的收集算法，它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉。  </li>
<li>标记-压缩算法，标记过程仍然与“标记-清除”算法一样，但后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存  </li>
<li>分代收集算法，“分代收集”（Generational Collection）算法，把Java堆分为新生代和老年代，这样就可以根据各个年代的特点采用最适当的收集算法。</li>
</ul>
<p><strong>垃圾回收器</strong></p>
<ul>
<li>Serial收集器，串行收集器是最古老，最稳定以及效率高的收集器，可能会产生较长的停顿，只使用一个线程去回收。  </li>
<li>ParNew收集器，ParNew收集器其实就是Serial收集器的多线程版本。  </li>
<li>Parallel收集器，Parallel Scavenge收集器类似ParNew收集器，Parallel收集器更关注系统的吞吐量。  </li>
<li>Parallel Old 收集器，Parallel Old是Parallel Scavenge收集器的老年代版本，使用多线程和“标记－整理”算法  </li>
<li>CMS收集器，CMS（Concurrent Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器。</li>
<li>G1收集器，G1 (Garbage-First)是一款面向服务器的垃圾收集器,主要针对配备多颗处理器及大容量内存的机器. 以极高概率满足GC停顿时间要求的同时,还具备高吞吐量性能特征  </li>
</ul>
<blockquote>
<p><em>GC算法和垃圾回收器算法图解以及更详细内容参考 <a href="http://www.cnblogs.com/ityouknow/p/5614961.html" target="_blank" rel="noopener">jvm系列(三):GC算法 垃圾收集器</a></em>  </p>
</blockquote>
<h2 id="GC分析-命令调优"><a href="#GC分析-命令调优" class="headerlink" title="GC分析 命令调优"></a>GC分析 命令调优</h2><p>主要关注点：</p>
<ul>
<li>GC日志分析   </li>
<li>调优命令  </li>
<li>调优工具</li>
</ul>
<p><strong>GC日志分析</strong></p>
<p>摘录GC日志一部分（前部分为年轻代gc回收；后部分为full gc回收）：</p>
<pre><code class="xml">2016-07-05T10:43:18.093+0800: 25.395: [GC [PSYoungGen: 274931K-&gt;10738K(274944K)] 371093K-&gt;147186K(450048K), 0.0668480 secs] [Times: user=0.17 sys=0.08, real=0.07 secs] 
2016-07-05T10:43:18.160+0800: 25.462: [Full GC [PSYoungGen: 10738K-&gt;0K(274944K)] [ParOldGen: 136447K-&gt;140379K(302592K)] 147186K-&gt;140379K(577536K) [PSPermGen: 85411K-&gt;85376K(171008K)], 0.6763541 secs] [Times: user=1.75 sys=0.02, real=0.68 secs]
</code></pre>
<p>通过上面日志分析得出，PSYoungGen、ParOldGen、PSPermGen属于Parallel收集器。其中PSYoungGen表示gc回收前后年轻代的内存变化；ParOldGen表示gc回收前后老年代的内存变化；PSPermGen表示gc回收前后永久区的内存变化。young gc 主要是针对年轻代进行内存回收比较频繁，耗时短；full gc 会对整个堆内存进行回城，耗时长，因此一般尽量减少full gc的次数</p>
<p>Young GC日志:</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/Young GC.png" alt=""></p>
<p>Full GC日志:</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/Full GC.png" alt=""></p>
<p><strong>调优命令</strong>  </p>
<p>Sun JDK监控和故障处理命令有jps jstat jmap jhat jstack jinfo</p>
<ul>
<li>jps，JVM Process Status Tool,显示指定系统内所有的HotSpot虚拟机进程。  </li>
<li>jstat，JVM statistics Monitoring是用于监视虚拟机运行时状态信息的命令，它可以显示出虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。  </li>
<li>jmap，JVM Memory Map命令用于生成heap dump文件  </li>
<li>jhat，JVM Heap Analysis Tool命令是与jmap搭配使用，用来分析jmap生成的dump，jhat内置了一个微型的HTTP/HTML服务器，生成dump的分析结果后，可以在浏览器中查看   </li>
<li>jstack，用于生成java虚拟机当前时刻的线程快照。</li>
<li>jinfo，JVM Configuration info 这个命令作用是实时查看和调整虚拟机运行参数。</li>
</ul>
<blockquote>
<p> <em>详细的命令使用参考这里<a href="http://www.ityouknow.com/java/2016/01/01/jvm%E8%B0%83%E4%BC%98-%E5%91%BD%E4%BB%A4%E7%AF%87.html" target="_blank" rel="noopener">jvm系列(四):jvm调优-命令篇</a></em></p>
</blockquote>
<p><strong>调优工具</strong>  </p>
<p>常用调优工具分为两类,jdk自带监控工具：jconsole和jvisualvm，第三方有：MAT(Memory Analyzer Tool)、GChisto。</p>
<ul>
<li>jconsole，Java Monitoring and Management Console是从java5开始，在JDK中自带的java监控和管理控制台，用于对JVM中内存，线程和类等的监控  </li>
<li>jvisualvm，jdk自带全能工具，可以分析内存快照、线程快照；监控内存变化、GC变化等。  </li>
<li>MAT，Memory Analyzer Tool，一个基于Eclipse的内存分析工具，是一个快速、功能丰富的Java heap分析工具，它可以帮助我们查找内存泄漏和减少内存消耗  </li>
<li>GChisto，一款专业分析gc日志的工具  </li>
</ul>
<blockquote>
<p> <em>工具使用参考 <a href="http://www.ityouknow.com/java/2017/02/22/jvm-tool.html" target="_blank" rel="noopener">jvm系列(七):jvm调优-工具篇</a></em></p>
</blockquote>
<hr>
<p><strong>作者：纯洁的微笑</strong><br><strong>出处：<a href="http://www.ityouknow.com/java/2017/03/01/jvm-overview.html" target="_blank" rel="noopener">http://www.ityouknow.com/</a></strong><br><strong>版权归作者所有</strong> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在江湖中要练就绝世武功必须内外兼备，精妙的招式和深厚的内功，武功的基础是内功。对于武功低（就像江南七怪）的人，招式更重要，因为他们不能靠内功直接去伤人，只能靠招式，利刃上优势来取胜了，但是练到高手之后，内功就更主要了。一个内功低的人招式在奇妙也打不过一个内功高的人。比如，你
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(7):jvm调优-工具篇</title>
    <link href="https://faithlove.github.io/2017/10/27/jvm-7-jvm%E8%B0%83%E4%BC%98-%E5%B7%A5%E5%85%B7%E7%AF%87/"/>
    <id>https://faithlove.github.io/2017/10/27/jvm-7-jvm调优-工具篇/</id>
    <published>2017-10-27T06:00:24.000Z</published>
    <updated>2017-10-27T06:28:29.161Z</updated>
    
    <content type="html"><![CDATA[<p>16年的时候花了一些时间整理了一些关于jvm的介绍文章,到现在回顾起来还是一些还没有补充全面，其中就包括如何利用工具来监控调优前后的性能变化。工具做为图形化界面来展示更能直观的发现问题，另一方面一些耗费性能的分析（dump文件分析）一般也不会在生产直接分析，往往dump下来的文件达1G左右，人工分析效率较低，因此利用工具来分析jvm相关问题，长长可以到达事半功倍的效果来。</p>
<p>jvm监控分析工具一般分为两类，一种是jdk自带的工具，一种是第三方的分析工具。jdk自带工具一般在jdk bin目录下面，以exe的形式直接点击就可以使用，其中包含分析工具已经很强大，几乎涉及了方方面面，但是我们最常使用的只有两款：jconsole.exe和jvisualvm.exe；第三方的分析工具有很多，各自的侧重点不同，比较有代表性的：MAT(Memory Analyzer Tool)、GChisto等。</p>
<p>对于大型 JAVA 应用程序来说，再精细的测试也难以堵住所有的漏洞，即便我们在测试阶段进行了大量卓有成效的工作，很多问题还是会在生产环境下暴露出来，并且很难在测试环境中进行重现。JVM 能够记录下问题发生时系统的部分运行状态，并将其存储在堆转储 (Heap Dump) 文件中，从而为我们分析和诊断问题提供了重要的依据。其中VisualVM和MAT是dump文件的分析利器。</p>
<h2 id="jdk自带的工具"><a href="#jdk自带的工具" class="headerlink" title="jdk自带的工具"></a>jdk自带的工具</h2><h3 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h3><p>Jconsole（Java Monitoring and Management Console）是从java5开始，在JDK中自带的java监控和管理控制台，用于对JVM中内存，线程和类等的监控，是一个基于JMX（java management extensions）的GUI性能监测工具。jconsole使用jvm的扩展机制获取并展示虚拟机中运行的应用程序的性能和资源消耗等信息。</p>
<p>直接在jdk/bin目录下点击jconsole.exe即可启动，界面如下:</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jconsole01.jpg" alt=""></p>
<p>在弹出的框中可以选择本机的监控本机的java应用，也可以选择远程的java服务来监控，如果监控远程服务需要在tomcat启动脚本中添加如下代码：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Dcom.sun.management.jmxremote.port=6969  </span><br><span class="line">-Dcom.sun.management.jmxremote.ssl=<span class="literal">false</span>  </span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>连接进去之后，就可以看到jconsole概览图和主要的功能：概述、内存、线程、类、VM、MBeans </p>
<ul>
<li>概述，以图表的方式显示出堆内存使用量，活动线程数，已加载的类，CUP占用率的折线图，可以非常清晰的观察在程序执行过程中的变动情况。</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jconsole02.jpg" alt=""></p>
<ul>
<li>内存，主要展示了内存的使用情况，同时可以查看堆和非堆内存的变化值对比，也可以点击执行GC来处罚GC的执行</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jconsole03.jpg" alt=""></p>
<ul>
<li>线程，主界面展示线程数的活动数和峰值，同时点击左下方线程可以查看线程的详细信息，比如线程的状态是什么，堆栈内容等，同时也可以点击“检测死锁”来检查线程之间是否有死锁的情况。</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jconsole04.jpg" alt=""></p>
<ul>
<li>类，主要展示已加载类的相关信息。  </li>
<li>VM 概要，展示JVM所有信息总览，包括基本信息、线程相关、堆相关、操作系统、VM参数等。  </li>
<li>Mbean,查看Mbean的属性，方法等。  </li>
</ul>
<h3 id="VisualVM"><a href="#VisualVM" class="headerlink" title="VisualVM"></a>VisualVM</h3><p><strong>简介</strong> </p>
<p>VisualVM 是一个工具，它提供了一个可视界面，用于查看 Java 虚拟机 (Java Virtual Machine, JVM) 上运行的基于 Java 技术的应用程序（Java 应用程序）的详细信息。VisualVM 对 Java Development Kit (JDK) 工具所检索的 JVM 软件相关数据进行组织，并通过一种使您可以快速查看有关多个 Java 应用程序的数据的方式提供该信息。您可以查看本地应用程序以及远程主机上运行的应用程序的相关数据。此外，还可以捕获有关 JVM 软件实例的数据，并将该数据保存到本地系统，以供后期查看或与其他用户共享。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm.jpg" alt=""></p>
<p>VisualVM 是javajdk自带的最牛逼的调优工具了吧，也是我平时使用最多调优工具，几乎涉及了jvm调优的方方面面。同样是在jdk/bin目录下面双击jvisualvm.exe既可使用，启动起来后和jconsole 一样同样可以选择本地和远程，如果需要监控远程同样需要配置相关参数，主界面如下；</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm01.jpg" alt=""></p>
<p>VisualVM可以根据需要安装不同的插件，每个插件的关注点都不同，有的主要监控GC，有的主要监控内存，有的监控线程等。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm02.jpg" alt=""></p>
<p>如何安装：</p>
<blockquote>
<p>1、从主菜单中选择“工具”&gt;“插件”。<br>2、在“可用插件”标签中，选中该插件的“安装”复选框。单击“安装”。<br>3、逐步完成插件安装程序。</p>
</blockquote>
<p>我这里以 Eclipse(pid 22296)为例，双击后直接展开，主界面展示了系统和jvm两大块内容，点击右下方jvm参数和系统属性可以参考详细的参数信息.</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm03.jpg" alt=""></p>
<p>因为VisualVM的插件太多，我这里主要介绍三个我主要使用几个：监控、线程、Visual GC</p>
<p>监控的主页其实也就是，cpu、内存、类、线程的图表</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm04.jpg" alt=""></p>
<p>线程和jconsole功能没有太大的区别</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm05.jpg" alt=""></p>
<p>Visual GC 是常常使用的一个功能，可以明显的看到年轻代、老年代的内存变化，以及gc频率、gc的时间等。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm06.jpg" alt=""></p>
<p>以上的功能其实jconsole几乎也有，VisualVM更全面更直观一些，另外VisualVM非常多的其它功能，可以分析dump的内存快照，dump出来的线程快照并且进行分析等，还有其它很多的插件大家可以去探索</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvisualvm07.jpg" alt=""></p>
<h2 id="第三方调优工具"><a href="#第三方调优工具" class="headerlink" title="第三方调优工具"></a>第三方调优工具</h2><h3 id="MAT"><a href="#MAT" class="headerlink" title="MAT"></a>MAT</h3><p><strong>MAT是什么？</strong></p>
<p>MAT(Memory Analyzer Tool)，一个基于Eclipse的内存分析工具，是一个快速、功能丰富的Java heap分析工具，它可以帮助我们查找内存泄漏和减少内存消耗。使用内存分析工具从众多的对象中进行分析，快速的计算出在内存中对象的占用大小，看看是谁阻止了垃圾收集器的回收工作，并可以通过报表直观的查看到可能造成这种结果的对象。</p>
<p>通常内存泄露分析被认为是一件很有难度的工作，一般由团队中的资深人士进行。不过要介绍的 MAT（Eclipse Memory Analyzer）被认为是一个“傻瓜式“的堆转储文件分析工具，你只需要轻轻点击一下鼠标就可以生成一个专业的分析报告。和其他内存泄露分析工具相比，MAT 的使用非常容易，基本可以实现一键到位，即使是新手也能够很快上手使用。</p>
<p>MAT以eclipse 插件的形式来安装，具体的安装过程就不在描述了，可以利用visualvm或者是 jmap命令生产堆文件，导入eclipse mat中生成分析报告：</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat01.jpg" alt=""></p>
<p>生产这会报表的同时也会在dump文件的同级目录下生成三份（dump_Top_Consumers.zip、dump_Leak_Suspects.zip、dump_Top_Components.zip）分析结果的html文件，方便发送给相关同事来查看。</p>
<p>需要关注的是下面的Actions、Reports、Step by Step区域：</p>
<ul>
<li>Histogram：列出内存中的对象，对象的个数以及大小，支持正则表达式查找，也可以计算出该类所有对象的retained size</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat02.jpg" alt=""></p>
<ul>
<li>Dominator Tree：列出最大的对象以及其依赖存活的Object （大小是以Retained Heap为标准排序的）</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat03.jpg" alt=""></p>
<ul>
<li>Top Consumers ： 通过图形列出最大的object</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat04.jpg" alt=""></p>
<ul>
<li><p>duplicate classes ：检测由多个类装载器加载的类</p>
</li>
<li><p>Leak Suspects ：内存泄漏分析</p>
</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat05.jpg" alt=""></p>
<ul>
<li>Top Components: 列出大于总堆数的百分之1的报表。</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/mat06.jpg" alt=""></p>
<ul>
<li>Component Report:分析对象属于同一个包或者被同一个类加载器加载</li>
</ul>
<p>以上只是一个初级的介绍，mat还有更强大的使用，比如对比堆内存，在生产环境中往往为了定位问题，每隔几分钟dump出一下内存快照，随后在对比不同时间的堆内存的变化来发现问题。</p>
<h3 id="GChisto"><a href="#GChisto" class="headerlink" title="GChisto"></a>GChisto</h3><p>GChisto是一款专业分析gc日志的工具，可以通过gc日志来分析：Minor GC、full gc的时间、频率等等，通过列表、报表、图表等不同的形式来反应gc的情况。虽然界面略显粗糙，但是功能还是不错的。</p>
<p>配置好本地的jdk环境之后，双击GChisto.jar,在弹出的输入框中点击 add 选择gc.log日志</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g1.jpg" alt=""></p>
<ul>
<li>GC Pause Stats:可以查看GC 的次数、GC的时间、GC的开销、最大GC时间和最小GC时间等，以及相应的柱状图</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g2.jpg" alt=""></p>
<ul>
<li><p>GC Pause Distribution:查看GC停顿的详细分布，x轴表示垃圾收集停顿时间，y轴表示是停顿次数。</p>
</li>
<li><p>GC Timeline：显示整个时间线上的垃圾收集</p>
</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g3.jpg" alt=""></p>
<p>不过这款工具已经不再维护，不能识别最新jdk的日志文件。</p>
<h3 id="gcviewer"><a href="#gcviewer" class="headerlink" title="gcviewer"></a>gcviewer</h3><p>GCViewer也是一款分析小工具，用于可视化查看由Sun / Oracle, IBM, HP 和 BEA Java 虚拟机产生的垃圾收集器的日志，gcviewer个人感觉显示 的界面比较乱没有GChisto更专业一些。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/gv.jpg" alt=""></p>
<h3 id="GC-Easy"><a href="#GC-Easy" class="headerlink" title="GC Easy"></a>GC Easy</h3><p>这是一个web工具,在线使用非常方便.  </p>
<p>地址: <a href="http://gceasy.io" target="_blank" rel="noopener">http://gceasy.io</a></p>
<p>进入官网，讲打包好的zip或者gz为后缀的压缩包上传，过一会就会拿到分析结果。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/gceasy1.png" alt=""></p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/gceasy2.png" alt=""></p>
<p>推荐使用此工具进行gc分析。</p>
<p><em>前期jvm系类文章回顾:</em></p>
<ul>
<li><a href="http://www.cnblogs.com/ityouknow/p/5603287.html" target="_blank" rel="noopener">jvm系列(一):java类的加载机制</a></li>
<li><a href="http://www.cnblogs.com/ityouknow/p/5610232.html" target="_blank" rel="noopener">jvm系列(二):JVM内存结构</a></li>
<li><a href="http://www.cnblogs.com/ityouknow/p/5614961.html" target="_blank" rel="noopener">jvm系列(三):GC算法 垃圾收集器</a></li>
<li><a href="http://www.ityouknow.com/java/2016/01/01/jvm%E8%B0%83%E4%BC%98-%E5%91%BD%E4%BB%A4%E7%AF%87.html" target="_blank" rel="noopener">jvm系列(四):jvm调优-命令篇</a></li>
<li><a href="http://www.cnblogs.com/ityouknow/p/5378874.html" target="_blank" rel="noopener">jvm系列(五):tomcat性能调优和性能监控（visualvm）</a></li>
<li><a href="http://www.cnblogs.com/ityouknow/p/5647513.html" target="_blank" rel="noopener">jvm系列(六):jvm调优-从eclipse开始</a></li>
</ul>
<hr>
<p><strong>作者：纯洁的微笑</strong><br><strong>出处：<a href="http://www.ityouknow.com/java/2017/02/22/jvm-tool.html" target="_blank" rel="noopener">http://www.ityouknow.com/</a></strong><br><strong>版权归作者所有</strong> </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;16年的时候花了一些时间整理了一些关于jvm的介绍文章,到现在回顾起来还是一些还没有补充全面，其中就包括如何利用工具来监控调优前后的性能变化。工具做为图形化界面来展示更能直观的发现问题，另一方面一些耗费性能的分析（dump文件分析）一般也不会在生产直接分析，往往dump下来
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(6):Java服务GC参数调优案例</title>
    <link href="https://faithlove.github.io/2017/10/27/jvm-6-Java%E6%9C%8D%E5%8A%A1GC%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/"/>
    <id>https://faithlove.github.io/2017/10/27/jvm-6-Java服务GC参数调优案例/</id>
    <published>2017-10-27T05:15:58.000Z</published>
    <updated>2017-10-27T05:24:18.881Z</updated>
    
    <content type="html"><![CDATA[<p>本文介绍了一次生产环境的JVM GC相关参数的调优过程，通过参数的调整避免了GC卡顿对JAVA服务成功率的影响。</p>
<p>这段时间在整理jvm系列的文章，无意中发现本文，作者思路清晰通过步步分析最终解决问题。我个人特别喜欢这种实战类的内容，经原作者的授权同意，将文章分享于此。原文链接：<a href="https://segmentfault.com/a/1190000005174819" target="_blank" rel="noopener">Java服务GC参数调优案例</a>，下面为转载此文的内容，备注部分为本人添加，主要起到说明的作用。</p>
<h2 id="背景以及遇到的问题"><a href="#背景以及遇到的问题" class="headerlink" title="背景以及遇到的问题"></a>背景以及遇到的问题</h2><p>我们的Java HTTP服务属于OLTP类型，对成功率和响应时间的要求比较高，在生产环境中出现偶现的成功率突然下降然后又自动恢复的情况，如图所示：</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/articlex.png" alt=""></p>
<p>JVM和GC相关的参数如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Xmx22528m</span><br><span class="line">-Xms22528m</span><br><span class="line">-XX:NewRatio=2</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:+UseParNewGC</span><br><span class="line">-XX:+CMSParallelRemarkEnabled</span><br></pre></td></tr></table></figure>
<p>总结来说，由于服务中大量使用了Cache，所以堆大小开到了22G。GC算法使用CMS（UseConcMarkSweepGC），开启了降低标记停顿（CMSParallelRemarkEnabled），设置年轻代为并行收集（UseParNewGC），年轻代和老年代的比例为1:2 （NewRatio＝2）.</p>
<p>JVM GC日志相关的参数如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-Xloggc:/data/gc.log</span><br><span class="line">-XX:GCLogFileSize=10M</span><br><span class="line">-XX:NumberOfGCLogFiles=10</span><br><span class="line">-XX:+UseGCLogFileRotation</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+PrintGCTimeStamps</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+DisableExplicitGC</span><br><span class="line">-verbose:gc</span><br></pre></td></tr></table></figure>
<h2 id="问题解决过程"><a href="#问题解决过程" class="headerlink" title="问题解决过程"></a>问题解决过程</h2><h3 id="排除应用程序的内存使用问题"><a href="#排除应用程序的内存使用问题" class="headerlink" title="排除应用程序的内存使用问题"></a>排除应用程序的内存使用问题</h3><p>首先使用jmap查看内存使用情况：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -histo:live PID</span><br></pre></td></tr></table></figure>
<p>这个命令把程序中当前的对象按照个数和占用的空间排序以后打印出来。这里没有发现使用异常的对象。</p>
<h3 id="排除Cache内容过多的问题"><a href="#排除Cache内容过多的问题" class="headerlink" title="排除Cache内容过多的问题"></a>排除Cache内容过多的问题</h3><p>如果Cache内容过多也会导致JVM老年代容易被用满导致频繁GC，因此调出GC日志进行查看，发现每次GC以后内存使用一般是从20G降低到5G左右，因此常驻内存的Cache不是导致GC长时间卡顿的根本原因。对于GC LOG的查看有多种方式，使用VisualVM比较直观，需要使用VisualGC：</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/articlex_VisualVM.png" alt=""></p>
<p>从图中我们可以看到伊甸园和老年代的空间分配，由于整体内存是20G，设置 -XX:NewRatio=2 因此老年代是14G，伊甸园＋S0+S1=7G</p>
<h3 id="调整GC时间点（成功率抖动问题加重）"><a href="#调整GC时间点（成功率抖动问题加重）" class="headerlink" title="调整GC时间点（成功率抖动问题加重）"></a>调整GC时间点（成功率抖动问题加重）</h3><p>如果GC需要处理的内存量比较大，执行的时间也就比较长，STW （Stop the World）时间也就更长。按照这个思路调整CMS启动的时间点，希望提早GC，也就是让GC变得更加频繁但是期望每次执行的时间较少。添加了下面这两个参数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseCMSInitiatingOccupancyOnly</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=50</span><br></pre></td></tr></table></figure>
<p>意思是说在Old区使用了50%的时候触发GC。实验后发现GC的频率有所增加，但是每次GC造成的陈功率降低现象并没有减弱，因此弃用这两个参数。</p>
<h3 id="调整对象在年轻代内存中驻留的时间（效果不明显）"><a href="#调整对象在年轻代内存中驻留的时间（效果不明显）" class="headerlink" title="调整对象在年轻代内存中驻留的时间（效果不明显）"></a>调整对象在年轻代内存中驻留的时间（效果不明显）</h3><p>如果能够降低老年代GC的频率也可以达到降低GC影响的目的，因此尝试让对象在年轻代内存中进行更长时间的驻留，提升这些对象在年轻代GC时候被销毁的概率。使用参数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 备注：  </span><br><span class="line">&gt; 1、MaxTenuringThreshold 在1.5.0_05之前最大值可以设置为31 ，1.5.0_06以后最大值可以设置为15，超过15会被认为无限大。参考：[Never set GC parameter -XX:MaxTenuringThreshold greater than 15](https://sourcevirtues.com/2013/03/29/never-set-gc-parameter-maxtenuringthreshold-greater-than-15/)  </span><br><span class="line">&gt; 2、提升年轻代GC被销毁的概率，只是调整这个参数效果不大，第二次age的值会重新计算，参考：[说说MaxTenuringThreshold这个参数](http://bluedavy.me/?p=70)  </span><br><span class="line"></span><br><span class="line">### CMS-Remark之前强制进行年轻代的GC</span><br><span class="line"></span><br><span class="line">首先补充一下CMS的相关知识，在CMS整个过程中有两个步骤是STW的，如图红色部分：</span><br><span class="line"></span><br><span class="line">![](https://faithlove.github.io/pic/2017/jvm/articlex_cms.png)</span><br><span class="line"></span><br><span class="line">CMS并非没有暂停，而是用两次短暂停来替代串行标记整理算法的长暂停，它的收集周期是这样：</span><br><span class="line"></span><br><span class="line">- 1、初始标记(CMS-initial-mark),从root对象开始标记存活的对象</span><br><span class="line">- 2、并发标记(CMS-concurrent-mark)</span><br><span class="line">- 3、重新标记(CMS-remark),暂停所有应用程序线程，重新标记并发标记阶段遗漏的对象（在并发标记阶段结束后对象状态的更新导致）</span><br><span class="line">- 4、并发清除(CMS-concurrent-sweep)</span><br><span class="line">- 5、并发重设状态等待下次CMS的触发(CMS-concurrent-reset)。</span><br><span class="line"></span><br><span class="line">通过GC日志和成功率下降的时间点进行比对发现并不是每一次老年代GC都会导致成功率的下降，但是从中发现了一个规律：</span><br><span class="line"></span><br><span class="line">![](https://faithlove.github.io/pic/2017/jvm/cms_gc1.png)</span><br><span class="line"></span><br><span class="line">前两次GC CMS-Remark过程在4s左右造成了成功率的下降，但是第三次GC并没有对成功率造成明显的影响,CMS-Remark只有0.18s。Java HTTP 服务是通过Nginx进行反向代理的，nginx设置的超时时间是3s，所以如果GC卡顿在3s以内就不会对成功率造成太大的影响。</span><br><span class="line"></span><br><span class="line">从GC日志中又发现一个信息：</span><br><span class="line"></span><br><span class="line">![](https://faithlove.github.io/pic/2017/jvm/cms_gc2.png)</span><br><span class="line"></span><br><span class="line">在文档和相关资料中没有找到蓝色部分的含义，猜测是remark处理的内存量，处理的越多就越慢。添加下面两个参数强制在remark阶段和FULL GC阶段之前先在进行一次年轻代的GC，这样需要进行处理的内存量就不会太多。</span><br><span class="line"></span><br><span class="line">&gt; 备注：  </span><br><span class="line">&gt; 1、蓝色部分的含义：remark标记需要清理对象的容量。关于如何分析CMS日志，可以参考这篇文章：[了解 CMS 垃圾回收日志](http://ifeve.com/jvm-cms-log/)  </span><br><span class="line">&gt; 2、FULL GC阶段之前先在进行一次年轻代的GC的意义是：Yong区对象引用了Old区的对象，如果在Old区进行清理之前不进行Yong区清理，就会导致Old区被yong区引用的对象无法释放。可以参考这篇文章：[假笨说-又抓了一个导致频繁GC的鬼--数组动态扩容](http://mp.weixin.qq.com/s/HKdpmmvJKq45QZdV4Q2cYQ)  </span><br><span class="line"></span><br><span class="line">```  sh</span><br><span class="line">-XX:+ScavengeBeforeFullGC </span><br><span class="line">-XX:+CMSScavengeBeforeRemark</span><br></pre></td></tr></table></figure></p>
<p>调优以后效果很明显，下面是两台配置完全相同的服务器在同一时间段的成功率和响应时间监控图，第一个没有添加强制年轻代GC的参数。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/end1.png" alt=""><br><img src="https://faithlove.github.io/pic/2017/jvm/end2.png" alt=""></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>1、在CMS-remark阶段需要对堆中所有的内存对象进行处理，如果在这个阶段之前强制执行一次年轻代的GC会大量减少remark需要处理的内存数量，进而降低JVM卡顿对成功率的影响。<br>2、对于Java HTTP服务，JVM的卡顿时间应该小于HTTP客户端的调用超时时间，否则JVM卡顿会对成功率造成影响。</p>
<p><strong>感谢<a href="http://www.jianshu.com/u/3def157aab07" target="_blank" rel="noopener">匠心零度</a>对文章内容进行深入的探讨，备注内容属于讨论后的结果</strong></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://blog.csdn.net/historyasamirror/article/details/6245157" target="_blank" rel="noopener">JVM调优：选择合适的GC collector （三）</a><br><a href="https://blogs.oracle.com/poonam/entry/understanding_cms_gc_logs" target="_blank" rel="noopener">Understanding CMS GC Logs</a><br><a href="http://blog.sokolenko.me/2014/11/javavm-options-production.html" target="_blank" rel="noopener">Java VM Options You Should Always Use in Production</a>  </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文介绍了一次生产环境的JVM GC相关参数的调优过程，通过参数的调整避免了GC卡顿对JAVA服务成功率的影响。&lt;/p&gt;
&lt;p&gt;这段时间在整理jvm系列的文章，无意中发现本文，作者思路清晰通过步步分析最终解决问题。我个人特别喜欢这种实战类的内容，经原作者的授权同意，将文章分
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(5):Java GC 分析</title>
    <link href="https://faithlove.github.io/2017/10/27/jvm-5-Java-GC-%E5%88%86%E6%9E%90/"/>
    <id>https://faithlove.github.io/2017/10/27/jvm-5-Java-GC-分析/</id>
    <published>2017-10-27T04:25:20.000Z</published>
    <updated>2017-10-27T04:36:41.617Z</updated>
    
    <content type="html"><![CDATA[<p>Java GC就是JVM记录仪，书画了JVM各个分区的表演。</p>
<h2 id="什么是-Java-GC"><a href="#什么是-Java-GC" class="headerlink" title="什么是 Java GC"></a>什么是 Java GC</h2><p>Java GC（Garbage Collection，垃圾收集，垃圾回收）机制，是Java与C++/C的主要区别之一，作为Java开发者，一般不需要专门编写内存回收和垃圾清理代码，对内存泄露和溢出的问题，也不需要像C程序员那样战战兢兢。这是因为在Java虚拟机中，存在自动内存管理和垃圾清扫机制。概括地说，该机制对JVM（Java Virtual Machine）中的内存进行标记，并确定哪些内存需要回收，根据一定的回收策略，自动的回收内存，永不停息（Nerver Stop）的保证JVM中的内存空间，防止出现内存泄露和溢出问题。</p>
<p>在Java语言出现之前，就有GC机制的存在，如Lisp语言），Java GC机制已经日臻完善，几乎可以自动的为我们做绝大多数的事情。然而，如果我们从事较大型的应用软件开发，曾经出现过内存优化的需求，就必定要研究Java GC机制。</p>
<p>简单总结一下，Java GC就是通过GC收集器回收不在存活的对象，保证JVM更加高效的运转。如果不了解GC算法和垃圾回收器可以参考这篇文章：<a href="https://faithlove.github.io/2017/10/26/jvm-3-GC%E7%AE%97%E6%B3%95-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/">jvm系列(三):GC算法 垃圾收集器</a>。</p>
<h2 id="如何获取-Java-GC日志"><a href="#如何获取-Java-GC日志" class="headerlink" title="如何获取 Java GC日志"></a>如何获取 Java GC日志</h2><p>一般情况可以通过两种方式来获取GC日志，一种是使用命令动态查看，一种是在容器中设置相关参数打印GC日志。</p>
<h3 id="命令动态查看"><a href="#命令动态查看" class="headerlink" title="命令动态查看"></a>命令动态查看</h3><p>Java 自动的工具行命令，jstat可以用来动态监控JVM内存的使用，统计垃圾回收的各项信息。</p>
<p>比如常用命令，<figure class="highlight plain"><figcaption><span>-gc``` 统计垃圾回收堆的行为</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```  sh</span><br><span class="line">$ jstat -gc 1262</span><br><span class="line"> S0C    S1C     S0U     S1U   EC       EU        OC         OU        PC       PU         YGC    YGCT    FGC    FGCT     GCT   </span><br><span class="line">26112.0 24064.0 6562.5  0.0   564224.0 76274.5   434176.0   388518.3  524288.0 42724.7    320    6.417   1      0.398    6.815</span><br></pre></td></tr></table></figure></p>
<p>也可以设置间隔固定时间来打印：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gc 1262 2000 20</span><br></pre></td></tr></table></figure>
<p>这个命令意思就是每隔2000ms输出1262的gc情况，一共输出20次</p>
<p>更详细的内容参考这篇文章：<a href="https://faithlove.github.io/2017/10/27/jvm-4-jvm调优-命令篇/">jvm系列(四):jvm调优-命令篇</a></p>
<h3 id="GC参数"><a href="#GC参数" class="headerlink" title="GC参数"></a>GC参数</h3><p>JVM的GC日志的主要参数包括如下几个：</p>
<ul>
<li><figure class="highlight plain"><figcaption><span>输出GC日志    </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- ```-XX:+PrintGCDetails``` 输出GC的详细日志     </span><br><span class="line">- ```-XX:+PrintGCTimeStamps``` 输出GC的时间戳（以基准时间的形式）    </span><br><span class="line">- ```-XX:+PrintGCDateStamps``` 输出GC的时间戳（以日期的形式，如 2017-09-04T21:53:59.234+0800）    </span><br><span class="line">- ```-XX:+PrintHeapAtGC``` 在进行GC的前后打印出堆的信息     </span><br><span class="line">- ```-Xloggc:../logs/gc.log``` 日志文件的输出路径     </span><br><span class="line"></span><br><span class="line">在生产环境中，根据需要配置相应的参数来监控JVM运行情况。</span><br><span class="line"></span><br><span class="line">### Tomcat 设置示例</span><br><span class="line"></span><br><span class="line">我们经常在tomcat的启动参数中添加JVM相关参数，这里有一个典型的示例：</span><br><span class="line"></span><br><span class="line">```  sh</span><br><span class="line">JAVA_OPTS=&quot;-server -Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m -XX:SurvivorRatio=4</span><br><span class="line">-verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log </span><br><span class="line">-Djava.awt.headless=true </span><br><span class="line">-XX:+PrintGCTimeStamps -XX:+PrintGCDetails </span><br><span class="line">-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000</span><br><span class="line">-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>根据上面的参数我们来做一下解析：</p>
<ul>
<li><figure class="highlight plain"><figcaption><span>-Xmx2000m -Xmn800m -XX:PermSize</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Xms，即为jvm启动时得JVM初始堆大小,Xmx为jvm的最大堆大小，xmn为新生代的大小，permsize为永久代的初始大小，MaxPermSize为永久代的最大空间。</span><br><span class="line"></span><br><span class="line">- ```-XX:SurvivorRatio=4```  </span><br><span class="line">SurvivorRatio为新生代空间中的Eden区和救助空间Survivor区的大小比值，默认是8，则两个Survivor区与一个Eden区的比值为2:8,一个Survivor区占整个年轻代的1/10。调小这个参数将增大survivor区，让对象尽量在survitor区呆长一点，减少进入年老代的对象。去掉救助空间的想法是让大部分不能马上回收的数据尽快进入年老代，加快年老代的回收频率，减少年老代暴涨的可能性，这个是通过将-XX:SurvivorRatio 设置成比较大的值（比如65536)来做到。</span><br><span class="line"></span><br><span class="line">- ```-verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log```  </span><br><span class="line">将虚拟机每次垃圾回收的信息写到日志文件中，文件名由file指定，文件格式是平文件，内容和-verbose:gc输出内容相同。</span><br><span class="line"></span><br><span class="line">- ```-Djava.awt.headless=true ``` </span><br><span class="line">Headless模式是系统的一种配置模式。在该模式下，系统缺少了显示设备、键盘或鼠标。</span><br><span class="line"></span><br><span class="line">- ```-XX:+PrintGCTimeStamps -XX:+PrintGCDetails```  </span><br><span class="line">设置gc日志的格式</span><br><span class="line"></span><br><span class="line">- ```-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000 ```  </span><br><span class="line">指定rmi调用时gc的时间间隔</span><br><span class="line"></span><br><span class="line">- ```-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15 ``` </span><br><span class="line">采用并发gc方式，经过15次minor gc 后进入年老代</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 如何分析GC日志</span><br><span class="line"></span><br><span class="line">摘录GC日志一部分</span><br><span class="line"></span><br><span class="line">Young GC回收日志:</span><br><span class="line"></span><br><span class="line">```  sh</span><br><span class="line">2016-07-05T10:43:18.093+0800: 25.395: [GC [PSYoungGen: 274931K-&gt;10738K(274944K)] 371093K-&gt;147186K(450048K), 0.0668480 secs] [Times: user=0.17 sys=0.08, real=0.07 secs]</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Full GC回收日志:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2016-07-05T10:43:18.160+0800: 25.462: [Full GC [PSYoungGen: 10738K-&gt;0K(274944K)] [ParOldGen: 136447K-&gt;140379K(302592K)] 147186K-&gt;140379K(577536K) [PSPermGen: 85411K-&gt;85376K(171008K)], 0.6763541 secs] [Times: user=1.75 sys=0.02, real=0.68 secs]</span><br></pre></td></tr></table></figure>
<p>通过上面日志分析得出，PSYoungGen、ParOldGen、PSPermGen属于Parallel收集器。其中PSYoungGen表示gc回收前后年轻代的内存变化；ParOldGen表示gc回收前后老年代的内存变化；PSPermGen表示gc回收前后永久区的内存变化。young gc 主要是针对年轻代进行内存回收比较频繁，耗时短；full gc 会对整个堆内存进行回城，耗时长，因此一般尽量减少full gc的次数</p>
<p>通过两张图非常明显看出gc日志构成：</p>
<p>Young GC日志:<br><img src="https://faithlove.github.io/pic/2017/jvm/Young GC.png" alt=""></p>
<p>Full GC日志:<br><img src="https://faithlove.github.io/pic/2017/jvm/Full GC.png" alt=""></p>
<h2 id="GC分析工具"><a href="#GC分析工具" class="headerlink" title="GC分析工具"></a>GC分析工具</h2><h3 id="GChisto"><a href="#GChisto" class="headerlink" title="GChisto"></a>GChisto</h3><p>GChisto是一款专业分析gc日志的工具，可以通过gc日志来分析：Minor GC、full gc的时间、频率等等，通过列表、报表、图表等不同的形式来反应gc的情况。虽然界面略显粗糙，但是功能还是不错的。</p>
<p>配置好本地的jdk环境之后，双击GChisto.jar,在弹出的输入框中点击 add 选择gc.log日志</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g1.jpg" alt=""></p>
<ul>
<li>GC Pause Stats:可以查看GC 的次数、GC的时间、GC的开销、最大GC时间和最小GC时间等，以及相应的柱状图</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g2.jpg" alt=""></p>
<ul>
<li><p>GC Pause Distribution:查看GC停顿的详细分布，x轴表示垃圾收集停顿时间，y轴表示是停顿次数。</p>
</li>
<li><p>GC Timeline：显示整个时间线上的垃圾收集</p>
</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/g3.jpg" alt=""></p>
<p>不过这款工具已经不再维护</p>
<h3 id="GC-Easy"><a href="#GC-Easy" class="headerlink" title="GC Easy"></a>GC Easy</h3><p>这是一个web工具,在线使用非常方便.  </p>
<p>地址: <a href="http://gceasy.io" target="_blank" rel="noopener">http://gceasy.io</a></p>
<p>进入官网，讲打包好的zip或者gz为后缀的压缩包上传，过一会就会拿到分析结果。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/gceasy1.png" alt=""></p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/gceasy2.png" alt=""></p>
<p>推荐使用此工具进行gc分析。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Java GC就是JVM记录仪，书画了JVM各个分区的表演。&lt;/p&gt;
&lt;h2 id=&quot;什么是-Java-GC&quot;&gt;&lt;a href=&quot;#什么是-Java-GC&quot; class=&quot;headerlink&quot; title=&quot;什么是 Java GC&quot;&gt;&lt;/a&gt;什么是 Java GC&lt;/h2
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(4):jvm调优-命令篇</title>
    <link href="https://faithlove.github.io/2017/10/27/jvm-4-jvm%E8%B0%83%E4%BC%98-%E5%91%BD%E4%BB%A4%E7%AF%87/"/>
    <id>https://faithlove.github.io/2017/10/27/jvm-4-jvm调优-命令篇/</id>
    <published>2017-10-27T03:04:33.000Z</published>
    <updated>2017-10-27T03:09:04.014Z</updated>
    
    <content type="html"><![CDATA[<p>运用jvm自带的命令可以方便的在生产监控和打印堆栈的日志信息帮忙我们来定位问题！虽然jvm调优成熟的工具已经有很多：jconsole、大名鼎鼎的VisualVM，IBM的Memory Analyzer等等，但是在生产环境出现问题的时候，一方面工具的使用会有所限制，另一方面喜欢装X的我们，总喜欢在出现问题的时候在终端输入一些命令来解决。所有的工具几乎都是依赖于jdk的接口和底层的这些命令，研究这些命令的使用也让我们更能了解jvm构成和特性。</p>
<p>Sun JDK监控和故障处理命令有jps jstat jmap jhat jstack jinfo下面做一一介绍</p>
<h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><p>JVM Process Status Tool,显示指定系统内所有的HotSpot虚拟机进程。</p>
<h3 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps [options] [hostid]</span><br></pre></td></tr></table></figure>
<h3 id="option参数"><a href="#option参数" class="headerlink" title="option参数"></a>option参数</h3><blockquote>
<ul>
<li>-l : 输出主类全名或jar路径</li>
<li>-q : 只输出LVMID</li>
<li>-m : 输出JVM启动时传递给main()的参数</li>
<li>-v : 输出JVM启动时显示指定的JVM参数</li>
</ul>
</blockquote>
<p>其中[option]、[hostid]参数也可以不写。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jps -l -m</span><br><span class="line">  28920 org.apache.catalina.startup.Bootstrap start</span><br><span class="line">  11589 org.apache.catalina.startup.Bootstrap start</span><br><span class="line">  25816 sun.tools.jps.Jps -l -m</span><br></pre></td></tr></table></figure>
<h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><p>jstat(JVM statistics Monitoring)是用于监视虚拟机运行时状态信息的命令，它可以显示出虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。</p>
<h3 id="命令格式-1"><a href="#命令格式-1" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat [option] LVMID [interval] [count]</span><br></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><blockquote>
<ul>
<li>[option] : 操作参数</li>
<li>LVMID : 本地虚拟机进程ID</li>
<li>[interval] : 连续输出的时间间隔</li>
<li>[count] : 连续输出的次数</li>
</ul>
</blockquote>
<h4 id="option-参数总览"><a href="#option-参数总览" class="headerlink" title="option 参数总览"></a>option 参数总览</h4><table>
<thead>
<tr>
<th>Option</th>
<th>Displays…</th>
</tr>
</thead>
<tbody>
<tr>
<td>class</td>
<td>class loader的行为统计。Statistics on the behavior of the class loader.</td>
</tr>
<tr>
<td>compiler</td>
<td>HotSpt JIT编译器行为统计。Statistics of the behavior of the HotSpot Just-in-Time compiler.</td>
</tr>
<tr>
<td>gc</td>
<td>垃圾回收堆的行为统计。Statistics of the behavior of the garbage collected heap.</td>
</tr>
<tr>
<td>gccapacity</td>
<td>各个垃圾回收代容量(young,old,perm)和他们相应的空间统计。Statistics of the capacities of the generations and their corresponding spaces.</td>
</tr>
<tr>
<td>gcutil</td>
<td>垃圾回收统计概述。Summary of garbage collection statistics.</td>
</tr>
<tr>
<td>gccause</td>
<td>垃圾收集统计概述（同-gcutil），附加最近两次垃圾回收事件的原因。Summary of garbage collection statistics (same as -gcutil), with the cause of the last and</td>
</tr>
<tr>
<td>gcnew</td>
<td>新生代行为统计。Statistics of the behavior of the new generation.</td>
</tr>
<tr>
<td>gcnewcapacity</td>
<td>新生代与其相应的内存空间的统计。Statistics of the sizes of the new generations and its corresponding spaces.</td>
</tr>
<tr>
<td>gcold</td>
<td>年老代和永生代行为统计。Statistics of the behavior of the old and permanent generations.</td>
</tr>
<tr>
<td>gcoldcapacity</td>
<td>年老代行为统计。Statistics of the sizes of the old generation.</td>
</tr>
<tr>
<td>gcpermcapacity</td>
<td>永生代行为统计。Statistics of the sizes of the permanent generation.</td>
</tr>
<tr>
<td>printcompilation</td>
<td>HotSpot编译方法统计。HotSpot compilation method statistics.</td>
</tr>
</tbody>
</table>
<h4 id="option-参数详解"><a href="#option-参数详解" class="headerlink" title="option 参数详解"></a>option 参数详解</h4><h5 id="class"><a href="#class" class="headerlink" title="-class"></a>-class</h5><p>监视类装载、卸载数量、总空间以及耗费的时间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -class 11589</span><br><span class="line"> Loaded  Bytes  Unloaded  Bytes     Time   </span><br><span class="line">  7035  14506.3     0     0.0       3.67</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>Loaded : 加载class的数量</li>
<li>Bytes : class字节大小</li>
<li>Unloaded : 未加载class的数量</li>
<li>Bytes : 未加载class的字节大小</li>
<li>Time : 加载时间</li>
</ul>
</blockquote>
<h5 id="compiler"><a href="#compiler" class="headerlink" title="-compiler"></a>-compiler</h5><p>输出JIT编译过的方法数量耗时等</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -compiler 1262</span><br><span class="line">Compiled Failed Invalid   Time   FailedType FailedMethod</span><br><span class="line">    2573      1       0    47.60          1 org/apache/catalina/loader/WebappClassLoader findResourceInternal</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>Compiled : 编译数量</li>
<li>Failed : 编译失败数量</li>
<li>Invalid : 无效数量</li>
<li>Time : 编译耗时</li>
<li>FailedType : 失败类型</li>
<li>FailedMethod : 失败方法的全限定名</li>
</ul>
</blockquote>
<h5 id="gc"><a href="#gc" class="headerlink" title="-gc"></a>-gc</h5><p>垃圾回收堆的行为统计，<strong>常用命令</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gc 1262</span><br><span class="line"> S0C    S1C     S0U     S1U   EC       EU        OC         OU        PC       PU         YGC    YGCT    FGC    FGCT     GCT   </span><br><span class="line">26112.0 24064.0 6562.5  0.0   564224.0 76274.5   434176.0   388518.3  524288.0 42724.7    320    6.417   1      0.398    6.815</span><br></pre></td></tr></table></figure>
<p><strong>C即Capacity 总容量，U即Used 已使用的容量</strong></p>
<blockquote>
<ul>
<li>S0C : survivor0区的总容量</li>
<li>S1C : survivor1区的总容量</li>
<li>S0U : survivor0区已使用的容量</li>
<li>S1U : survivor1区已使用的容量</li>
<li>EC : Eden区的总容量</li>
<li>EU : Eden区已使用的容量</li>
<li>OC : Old区的总容量</li>
<li>OU : Old区已使用的容量</li>
<li>PC    当前perm的容量 (KB)</li>
<li>PU    perm的使用 (KB)</li>
<li>YGC : 新生代垃圾回收次数</li>
<li>YGCT : 新生代垃圾回收时间</li>
<li>FGC : 老年代垃圾回收次数</li>
<li>FGCT : 老年代垃圾回收时间</li>
<li>GCT : 垃圾回收总消耗时间</li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gc 1262 2000 20</span><br></pre></td></tr></table></figure>
<p>这个命令意思就是每隔2000ms输出1262的gc情况，一共输出20次</p>
<h5 id="gccapacity"><a href="#gccapacity" class="headerlink" title="-gccapacity"></a>-gccapacity</h5><p>同-gc，不过还会输出Java堆各区域使用到的最大、最小空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gccapacity 1262</span><br><span class="line"> NGCMN    NGCMX     NGC    S0C   S1C       EC         OGCMN      OGCMX      OGC        OC       PGCMN    PGCMX     PGC      PC         YGC    FGC </span><br><span class="line">614400.0 614400.0 614400.0 26112.0 24064.0 564224.0   434176.0   434176.0   434176.0   434176.0 524288.0 1048576.0 524288.0 524288.0    320     1</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>NGCMN : 新生代占用的最小空间</li>
<li>NGCMX : 新生代占用的最大空间</li>
<li>OGCMN : 老年代占用的最小空间</li>
<li>OGCMX : 老年代占用的最大空间</li>
<li>OGC：当前年老代的容量 (KB)</li>
<li>OC：当前年老代的空间 (KB)</li>
<li>PGCMN : perm占用的最小空间</li>
<li>PGCMX : perm占用的最大空间</li>
</ul>
</blockquote>
<h5 id="gcutil"><a href="#gcutil" class="headerlink" title="-gcutil"></a>-gcutil</h5><p>同-gc，不过输出的是已使用空间占总空间的百分比</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcutil 28920</span><br><span class="line">  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line"> 12.45   0.00  33.85   0.00   4.44  4       0.242     0    0.000    0.242</span><br></pre></td></tr></table></figure>
<h5 id="gccause"><a href="#gccause" class="headerlink" title="-gccause"></a>-gccause</h5><p>垃圾收集统计概述（同-gcutil），附加最近两次垃圾回收事件的原因</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gccause 28920</span><br><span class="line">  S0     S1     E      O      P       YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC                 </span><br><span class="line"> 12.45   0.00  33.85   0.00   4.44      4    0.242     0    0.000    0.242   Allocation Failure   No GC</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>LGCC：最近垃圾回收的原因</li>
<li>GCC：当前垃圾回收的原因</li>
</ul>
</blockquote>
<h5 id="gcnew"><a href="#gcnew" class="headerlink" title="-gcnew"></a>-gcnew</h5><p>统计新生代的行为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnew 28920</span><br><span class="line"> S0C      S1C      S0U        S1U  TT  MTT  DSS      EC        EU         YGC     YGCT  </span><br><span class="line"> 419392.0 419392.0 52231.8    0.0  6   6    209696.0 3355520.0 1172246.0  4       0.242</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>TT：Tenuring threshold(提升阈值)</li>
<li>MTT：最大的tenuring threshold</li>
<li>DSS：survivor区域大小 (KB)</li>
</ul>
</blockquote>
<h5 id="gcnewcapacity"><a href="#gcnewcapacity" class="headerlink" title="-gcnewcapacity"></a>-gcnewcapacity</h5><p>新生代与其相应的内存空间的统计</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnewcapacity 28920</span><br><span class="line">  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC        YGC   FGC </span><br><span class="line"> 4194304.0  4194304.0  4194304.0 419392.0 419392.0 419392.0 419392.0  3355520.0  3355520.0     4     0</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>NGC:当前年轻代的容量 (KB)</li>
<li>S0CMX:最大的S0空间 (KB)</li>
<li>S0C:当前S0空间 (KB)</li>
<li>ECMX:最大eden空间 (KB)</li>
<li>EC:当前eden空间 (KB)</li>
</ul>
</blockquote>
<h5 id="gcold"><a href="#gcold" class="headerlink" title="-gcold"></a>-gcold</h5><p>统计旧生代的行为</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcold 28920</span><br><span class="line">   PC       PU        OC           OU       YGC    FGC    FGCT     GCT   </span><br><span class="line">1048576.0  46561.7   6291456.0     0.0      4      0      0.000    0.242</span><br></pre></td></tr></table></figure>
<h5 id="gcoldcapacity"><a href="#gcoldcapacity" class="headerlink" title="-gcoldcapacity"></a>-gcoldcapacity</h5><p>统计旧生代的大小和空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcoldcapacity 28920</span><br><span class="line">   OGCMN       OGCMX        OGC         OC         YGC   FGC    FGCT     GCT   </span><br><span class="line">  6291456.0   6291456.0   6291456.0   6291456.0     4     0    0.000    0.242</span><br></pre></td></tr></table></figure>
<h5 id="gcpermcapacity"><a href="#gcpermcapacity" class="headerlink" title="-gcpermcapacity"></a>-gcpermcapacity</h5><p>永生代行为统计</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcpermcapacity 28920</span><br><span class="line">    PGCMN      PGCMX       PGC         PC      YGC   FGC    FGCT     GCT   </span><br><span class="line"> 1048576.0  2097152.0  1048576.0  1048576.0     4     0    0.000    0.242</span><br></pre></td></tr></table></figure>
<h5 id="printcompilation"><a href="#printcompilation" class="headerlink" title="-printcompilation"></a>-printcompilation</h5><p>hotspot编译方法统计</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -printcompilation 28920</span><br><span class="line">    Compiled  Size  Type Method</span><br><span class="line">    1291      78     1    java/util/ArrayList indexOf</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>Compiled：被执行的编译任务的数量</li>
<li>Size：方法字节码的字节数</li>
<li>Type：编译类型</li>
<li>Method：编译方法的类名和方法名。类名使用”/“ 代替 “.” 作为空间分隔符. 方法名是给出类的方法名. 格式是一致于HotSpot - XX:+PrintComplation 选项</li>
</ul>
</blockquote>
<h2 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h2><p>jmap(JVM Memory Map)命令用于生成heap dump文件，如果不使用这个命令，还阔以使用-XX:+HeapDumpOnOutOfMemoryError参数来让虚拟机出现OOM的时候·自动生成dump文件。<br>jmap不仅能生成dump文件，还阔以查询finalize执行队列、Java堆和永久代的详细信息，如当前使用率、当前使用的是哪种收集器等。</p>
<h3 id="命令格式-2"><a href="#命令格式-2" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap [option] LVMID</span><br></pre></td></tr></table></figure>
<h3 id="option参数-1"><a href="#option参数-1" class="headerlink" title="option参数"></a>option参数</h3><blockquote>
<ul>
<li>dump : 生成堆转储快照</li>
<li>finalizerinfo : 显示在F-Queue队列等待Finalizer线程执行finalizer方法的对象</li>
<li>heap : 显示Java堆详细信息</li>
<li>histo : 显示堆中对象的统计信息</li>
<li>permstat :  to print permanent generation statistics</li>
<li>F : 当-dump没有响应时，强制生成dump快照</li>
</ul>
</blockquote>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><h5 id="dump"><a href="#dump" class="headerlink" title="-dump"></a>-dump</h5><p>常用格式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-dump::live,format=b,file=<span class="tag">&lt;<span class="name">filename</span>&gt;</span> pid</span><br></pre></td></tr></table></figure>
<p>dump堆到文件,format指定输出格式，live指明是活着的对象,file指定文件名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -dump:live,format=b,file=dump.hprof 28920</span><br><span class="line">  Dumping heap to /home/xxx/dump.hprof ...</span><br><span class="line">  Heap dump file created</span><br></pre></td></tr></table></figure>
<p>dump.hprof这个后缀是为了后续可以直接用MAT(Memory Anlysis Tool)打开。</p>
<h5 id="finalizerinfo"><a href="#finalizerinfo" class="headerlink" title="-finalizerinfo"></a>-finalizerinfo</h5><p>打印等待回收对象的信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -finalizerinfo 28920</span><br><span class="line">  Attaching to process ID 28920, please wait...</span><br><span class="line">  Debugger attached successfully.</span><br><span class="line">  Server compiler detected.</span><br><span class="line">  JVM version is 24.71-b01</span><br><span class="line">  Number of objects pending for finalization: 0</span><br></pre></td></tr></table></figure>
<p>可以看到当前F-QUEUE队列中并没有等待Finalizer线程执行finalizer方法的对象。</p>
<h5 id="heap"><a href="#heap" class="headerlink" title="-heap"></a>-heap</h5><p>打印heap的概要信息，GC使用的算法，heap的配置及wise heap的使用情况,可以用此来判断内存目前的使用情况以及垃圾回收情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -heap <span class="number">28920</span></span><br><span class="line">  Attaching to process ID <span class="number">28920</span>, please wait...</span><br><span class="line">  Debugger attached successfully.</span><br><span class="line">  Server compiler detected.</span><br><span class="line">  JVM version is <span class="number">24.71</span>-b01  </span><br><span class="line"></span><br><span class="line">  using thread-local object allocation.</span><br><span class="line">  Parallel GC <span class="keyword">with</span> <span class="number">4</span> thread(s)<span class="comment">//GC 方式  </span></span><br><span class="line"></span><br><span class="line">  Heap Configuration: <span class="comment">//堆内存初始化配置</span></span><br><span class="line">     MinHeapFreeRatio = <span class="number">0</span> <span class="comment">//对应jvm启动参数-XX:MinHeapFreeRatio设置JVM堆最小空闲比率(default 40)</span></span><br><span class="line">     MaxHeapFreeRatio = <span class="number">100</span> <span class="comment">//对应jvm启动参数 -XX:MaxHeapFreeRatio设置JVM堆最大空闲比率(default 70)</span></span><br><span class="line">     MaxHeapSize      = <span class="number">2082471936</span> (<span class="number">1986.0</span>MB) <span class="comment">//对应jvm启动参数-XX:MaxHeapSize=设置JVM堆的最大大小</span></span><br><span class="line">     NewSize          = <span class="number">1310720</span> (<span class="number">1.25</span>MB)<span class="comment">//对应jvm启动参数-XX:NewSize=设置JVM堆的‘新生代’的默认大小</span></span><br><span class="line">     MaxNewSize       = <span class="number">17592186044415</span> MB<span class="comment">//对应jvm启动参数-XX:MaxNewSize=设置JVM堆的‘新生代’的最大大小</span></span><br><span class="line">     OldSize          = <span class="number">5439488</span> (<span class="number">5.1875</span>MB)<span class="comment">//对应jvm启动参数-XX:OldSize=&lt;value&gt;:设置JVM堆的‘老生代’的大小</span></span><br><span class="line">     NewRatio         = <span class="number">2</span> <span class="comment">//对应jvm启动参数-XX:NewRatio=:‘新生代’和‘老生代’的大小比率</span></span><br><span class="line">     SurvivorRatio    = <span class="number">8</span> <span class="comment">//对应jvm启动参数-XX:SurvivorRatio=设置年轻代中Eden区与Survivor区的大小比值 </span></span><br><span class="line">     PermSize         = <span class="number">21757952</span> (<span class="number">20.75</span>MB)  <span class="comment">//对应jvm启动参数-XX:PermSize=&lt;value&gt;:设置JVM堆的‘永生代’的初始大小</span></span><br><span class="line">     MaxPermSize      = <span class="number">85983232</span> (<span class="number">82.0</span>MB)<span class="comment">//对应jvm启动参数-XX:MaxPermSize=&lt;value&gt;:设置JVM堆的‘永生代’的最大大小</span></span><br><span class="line">     G1HeapRegionSize = <span class="number">0</span> (<span class="number">0.0</span>MB)  </span><br><span class="line"></span><br><span class="line">  Heap Usage:<span class="comment">//堆内存使用情况</span></span><br><span class="line">  PS Young Generation</span><br><span class="line">  Eden Space:<span class="comment">//Eden区内存分布</span></span><br><span class="line">     capacity = <span class="number">33030144</span> (<span class="number">31.5</span>MB)<span class="comment">//Eden区总容量</span></span><br><span class="line">     used     = <span class="number">1524040</span> (<span class="number">1.4534378051757812</span>MB)  <span class="comment">//Eden区已使用</span></span><br><span class="line">     free     = <span class="number">31506104</span> (<span class="number">30.04656219482422</span>MB)  <span class="comment">//Eden区剩余容量</span></span><br><span class="line">     <span class="number">4.614088270399305</span>% used <span class="comment">//Eden区使用比率</span></span><br><span class="line">  From Space:  <span class="comment">//其中一个Survivor区的内存分布</span></span><br><span class="line">     capacity = <span class="number">5242880</span> (<span class="number">5.0</span>MB)</span><br><span class="line">     used     = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line">     free     = <span class="number">5242880</span> (<span class="number">5.0</span>MB)</span><br><span class="line">     <span class="number">0.0</span>% used</span><br><span class="line">  To Space:  <span class="comment">//另一个Survivor区的内存分布</span></span><br><span class="line">     capacity = <span class="number">5242880</span> (<span class="number">5.0</span>MB)</span><br><span class="line">     used     = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line">     free     = <span class="number">5242880</span> (<span class="number">5.0</span>MB)</span><br><span class="line">     <span class="number">0.0</span>% used</span><br><span class="line">  PS Old Generation <span class="comment">//当前的Old区内存分布</span></span><br><span class="line">     capacity = <span class="number">86507520</span> (<span class="number">82.5</span>MB)</span><br><span class="line">     used     = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line">     free     = <span class="number">86507520</span> (<span class="number">82.5</span>MB)</span><br><span class="line">     <span class="number">0.0</span>% used</span><br><span class="line">  PS Perm Generation<span class="comment">//当前的 “永生代” 内存分布</span></span><br><span class="line">     capacity = <span class="number">22020096</span> (<span class="number">21.0</span>MB)</span><br><span class="line">     used     = <span class="number">2496528</span> (<span class="number">2.3808746337890625</span>MB)</span><br><span class="line">     free     = <span class="number">19523568</span> (<span class="number">18.619125366210938</span>MB)</span><br><span class="line">     <span class="number">11.337498256138392</span>% used  </span><br><span class="line"></span><br><span class="line">  <span class="number">670</span> interned Strings occupying <span class="number">43720</span> bytes.</span><br></pre></td></tr></table></figure>
<p>可以很清楚的看到Java堆中各个区域目前的情况。</p>
<h5 id="histo"><a href="#histo" class="headerlink" title="-histo"></a>-histo</h5><p>打印堆的对象统计，包括对象数、内存大小等等 （因为在dump:live前会进行full gc，如果带上live则只统计活对象，因此不加live的堆大小要大于加live堆的大小 ）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -histo:live 28920 | more</span><br><span class="line"> num     #instances         #bytes  class name</span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:         83613       12012248  <span class="tag">&lt;<span class="name">constMethodKlass</span>&gt;</span></span><br><span class="line">   2:         23868       11450280  [B</span><br><span class="line">   3:         83613       10716064  <span class="tag">&lt;<span class="name">methodKlass</span>&gt;</span></span><br><span class="line">   4:         76287       10412128  [C</span><br><span class="line">   5:          8227        9021176  <span class="tag">&lt;<span class="name">constantPoolKlass</span>&gt;</span></span><br><span class="line">   6:          8227        5830256  <span class="tag">&lt;<span class="name">instanceKlassKlass</span>&gt;</span></span><br><span class="line">   7:          7031        5156480  <span class="tag">&lt;<span class="name">constantPoolCacheKlass</span>&gt;</span></span><br><span class="line">   8:         73627        1767048  java.lang.String</span><br><span class="line">   9:          2260        1348848  <span class="tag">&lt;<span class="name">methodDataKlass</span>&gt;</span></span><br><span class="line">  10:          8856         849296  java.lang.Class</span><br><span class="line">  ....</span><br></pre></td></tr></table></figure>
<p>仅仅打印了前10行</p>
<figure class="highlight xml"><figcaption><span>class name```是对象类型，说明如下：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```  xml</span><br><span class="line">B  byte</span><br><span class="line">C  char</span><br><span class="line">D  double</span><br><span class="line">F  float</span><br><span class="line">I  int</span><br><span class="line">J  long</span><br><span class="line">Z  boolean</span><br><span class="line">[  数组，如[I表示int[]</span><br><span class="line">[L+类名 其他对象</span><br></pre></td></tr></table></figure>
<h5 id="permstat"><a href="#permstat" class="headerlink" title="-permstat"></a>-permstat</h5><p>打印Java堆内存的永久保存区域的类加载器的智能统计信息。对于每个类加载器而言，它的名称、活跃度、地址、父类加载器、它所加载的类的数量和大小都会被打印。此外，包含的字符串数量和大小也会被打印。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -permstat 28920</span><br><span class="line">  Attaching to process ID 28920, please wait...</span><br><span class="line">  Debugger attached successfully.</span><br><span class="line">  Server compiler detected.</span><br><span class="line">  JVM version is 24.71-b01</span><br><span class="line">  finding class loader instances ..done.</span><br><span class="line">  computing per loader stat ..done.</span><br><span class="line">  please wait.. computing liveness.liveness analysis may be inaccurate ...</span><br><span class="line">  </span><br><span class="line">  class_loader            classes bytes   parent_loader           alive?  type  </span><br><span class="line">  <span class="tag">&lt;<span class="name">bootstrap</span>&gt;</span>             3111    18154296          null          live    <span class="tag">&lt;<span class="name">internal</span>&gt;</span></span><br><span class="line">  0x0000000600905cf8      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0</span><br><span class="line">  0x00000006008fcb48      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0</span><br><span class="line">  0x00000006016db798      0       0       0x00000006008d3fc0      dead    java/util/ResourceBundle$RBClassLoader@0x0000000780626ec0</span><br><span class="line">  0x00000006008d6810      1       3056      null          dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0</span><br></pre></td></tr></table></figure>
<h5 id="F"><a href="#F" class="headerlink" title="-F"></a>-F</h5><p>强制模式。如果指定的pid没有响应，请使用jmap -dump或jmap -histo选项。此模式下，不支持live子选项。</p>
<h2 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h2><p>jhat(JVM Heap Analysis Tool)命令是与jmap搭配使用，用来分析jmap生成的dump，jhat内置了一个微型的HTTP/HTML服务器，生成dump的分析结果后，可以在浏览器中查看。在此要注意，一般不会直接在服务器上进行分析，因为jhat是一个耗时并且耗费硬件资源的过程，一般把服务器生成的dump文件复制到本地或其他机器上进行分析。</p>
<h3 id="命令格式-3"><a href="#命令格式-3" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat [dumpfile]</span><br></pre></td></tr></table></figure>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><blockquote>
<ul>
<li>-stack false|true<br>关闭对象分配调用栈跟踪(tracking object allocation call stack)。 如果分配位置信息在堆转储中不可用. 则必须将此标志设置为 false. 默认值为 true.&gt; </li>
<li>-refs false|true<br>关闭对象引用跟踪(tracking of references to objects)。 默认值为 true. 默认情况下, 返回的指针是指向其他特定对象的对象,如反向链接或输入引用(referrers or incoming references), 会统计/计算堆中的所有对象。&gt; </li>
<li>-port port-number<br>设置 jhat HTTP server 的端口号. 默认值 7000.&gt; </li>
<li>-exclude exclude-file<br>指定对象查询时需要排除的数据成员列表文件(a file that lists data members that should be excluded from the reachable objects query)。 例如, 如果文件列列出了 java.lang.String.value , 那么当从某个特定对象 Object o 计算可达的对象列表时, 引用路径涉及 java.lang.String.value 的都会被排除。&gt; </li>
<li>-baseline exclude-file<br>指定一个基准堆转储(baseline heap dump)。 在两个 heap dumps 中有相同 object ID 的对象会被标记为不是新的(marked as not being new). 其他对象被标记为新的(new). 在比较两个不同的堆转储时很有用.&gt; </li>
<li>-debug int<br>设置 debug 级别. 0 表示不输出调试信息。 值越大则表示输出更详细的 debug 信息.&gt; </li>
<li>-version<br>启动后只显示版本信息就退出&gt; </li>
<li>-J&lt; flag &gt;<br>因为 jhat 命令实际上会启动一个JVM来执行, 通过 -J 可以在启动JVM时传入一些启动参数. 例如, -J-Xmx512m 则指定运行 jhat 的Java虚拟机使用的最大堆内存为 512 MB. 如果需要使用多个JVM启动参数,则传入多个 -Jxxxxxx.</li>
</ul>
</blockquote>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jhat -J-Xmx512m dump.hprof</span><br><span class="line">  eading from dump.hprof...</span><br><span class="line">  Dump file created Fri Mar 11 17:13:42 CST 2016</span><br><span class="line">  Snapshot read, resolving...</span><br><span class="line">  Resolving 271678 objects...</span><br><span class="line">  Chasing references, expect 54 dots......................................................</span><br><span class="line">  Eliminating duplicate references......................................................</span><br><span class="line">  Snapshot resolved.</span><br><span class="line">  Started HTTP server on port 7000</span><br><span class="line">  Server is ready.</span><br></pre></td></tr></table></figure>
<p>中间的-J-Xmx512m是在dump快照很大的情况下分配512M内存去启动HTTP服务器，运行完之后就可在浏览器打开Http://localhost:7000进行快照分析<br>堆快照分析主要在最后面的Heap Histogram里，里面根据class列出了dump的时候所有存活对象。</p>
<p><strong>分析同样一个dump快照，MAT需要的额外内存比jhat要小的多的多，所以建议使用MAT来进行分析，当然也看个人偏好。</strong></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>打开浏览器Http://localhost:7000，该页面提供了几个查询功能可供使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">All classes including platform</span><br><span class="line">Show all members of the rootset</span><br><span class="line">Show instance counts for all classes (including platform)</span><br><span class="line">Show instance counts for all classes (excluding platform)</span><br><span class="line">Show heap histogram</span><br><span class="line">Show finalizer summary</span><br><span class="line">Execute Object Query Language (OQL) query</span><br></pre></td></tr></table></figure>
<p>一般查看堆异常情况主要看这个两个部分：<br>Show instance counts for all classes (excluding platform)，平台外的所有对象信息。如下图：<br><img src="https://faithlove.github.io/pic/2016/jvm-jhat-excluding-paltform.png" alt=""> <br><br>Show heap histogram 以树状图形式展示堆情况。如下图：<br><img src="https://faithlove.github.io/pic/2016/jvm-jhat-heap-histogram.png" alt=""> <br><br>具体排查时需要结合代码，观察是否大量应该被回收的对象在一直被引用或者是否有占用内存特别大的对象无法被回收。<br><br><strong>一般情况，会down到客户端用工具来分析</strong></p>
<h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><p>jstack用于生成java虚拟机当前时刻的线程快照。线程快照是当前java虚拟机内每一条线程正在执行的方法堆栈的集合，生成线程快照的主要目的是定位线程出现长时间停顿的原因，如线程间死锁、死循环、请求外部资源导致的长时间等待等。 线程出现停顿的时候通过jstack来查看各个线程的调用堆栈，就可以知道没有响应的线程到底在后台做什么事情，或者等待什么资源。 如果java程序崩溃生成core文件，jstack工具可以用来获得core文件的java stack和native stack的信息，从而可以轻松地知道java程序是如何崩溃和在程序何处发生问题。另外，jstack工具还可以附属到正在运行的java程序中，看到当时运行的java程序的java stack和native stack的信息, 如果现在运行的java程序呈现hung的状态，jstack是非常有用的。</p>
<h3 id="命令格式-4"><a href="#命令格式-4" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack [option] LVMID</span><br></pre></td></tr></table></figure>
<h3 id="option参数-2"><a href="#option参数-2" class="headerlink" title="option参数"></a>option参数</h3><blockquote>
<ul>
<li>-F : 当正常输出请求不被响应时，强制输出线程堆栈</li>
<li>-l : 除堆栈外，显示关于锁的附加信息</li>
<li>-m : 如果调用到本地方法的话，可以显示C/C++的堆栈</li>
</ul>
</blockquote>
<h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ jstack -l 11494|more</span><br><span class="line">2016-07-28 13:40:04</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.71-b01 mixed mode):</span><br><span class="line"></span><br><span class="line">"Attach Listener" daemon prio=10 tid=0x00007febb0002000 nid=0x6b6f waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line">"http-bio-8005-exec-2" daemon prio=10 tid=0x00007feb94028000 nid=0x7b8c waiting on condition [0x00007fea8f56e000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  <span class="tag">&lt;<span class="name">0x00000000cae09b80</span>&gt;</span> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)</span><br><span class="line">        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:104)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskQueue.take(TaskQueue.java:32)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line">      .....</span><br></pre></td></tr></table></figure>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>这里有一篇文章解释的很好<br><a href="http://www.hollischuang.com/archives/110" target="_blank" rel="noopener">分析打印出的文件内容</a> </p>
<h2 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h2><p>jinfo(JVM Configuration info)这个命令作用是实时查看和调整虚拟机运行参数。<br>之前的jps -v口令只能查看到显示指定的参数，如果想要查看未被显示指定的参数的值就要使用jinfo口令</p>
<h3 id="命令格式-5"><a href="#命令格式-5" class="headerlink" title="命令格式"></a>命令格式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jinfo [option] [args] LVMID</span><br></pre></td></tr></table></figure>
<h3 id="option参数-3"><a href="#option参数-3" class="headerlink" title="option参数"></a>option参数</h3><blockquote>
<ul>
<li>-flag : 输出指定args参数的值</li>
<li>-flags : 不需要args参数，输出所有JVM参数的值</li>
<li>-sysprops : 输出系统属性，等同于System.getProperties()</li>
</ul>
</blockquote>
<h3 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jinfo -flag 11494</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=80</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;运用jvm自带的命令可以方便的在生产监控和打印堆栈的日志信息帮忙我们来定位问题！虽然jvm调优成熟的工具已经有很多：jconsole、大名鼎鼎的VisualVM，IBM的Memory Analyzer等等，但是在生产环境出现问题的时候，一方面工具的使用会有所限制，另一方面喜
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(3):GC算法 垃圾收集器</title>
    <link href="https://faithlove.github.io/2017/10/26/jvm-3-GC%E7%AE%97%E6%B3%95-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/"/>
    <id>https://faithlove.github.io/2017/10/26/jvm-3-GC算法-垃圾收集器/</id>
    <published>2017-10-26T10:09:14.000Z</published>
    <updated>2017-10-26T10:15:00.994Z</updated>
    
    <content type="html"><![CDATA[<p>这篇文件将给大家介绍GC都有哪几种算法，以及JVM都有那些垃圾回收器，它们的工作原理。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>垃圾收集 Garbage Collection 通常被称为“GC”，它诞生于1960年 MIT 的 Lisp 语言，经过半个多世纪，目前已经十分成熟了。<br>jvm 中，程序计数器、虚拟机栈、本地方法栈都是随线程而生随线程而灭，栈帧随着方法的进入和退出做入栈和出栈操作，实现了自动的内存清理，因此，我们的内存垃圾回收主要集中于 java 堆和方法区中，在程序运行期间，这部分内存的分配和使用都是动态的.</p>
<h2 id="对象存活判断"><a href="#对象存活判断" class="headerlink" title="对象存活判断"></a>对象存活判断</h2><p>判断对象是否存活一般有两种方式：  </p>
<p><strong>引用计数</strong>：每个对象有一个引用计数属性，新增一个引用时计数加1，引用释放时计数减1，计数为0时可以回收。此方法简单，无法解决对象相互循环引用的问题。<br><strong>可达性分析</strong>（Reachability Analysis）：从GC Roots开始向下搜索，搜索所走过的路径称为引用链。当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的。不可达对象。</p>
<p>在Java语言中，GC Roots包括：</p>
<ul>
<li>虚拟机栈中引用的对象。  </li>
<li>方法区中类静态属性实体引用的对象。  </li>
<li>方法区中常量引用的对象。  </li>
<li>本地方法栈中JNI引用的对象。  </li>
</ul>
<h2 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h2><h3 id="标记-清除算法"><a href="#标记-清除算法" class="headerlink" title="标记 -清除算法"></a>标记 -清除算法</h3><p>“标记-清除”（Mark-Sweep）算法，如它的名字一样，算法分为“标记”和“清除”两个阶段：首先标记出所有需要回收的对象，在标记完成后统一回收掉所有被标记的对象。之所以说它是最基础的收集算法，是因为后续的收集算法都是基于这种思路并对其缺点进行改进而得到的。</p>
<p>它的主要缺点有两个：一个是效率问题，标记和清除过程的效率都不高；另外一个是空间问题，标记清除之后会产生大量不连续的内存碎片，空间碎片太多可能会导致，当程序在以后的运行过程中需要分配较大对象时无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174234266-1575111287.png" alt=""></p>
<h3 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h3><p>“复制”（Copying）的收集算法，它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉。</p>
<p>这样使得每次都是对其中的一块进行内存回收，内存分配时也就不用考虑内存碎片等复杂情况，只要移动堆顶指针，按顺序分配内存即可，实现简单，运行高效。只是这种算法的代价是将内存缩小为原来的一半，持续复制长生存期的对象则导致效率降低。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174237703-328169343.png" alt=""></p>
<h3 id="标记-压缩算法"><a href="#标记-压缩算法" class="headerlink" title="标记-压缩算法"></a>标记-压缩算法</h3><p>复制收集算法在对象存活率较高时就要执行较多的复制操作，效率将会变低。更关键的是，如果不想浪费50%的空间，就需要有额外的空间进行分配担保，以应对被使用的内存中所有对象都100%存活的极端情况，所以在老年代一般不能直接选用这种算法。</p>
<p>根据老年代的特点，有人提出了另外一种“标记-整理”（Mark-Compact）算法，标记过程仍然与“标记-清除”算法一样，但后续步骤不是直接对可回收对象进行清理，而是让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174239219-1187241876.png" alt=""></p>
<h3 id="分代收集算法"><a href="#分代收集算法" class="headerlink" title="分代收集算法"></a>分代收集算法</h3><p>GC分代的基本假设：绝大部分对象的生命周期都非常短暂，存活时间短。</p>
<p>“分代收集”（Generational Collection）算法，把Java堆分为新生代和老年代，这样就可以根据各个年代的特点采用最适当的收集算法。在新生代中，每次垃圾收集时都发现有大批对象死去，只有少量存活，那就选用复制算法，只需要付出少量存活对象的复制成本就可以完成收集。而老年代中因为对象存活率高、没有额外空间对它进行分配担保，就必须使用“标记-清理”或“标记-整理”算法来进行回收。</p>
<h2 id="垃圾收集器"><a href="#垃圾收集器" class="headerlink" title="垃圾收集器"></a>垃圾收集器</h2><blockquote>
<p>如果说收集算法是内存回收的方法论，垃圾收集器就是内存回收的具体实现</p>
</blockquote>
<h3 id="Serial收集器"><a href="#Serial收集器" class="headerlink" title="Serial收集器"></a>Serial收集器</h3><p>串行收集器是最古老，最稳定以及效率高的收集器，可能会产生较长的停顿，只使用一个线程去回收。新生代、老年代使用串行回收；新生代复制算法、老年代标记-压缩；垃圾收集的过程中会Stop The World（服务暂停）</p>
<p>参数控制：<code>-XX:+UseSerialGC</code>  串行收集器</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174240391-864339858.png" alt=""></p>
<p>ParNew收集器<br>ParNew收集器其实就是Serial收集器的多线程版本。新生代并行，老年代串行；新生代复制算法、老年代标记-压缩</p>
<p>参数控制：  </p>
<p><code>-XX:+UseParNewGC</code>  ParNew收集器<br><code>-XX:ParallelGCThreads</code> 限制线程数量</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174244797-1533472044.png" alt=""></p>
<h3 id="Parallel收集器"><a href="#Parallel收集器" class="headerlink" title="Parallel收集器"></a>Parallel收集器</h3><p>Parallel Scavenge收集器类似ParNew收集器，Parallel收集器更关注系统的吞吐量。可以通过参数来打开自适应调节策略，虚拟机会根据当前系统的运行情况收集性能监控信息，动态调整这些参数以提供最合适的停顿时间或最大的吞吐量；也可以通过参数控制GC的时间不大于多少毫秒或者比例；新生代复制算法、老年代标记-压缩</p>
<p>参数控制：<code>-XX:+UseParallelGC</code>  使用Parallel收集器+ 老年代串行</p>
<h3 id="Parallel-Old-收集器"><a href="#Parallel-Old-收集器" class="headerlink" title="Parallel Old 收集器"></a>Parallel Old 收集器</h3><p>Parallel Old是Parallel Scavenge收集器的老年代版本，使用多线程和“标记－整理”算法。这个收集器是在JDK 1.6中才开始提供</p>
<p>参数控制： <code>-XX:+UseParallelOldGC</code> 使用Parallel收集器+ 老年代并行</p>
<h3 id="CMS收集器"><a href="#CMS收集器" class="headerlink" title="CMS收集器"></a>CMS收集器</h3><p>CMS（Concurrent Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器。目前很大一部分的Java应用都集中在互联网站或B/S系统的服务端上，这类应用尤其重视服务的响应速度，希望系统停顿时间最短，以给用户带来较好的体验。</p>
<p>从名字（包含“Mark Sweep”）上就可以看出CMS收集器是基于“标记-清除”算法实现的，它的运作过程相对于前面几种收集器来说要更复杂一些，整个过程分为4个步骤，包括： </p>
<ul>
<li>初始标记（CMS initial mark）  </li>
<li>并发标记（CMS concurrent mark）  </li>
<li>重新标记（CMS remark）  </li>
<li>并发清除（CMS concurrent sweep）</li>
</ul>
<p>其中初始标记、重新标记这两个步骤仍然需要“Stop The World”。初始标记仅仅只是标记一下GC Roots能直接关联到的对象，速度很快，并发标记阶段就是进行GC Roots Tracing的过程，而重新标记阶段则是为了修正并发标记期间，因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录，这个阶段的停顿时间一般会比初始标记阶段稍长一些，但远比并发标记的时间短。 </p>
<p>由于整个过程中耗时最长的并发标记和并发清除过程中，收集器线程都可以与用户线程一起工作，所以总体上来说，CMS收集器的内存回收过程是与用户线程一起并发地执行。老年代收集器（新生代使用ParNew）</p>
<p><strong>优点</strong>: 并发收集、低停顿<br><strong>缺点</strong>: 产生大量空间碎片、并发阶段会降低吞吐量</p>
<p>参数控制：</p>
<p><code>-XX:+UseConcMarkSweepGC</code>  使用CMS收集器<br><code>-XX:+ UseCMSCompactAtFullCollection</code> Full GC后，进行一次碎片整理；整理过程是独占的，会引起停顿时间变长<br><code>-XX:+CMSFullGCsBeforeCompaction</code>  设置进行几次Full GC后，进行一次碎片整理<br><code>-XX:ParallelCMSThreads</code>  设定CMS的线程数量（一般情况约等于可用CPU数量）</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174246485-1027326741.png" alt=""></p>
<h3 id="G1收集器"><a href="#G1收集器" class="headerlink" title="G1收集器"></a>G1收集器</h3><p>G1是目前技术发展的最前沿成果之一，HotSpot开发团队赋予它的使命是未来可以替换掉JDK1.5中发布的CMS收集器。与CMS收集器相比G1收集器有以下特点：</p>
<ol>
<li><strong>空间整合</strong>，G1收集器采用标记整理算法，不会产生内存空间碎片。分配大对象时不会因为无法找到连续空间而提前触发下一次GC。  </li>
<li><strong>可预测停顿</strong>，这是G1的另一大优势，降低停顿时间是G1和CMS的共同关注点，但G1除了追求低停顿外，还能建立可预测的停顿时间模型，能让使用者明确指定在一个长度为N毫秒的时间片段内，消耗在垃圾收集上的时间不得超过N毫秒，这几乎已经是实时Java（RTSJ）的垃圾收集器的特征了。</li>
</ol>
<p>上面提到的垃圾收集器，收集的范围都是整个新生代或者老年代，而G1不再是这样。使用G1收集器时，Java堆的内存布局与其他收集器有很大差别，它将整个Java堆划分为多个大小相等的独立区域（Region），虽然还保留有新生代和老年代的概念，但新生代和老年代不再是物理隔阂了，它们都是一部分（可以不连续）Region的集合。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174247641-1572774731.jpg" alt=""></p>
<p>G1的新生代收集跟ParNew类似，当新生代占用达到一定比例的时候，开始出发收集。和CMS类似，G1收集器收集老年代对象会有短暂停顿。</p>
<p>收集步骤：</p>
<ul>
<li>1、标记阶段，首先初始标记(Initial-Mark),这个阶段是停顿的(Stop the World Event)，并且会触发一次普通Mintor GC。对应GC log:GC pause (young) (inital-mark)  </li>
<li>2、Root Region Scanning，程序运行过程中会回收survivor区(存活到老年代)，这一过程必须在young GC之前完成。  </li>
<li>3、Concurrent Marking，在整个堆中进行并发标记(和应用程序并发执行)，此过程可能被young GC中断。在并发标记阶段，若发现区域对象中的所有对象都是垃圾，那个这个区域会被立即回收(图中打X)。同时，并发标记过程中，会计算每个区域的对象活性(区域中存活对象的比例)。</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174249203-774809988.png" alt=""></p>
<ul>
<li><p>4、Remark, 再标记，会有短暂停顿(STW)。再标记阶段是用来收集 并发标记阶段 产生新的垃圾(并发阶段和应用程序一同运行)；G1中采用了比CMS更快的初始快照算法:snapshot-at-the-beginning (SATB)。</p>
</li>
<li><p>5、Copy/Clean up，多线程清除失活对象，会有STW。G1将回收区域的存活对象拷贝到新区域，清除Remember Sets，并发清空回收区域并把它返回到空闲区域链表中。</p>
</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174250656-1729618538.png" alt=""></p>
<ul>
<li>6、复制/清除过程后。回收区域的活性对象已经被集中回收到深蓝色和深绿色区域。</li>
</ul>
<p><img src="https://faithlove.github.io/pic/2017/jvm/331425-20160624174252078-703896755.png" alt=""></p>
<h2 id="常用的收集器组合"><a href="#常用的收集器组合" class="headerlink" title="常用的收集器组合"></a>常用的收集器组合</h2><table>
<thead>
<tr>
<th>服务器31</th>
<th>新生代GC策略</th>
<th>老年老代GC策略</th>
<th>说明     </th>
</tr>
</thead>
<tbody>
<tr>
<td>组合1</td>
<td>Serial</td>
<td>Serial Old</td>
<td>Serial和Serial Old都是单线程进行GC，特点就是GC时暂停所有应用线程。</td>
</tr>
<tr>
<td>组合2</td>
<td>Serial</td>
<td>CMS+Serial Old</td>
<td>CMS（Concurrent Mark Sweep）是并发GC，实现GC线程和应用线程并发工作，不需要暂停所有应用线程。另外，当CMS进行GC失败时，会自动使用Serial Old策略进行GC。</td>
</tr>
<tr>
<td>组合3</td>
<td>ParNew</td>
<td>CMS</td>
<td>使用<code>-XX:+UseParNewGC</code>选项来开启。ParNew是Serial的并行版本，可以指定GC线程数，默认GC线程数为CPU的数量。可以使用-XX:ParallelGCThreads选项指定GC的线程数。如果指定了选项<code>-XX:+UseConcMarkSweepGC</code>选项，则新生代默认使用ParNew GC策略。</td>
</tr>
<tr>
<td>组合4</td>
<td>ParNew</td>
<td>Serial Old</td>
<td>使用<code>-XX:+UseParNewGC</code>选项来开启。新生代使用ParNew GC策略，年老代默认使用Serial Old GC策略。</td>
</tr>
<tr>
<td>组合5</td>
<td>Parallel Scavenge</td>
<td>Serial Old</td>
<td>Parallel Scavenge策略主要是关注一个可控的吞吐量：应用程序运行时间 / (应用程序运行时间 + GC时间)，可见这会使得CPU的利用率尽可能的高，适用于后台持久运行的应用程序，而不适用于交互较多的应用程序。</td>
</tr>
<tr>
<td>组合6</td>
<td>Parallel Scavenge</td>
<td>Parallel Old</td>
<td>Parallel Old是Serial Old的并行版本</td>
</tr>
<tr>
<td>组合7</td>
<td>G1GC</td>
<td>G1GC</td>
<td><code>-XX:+UnlockExperimentalVMOptions</code> <code>-XX:+UseG1GC</code>        #开启；<code>-XX:MaxGCPauseMillis =50</code>                 #暂停时间目标；<code>-XX:GCPauseIntervalMillis =200</code>          #暂停间隔目标；<code>-XX:+G1YoungGenSize=512m</code>            #年轻代大小；<code>-XX:SurvivorRatio=6</code>                           #幸存区比例</td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这篇文件将给大家介绍GC都有哪几种算法，以及JVM都有那些垃圾回收器，它们的工作原理。&lt;/p&gt;
&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;p&gt;垃圾收集 Garbage Collec
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(2):JVM内存结构</title>
    <link href="https://faithlove.github.io/2017/10/26/jvm-2-JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/"/>
    <id>https://faithlove.github.io/2017/10/26/jvm-2-JVM内存结构/</id>
    <published>2017-10-26T09:04:18.000Z</published>
    <updated>2017-10-26T09:10:09.071Z</updated>
    
    <content type="html"><![CDATA[<p>所有的Java开发人员可能会遇到这样的困惑？我该为堆内存设置多大空间呢？OutOfMemoryError的异常到底涉及到运行时数据的哪块区域？该怎么解决呢？其实如果你经常解决服务器性能问题，那么这些问题就会变的非常常见，了解JVM内存也是为了服务器出现性能问题的时候可以快速的了解那块的内存区域出现问题，以便于快速的解决生产故障。</p>
<p>先看一张图，这张图能很清晰的说明JVM内存结构布局。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvm03.png" alt=""></p>
<p>JVM内存结构主要有三大块：<strong>堆内存</strong>、<strong>方法区</strong>和<strong>栈</strong>。堆内存是JVM中最大的一块由年轻代和老年代组成，而年轻代内存又被分成三部分，<strong>Eden空间</strong>、<strong>From Survivor空间</strong>、<strong>To Survivor空间</strong>,默认情况下年轻代按照<strong>8:1:1</strong>的比例来分配；</p>
<p>方法区存储类信息、常量、静态变量等数据，是线程共享的区域，为与Java堆区分，方法区还有一个别名Non-Heap(非堆)；栈又分为java虚拟机栈和本地方法栈主要用于方法的执行。</p>
<p>在通过一张图来了解如何通过参数来控制各区域的内存大小</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvm04.png" alt=""></p>
<p>控制参数</p>
<ul>
<li>-Xms设置堆的最小空间大小。  </li>
<li>-Xmx设置堆的最大空间大小。  </li>
<li>-XX:NewSize设置新生代最小空间大小。  </li>
<li>-XX:MaxNewSize设置新生代最大空间大小。  </li>
<li>-XX:PermSize设置永久代最小空间大小。  </li>
<li>-XX:MaxPermSize设置永久代最大空间大小。  </li>
<li>-Xss设置每个线程的堆栈大小。</li>
</ul>
<p>没有直接设置老年代的参数，但是可以设置堆空间大小和新生代空间大小两个参数来间接控制。</p>
<blockquote>
<p>老年代空间大小=堆空间大小-年轻代大空间大小</p>
</blockquote>
<p>从更高的一个维度再次来看JVM和系统调用之间的关系</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvm05.png" alt=""></p>
<p><em>方法区和对是所有线程共享的内存区域；而java栈、本地方法栈和程序员计数器是运行是线程私有的内存区域。</em></p>
<p>下面我们详细介绍每个区域的作用</p>
<h2 id="Java堆（Heap）"><a href="#Java堆（Heap）" class="headerlink" title="Java堆（Heap）"></a>Java堆（Heap）</h2><p>对于大多数应用来说，Java堆（Java Heap）是Java虚拟机所管理的内存中<strong>最大</strong>的一块。Java堆是被所有线程共享的一块内存区域，在虚拟机启动时创建。此内存区域的唯一目的就是存放对象实例，<strong>几乎所有的对象实例都在这里分配内存</strong>。</p>
<p>Java堆是垃圾收集器管理的主要区域，因此很多时候也被称做“<strong>GC堆</strong>”。如果从内存回收的角度看，由于现在收集器基本都是采用的分代收集算法，所以Java堆中还可以细分为：<strong>新生代和老年代；再细致一点的有Eden空间、From Survivor空间、To Survivor空间等。</strong></p>
<p>根据Java虚拟机规范的规定，Java堆可以处于物理上不连续的内存空间中，只要逻辑上是连续的即可，就像我们的磁盘空间一样。在实现时，既可以实现成固定大小的，也可以是可扩展的，不过当前主流的虚拟机都是按照可扩展来实现的（通过-Xmx和-Xms控制）。</p>
<p>如果在堆中没有内存完成实例分配，并且堆也无法再扩展时，将会抛出OutOfMemoryError异常。</p>
<h2 id="方法区（Method-Area）"><a href="#方法区（Method-Area）" class="headerlink" title="方法区（Method Area）"></a>方法区（Method Area）</h2><p>方法区（Method Area）与Java堆一样，是各个线程共享的内存区域，<strong>它用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</strong>虽然Java虚拟机规范把方法区描述为堆的一个逻辑部分，但是它却有一个别名叫做Non-Heap（非堆），目的应该是与Java堆区分开来。</p>
<p>对于习惯在HotSpot虚拟机上开发和部署程序的开发者来说，很多人愿意把方法区称为“永久代”（Permanent Generation），本质上两者并不等价，仅仅是因为HotSpot虚拟机的设计团队选择把GC分代收集扩展至方法区，或者说使用永久代来实现方法区而已。</p>
<p>Java虚拟机规范对这个区域的限制非常宽松，除了和Java堆一样不需要连续的内存和可以选择固定大小或者可扩展外，还可以选择不实现垃圾收集。相对而言，垃圾收集行为在这个区域是比较少出现的，但并非数据进入了方法区就如永久代的名字一样“永久”存在了。这个区域的内存回收目标主要是针对常量池的回收和对类型的卸载，一般来说这个区域的回收“成绩”比较难以令人满意，尤其是类型的卸载，条件相当苛刻，但是这部分区域的回收确实是有必要的。</p>
<p>根据Java虚拟机规范的规定，当方法区无法满足内存分配需求时，将抛出OutOfMemoryError异常。 </p>
<p>方法区有时被称为持久代（PermGen）。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/JUtH_20121024_RuntimeDataAreas_2_MemoryModel-1.png" alt=""></p>
<p>所有的对象在实例化后的整个运行周期内，都被存放在堆内存中。堆内存又被划分成不同的部分：伊甸区(Eden)，幸存者区域(Survivor Sapce)，老年代（Old Generation Space）。</p>
<p>方法的执行都是伴随着线程的。原始类型的本地变量以及引用都存放在线程栈中。而引用关联的对象比如String，都存在在堆中。为了更好的理解上面这段话，我们可以看一个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger LOGGER = Logger.getLogger(HelloWorld.class.getName());</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"dd.MM.YYYY"</span>);</span><br><span class="line">        String today = formatter.format(<span class="keyword">new</span> Date());</span><br><span class="line">        LOGGER.info(today + <span class="string">": "</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段程序的数据在内存中的存放如下：</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/JUtH_20121024_RuntimeDataAreas_4_MemoryModel.png" alt=""></p>
<p>通过JConsole工具可以查看运行中的Java程序（比如Eclipse）的一些信息：堆内存的分配，线程的数量以及加载的类的个数；</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/JUtH_20121024_RuntimeDataAreas_5_JConsole.png" alt=""></p>
<h2 id="程序计数器（Program-Counter-Register）"><a href="#程序计数器（Program-Counter-Register）" class="headerlink" title="程序计数器（Program Counter Register）"></a>程序计数器（Program Counter Register）</h2><p>程序计数器（Program Counter Register）是一块较小的内存空间，它的作用可以看做是当前线程所执行的字节码的行号指示器。在虚拟机的概念模型里（仅是概念模型，各种虚拟机可能会通过一些更高效的方式去实现），字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。 </p>
<p>由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说是一个内核）只会执行一条线程中的指令。因此，为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器，各条线程之间的计数器互不影响，独立存储，我们称这类内存区域为“线程私有”的内存。 </p>
<p>如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；如果正在执行的是Natvie方法，这个计数器值则为空（Undefined）。</p>
<p><strong>此内存区域是唯一一个在Java虚拟机规范中没有规定任何OutOfMemoryError情况的区域。</strong></p>
<h2 id="JVM栈（JVM-Stacks）"><a href="#JVM栈（JVM-Stacks）" class="headerlink" title="JVM栈（JVM Stacks）"></a>JVM栈（JVM Stacks）</h2><p>与程序计数器一样，Java虚拟机栈（Java Virtual Machine Stacks）也是线程私有的，<strong>它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：</strong>每个方法被执行的时候都会同时创建一个栈帧（Stack Frame）用于存储局部变量表、操作栈、动态链接、方法出口等信息。<strong>每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。</strong></p>
<p>局部变量表存放了编译期可知的各种基本数据类型（boolean、byte、char、short、int、float、long、double）、对象引用（reference类型，它不等同于对象本身，根据不同的虚拟机实现，它可能是一个指向对象起始地址的引用指针，也可能指向一个代表对象的句柄或者其他与此对象相关的位置）和returnAddress类型（指向了一条字节码指令的地址）。</p>
<p>其中64位长度的long和double类型的数据会占用2个局部变量空间（Slot），其余的数据类型只占用1个。局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p>
<p>在Java虚拟机规范中，对这个区域规定了两种异常状况：如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常；如果虚拟机栈可以动态扩展（当前大部分的Java虚拟机都可动态扩展，只不过Java虚拟机规范中也允许固定长度的虚拟机栈），当扩展时无法申请到足够的内存时会抛出OutOfMemoryError异常。</p>
<h2 id="本地方法栈（Native-Method-Stacks）"><a href="#本地方法栈（Native-Method-Stacks）" class="headerlink" title="本地方法栈（Native Method Stacks）"></a>本地方法栈（Native Method Stacks）</h2><p>本地方法栈（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别不过是虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而<strong>本地方法栈则是为虚拟机使用到的Native方法服务。</strong>虚拟机规范中对本地方法栈中的方法使用的语言、使用方式与数据结构并没有强制规定，因此具体的虚拟机可以自由实现它。甚至有的虚拟机（譬如Sun HotSpot虚拟机）直接就把本地方法栈和虚拟机栈合二为一。与虚拟机栈一样，本地方法栈区域也会抛出StackOverflowError和OutOfMemoryError异常。</p>
<h2 id="哪儿的OutOfMemoryError"><a href="#哪儿的OutOfMemoryError" class="headerlink" title="哪儿的OutOfMemoryError"></a>哪儿的OutOfMemoryError</h2><p>对内存结构清晰的认识同样可以帮助理解不同OutOfMemoryErrors：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread “main”: java.lang.OutOfMemoryError: Java heap space</span><br></pre></td></tr></table></figure>
<p>原因：对象不能被分配到堆内存中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread “main”: java.lang.OutOfMemoryError: PermGen space</span><br></pre></td></tr></table></figure>
<p>原因：类或者方法不能被加载到持久代。它可能出现在一个程序加载很多类的时候，比如引用了很多第三方的库；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread “main”: java.lang.OutOfMemoryError: Requested array size exceeds VM limit</span><br></pre></td></tr></table></figure>
<p>原因：创建的数组大于堆内存的空间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread “main”: java.lang.OutOfMemoryError: request &lt;size&gt; bytes <span class="keyword">for</span> &lt;reason&gt;. Out of swap space?</span><br></pre></td></tr></table></figure>
<p>原因：分配本地分配失败。JNI、本地库或者Java虚拟机都会从本地堆中分配内存空间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread “main”: java.lang.OutOfMemoryError: &lt;reason&gt; &lt;stack trace&gt;（Native method）</span><br></pre></td></tr></table></figure>
<p>原因：同样是本地方法内存分配失败，只不过是JNI或者本地方法或者Java虚拟机发现</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;所有的Java开发人员可能会遇到这样的困惑？我该为堆内存设置多大空间呢？OutOfMemoryError的异常到底涉及到运行时数据的哪块区域？该怎么解决呢？其实如果你经常解决服务器性能问题，那么这些问题就会变的非常常见，了解JVM内存也是为了服务器出现性能问题的时候可以快速
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>jvm(1):java类的加载机制</title>
    <link href="https://faithlove.github.io/2017/10/25/jvm-1-java%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"/>
    <id>https://faithlove.github.io/2017/10/25/jvm-1-java类的加载机制/</id>
    <published>2017-10-25T13:47:40.000Z</published>
    <updated>2018-08-08T10:29:10.841Z</updated>
    
    <content type="html"><![CDATA[<p>类加载机制的奥妙。</p>
<h2 id="1、什么是类的加载"><a href="#1、什么是类的加载" class="headerlink" title="1、什么是类的加载"></a>1、什么是类的加载</h2><p>类的加载指的是将类的.class文件中的二进制数据读入到内存中，将其放在运行时数据区的方法区内，然后在堆区创建一个<code>java.lang.Class</code>对象，用来封装类在方法区内的数据结构。类的加载的最终产品是位于堆区中的<code>Class</code>对象，<code>Class</code>对象封装了类在方法区内的数据结构，并且向Java程序员提供了访问方法区内的数据结构的接口。</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/jvm-1.png" alt=""></p>
<p>类加载器并不需要等到某个类被“首次主动使用”时再加载它，JVM规范允许类加载器在预料某个类将要被使用时就预先加载它，如果在预先加载的过程中遇到了.class文件缺失或存在错误，类加载器必须在程序首次主动使用该类时才报告错误（LinkageError错误）如果这个类一直没有被程序主动使用，那么类加载器就不会报告错误</p>
<p><strong>加载.class文件的方式</strong></p>
<ul>
<li>从本地系统中直接加载  </li>
<li>通过网络下载.class文件  </li>
<li>从zip，jar等归档文件中加载.class文件  </li>
<li>从专有数据库中提取.class文件  </li>
<li>将Java源文件动态编译为.class文件  </li>
</ul>
<h2 id="2、类的生命周期"><a href="#2、类的生命周期" class="headerlink" title="2、类的生命周期"></a>2、类的生命周期</h2><p><img src="https://faithlove.github.io/pic/2017/jvm/class.png" alt=""></p>
<p>其中类加载的过程包括了加载、验证、准备、解析、初始化五个阶段。在这五个阶段中，加载、验证、准备和初始化这四个阶段发生的顺序是确定的，而解析阶段则不一定，它在某些情况下可以在初始化阶段之后开始，这是为了支持Java语言的运行时绑定（也成为动态绑定或晚期绑定）。另外注意这里的几个阶段是按顺序开始，而不是按顺序进行或完成，因为这些阶段通常都是互相交叉地混合进行的，通常在一个阶段执行的过程中调用或激活另一个阶段。</p>
<h3 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h3><p>查找并加载类的二进制数据加载时类加载过程的第一个阶段，在加载阶段，虚拟机需要完成以下三件事情：</p>
<ul>
<li>通过一个类的全限定名来获取其定义的二进制字节流。  </li>
<li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。  </li>
<li>在Java堆中生成一个代表这个类的<code>java.lang.Class</code>对象，作为对方法区中这些数据的访问入口。</li>
</ul>
<p>相对于类加载的其他阶段而言，加载阶段（准确地说，是加载阶段获取类的二进制字节流的动作）是可控性最强的阶段，因为开发人员既可以使用系统提供的类加载器来完成加载，也可以自定义自己的类加载器来完成加载。</p>
<p>加载阶段完成后，虚拟机外部的二进制字节流就按照虚拟机所需的格式存储在方法区之中，而且在Java堆中也创建一个<code>java.lang.Class</code>类的对象，这样便可以通过该对象访问方法区中的这些数据。</p>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p><strong>验证：确保被加载的类的正确性</strong></p>
<p>验证是连接阶段的第一步，这一阶段的目的是为了确保Class文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。验证阶段大致会完成4个阶段的检验动作：</p>
<ul>
<li><strong>文件格式验证</strong>：验证字节流是否符合Class文件格式的规范；例如：是否以<code>0xCAFEBABE</code>开头、主次版本号是否在当前虚拟机的处理范围之内、常量池中的常量是否有不被支持的类型。  </li>
<li><strong>元数据验证</strong>：对字节码描述的信息进行语义分析（注意：对比javac编译阶段的语义分析），以保证其描述的信息符合Java语言规范的要求；例如：这个类是否有父类，除了<code>java.lang.Object</code>之外。  </li>
<li><strong>字节码验证</strong>：通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。  </li>
<li><strong>符号引用验证</strong>：确保解析动作能正确执行。  </li>
</ul>
<p>验证阶段是非常重要的，但不是必须的，它对程序运行期没有影响，如果所引用的类经过反复验证，那么可以考虑采用<code>-Xverifynone</code>参数来关闭大部分的类验证措施，以缩短虚拟机类加载的时间。</p>
<p><strong>准备：为类的<code>静态变量分</code>配内存，并将其初始化为默认值</strong></p>
<p>准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些内存都将在方法区中分配。对于该阶段有以下几点需要注意：</p>
<ul>
<li>1、这时候进行内存分配的仅包括类变量（static），而不包括实例变量，实例变量会在对象实例化时随着对象一块分配在Java堆中。  </li>
<li>2、这里所设置的初始值通常情况下是数据类型默认的零值（如0、0L、null、false等），而不是被在Java代码中被显式地赋予的值。</li>
</ul>
<p>假设一个类变量的定义为：<code>public static int value = 3</code>；</p>
<p>那么变量value在准备阶段过后的初始值为0，而不是3，因为这时候尚未开始执行任何Java方法，而把value赋值为3的<code>public static</code>指令是在程序编译后，存放于类构造器<code>&lt;clinit&gt;（）</code>方法之中的，所以把value赋值为3的动作将在初始化阶段才会执行。</p>
<blockquote>
<p>这里还需要注意如下几点：  </p>
<ul>
<li>对基本数据类型来说，对于类变量（static）和全局变量，如果不显式地对其赋值而直接使用，则系统会为其赋予默认的零值，而对于局部变量来说，在使用前必须显式地为其赋值，否则编译时不通过。  </li>
<li>对于同时被static和final修饰的常量，必须在声明的时候就为其显式地赋值，否则编译时不通过；而只被final修饰的常量则既可以在声明时显式地为其赋值，也可以在类初始化时显式地为其赋值，总之，在使用前必须为其显式地赋值，系统不会为其赋予默认零值。  </li>
<li>对于引用数据类型reference来说，如数组引用、对象引用等，如果没有对其进行显式地赋值而直接使用，系统都会为其赋予默认的零值，即null。  </li>
<li>如果在数组初始化时没有对数组中的各元素赋值，那么其中的元素将根据对应的数据类型而被赋予默认的零值。</li>
</ul>
</blockquote>
<ul>
<li>3、如果类字段的字段属性表中存在<code>ConstantValue</code>属性，即同时被final和static修饰，那么在准备阶段变量value就会被初始化为ConstValue属性所指定的值。</li>
</ul>
<p>假设上面的类变量value被定义为： <code>public static final int value = 3</code>；</p>
<p>编译时Javac将会为value生成ConstantValue属性，在准备阶段虚拟机就会根据<code>ConstantValue</code>的设置将value赋值为3。我们可以理解为static final常量在编译期就将其结果放入了调用它的类的常量池中</p>
<p><strong>解析：把类中的符号引用转换为直接引用</strong></p>
<p>解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符7类符号引用进行。<em>符号引用</em>就是一组符号来描述目标，可以是任何字面量。</p>
<p><em>直接引用</em>就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。</p>
<p><strong>初始化</strong></p>
<p>初始化，为类的静态变量赋予正确的初始值，JVM负责对类进行初始化，主要对类变量进行初始化。在Java中对类变量进行初始值设定有两种方式：</p>
<ul>
<li>①声明类变量是指定初始值</li>
<li>②使用静态代码块为类变量指定初始值</li>
</ul>
<p>JVM初始化步骤</p>
<ul>
<li>1、假如这个类还没有被加载和连接，则程序先加载并连接该类  </li>
<li>2、假如该类的直接父类还没有被初始化，则先初始化其直接父类  </li>
<li>3、假如类中有初始化语句，则系统依次执行这些初始化语句  </li>
</ul>
<p>类初始化时机：只有当对类的主动使用的时候才会导致类的初始化，类的主动使用包括以下六种：</p>
<ul>
<li>创建类的实例，也就是new的方式  </li>
<li>访问某个类或接口的静态变量，或者对该静态变量赋值  </li>
<li>调用类的静态方法  </li>
<li>反射（如<code>Class.forName(“com.shengsiyuan.Test”)</code>）  </li>
<li>初始化某个类的子类，则其父类也会被初始化  </li>
<li>Java虚拟机启动时被标明为启动类的类（<code>Java Test</code>），直接使用<code>java.exe</code>命令来运行某个主类  </li>
</ul>
<p><strong>结束生命周期</strong></p>
<p>在如下几种情况下，Java虚拟机将结束生命周期</p>
<ul>
<li>执行了<code>System.exit()</code>方法  </li>
<li>程序正常执行结束  </li>
<li>程序在执行过程中遇到了异常或错误而异常终止  </li>
<li>由于操作系统出现错误而导致Java虚拟机进程终止  </li>
</ul>
<h2 id="3、类加载器"><a href="#3、类加载器" class="headerlink" title="3、类加载器"></a>3、类加载器</h2><p>寻找类加载器，先来一个小例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.neo.classloader;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ClassLoader loader = Thread.currentThread().getContextClassLoader();</span><br><span class="line">        System.out.println(loader);</span><br><span class="line">        System.out.println(loader.getParent());</span><br><span class="line">        System.out.println(loader.getParent().getParent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行后，输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sun.misc.Launcher$AppClassLoader@64fef26a</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@1ddd40f3</span><br><span class="line">null</span><br></pre></td></tr></table></figure>
<p>从上面的结果可以看出，并没有获取到<code>ExtClassLoader</code>的父Loader，原因是<code>Bootstrap Loader</code>（引导类加载器）是用C语言实现的，找不到一个确定的返回父Loader的方式，于是就返回null。</p>
<p>这几种类加载器的层次关系如下图所示：</p>
<p><img src="https://faithlove.github.io/pic/2017/jvm/calssloader.png" alt=""></p>
<blockquote>
<p>注意：这里父类加载器并不是通过继承关系来实现的，而是采用组合实现的。</p>
</blockquote>
<p>站在Java虚拟机的角度来讲，只存在两种不同的类加载器：<em>启动类加载器</em>：它使用C++实现（这里仅限于Hotspot，也就是JDK1.5之后默认的虚拟机，有很多其他的虚拟机是用Java语言实现的），是虚拟机自身的一部分；所有<em>其它的类加载器</em>：这些类加载器都由Java语言实现，独立于虚拟机之外，并且全部继承自抽象类<code>java.lang.ClassLoader</code>，这些类加载器需要由启动类加载器加载到内存中之后才能去加载其他的类。</p>
<p>站在Java开发人员的角度来看，类加载器可以大致划分为以下三类：  </p>
<p><strong>启动类加载器</strong>：<code>Bootstrap ClassLoader</code>，负责加载存放在<code>JDK\jre\lib</code>(JDK代表JDK的安装目录，下同)下，或被<code>-Xbootclasspath</code>参数指定的路径中的，并且能被虚拟机识别的类库（如rt.jar，所有的java.<em>开头的类均被<code>Bootstrap ClassLoader</code>加载）。启动类加载器是无法被Java程序直接引用的。<br><strong>扩展类加载器</strong>：<code>Extension ClassLoader</code>，该加载器由<code>sun.misc.Launcher$ExtClassLoader</code>实现，它负责加载<code>JDK\jre\lib\ext</code>目录中，或者由<code>java.ext.dirs</code>系统变量指定的路径中的所有类库（如javax.</em>开头的类），开发者可以直接使用扩展类加载器。<br><strong>应用程序类加载器</strong>：<code>Application ClassLoader</code>，该类加载器由<code>sun.misc.Launcher$AppClassLoader</code>来实现，它负责加载用户类路径（ClassPath）所指定的类，开发者可以直接使用该类加载器，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。  </p>
<p>应用程序都是由这三种类加载器互相配合进行加载的，如果有必要，我们还可以加入自定义的类加载器。因为JVM自带的ClassLoader只是懂得从本地文件系统加载标准的java class文件，因此如果编写了自己的ClassLoader，便可以做到如下几点：</p>
<ul>
<li>1、在执行非置信代码之前，自动验证数字签名。</li>
<li>2、动态地创建符合用户特定需要的定制化构建类。</li>
<li>3、从特定的场所取得java class，例如数据库中和网络中。</li>
</ul>
<p><strong>JVM类加载机制</strong></p>
<ul>
<li><strong>全盘负责</strong>，当一个类加载器负责加载某个Class时，该Class所依赖的和引用的其他Class也将由该类加载器负责载入，除非显示使用另外一个类加载器来载入  </li>
<li><strong>父类委托</strong>，先让父类加载器试图加载该类，只有在父类加载器无法加载该类时才尝试从自己的类路径中加载该类  </li>
<li><strong>缓存机制</strong>，缓存机制将会保证所有加载过的Class都会被缓存，当程序中需要使用某个Class时，类加载器先从缓存区寻找该Class，只有缓存区不存在，系统才会读取该类对应的二进制数据，并将其转换成Class对象，存入缓存区。这就是为什么修改了Class后，必须重启JVM，程序的修改才会生效</li>
</ul>
<h2 id="4、类的加载"><a href="#4、类的加载" class="headerlink" title="4、类的加载"></a>4、类的加载</h2><p>类加载有三种方式：  </p>
<ul>
<li>1、命令行启动应用时候由JVM初始化加载  </li>
<li>2、通过Class.forName()方法动态加载  </li>
<li>3、通过ClassLoader.loadClass()方法动态加载  </li>
</ul>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.neo.classloader;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">loaderTest</span> </span>&#123; </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123; </span><br><span class="line">                ClassLoader loader = HelloWorld.class.getClassLoader(); </span><br><span class="line">                System.out.println(loader); </span><br><span class="line">                <span class="comment">//使用ClassLoader.loadClass()来加载类，不会执行初始化块 </span></span><br><span class="line">                loader.loadClass(<span class="string">"Test2"</span>); </span><br><span class="line">                <span class="comment">//使用Class.forName()来加载类，默认会执行初始化块 </span></span><br><span class="line">                <span class="comment">//Class.forName("Test2"); </span></span><br><span class="line">                <span class="comment">//使用Class.forName()来加载类，并指定ClassLoader，初始化时不执行静态块 </span></span><br><span class="line">                <span class="comment">//Class.forName("Test2", false, loader); </span></span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>demo类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123; </span><br><span class="line">        <span class="keyword">static</span> &#123; </span><br><span class="line">                System.out.println(<span class="string">"静态初始化块执行了！"</span>); </span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别切换加载方式，会有不同的输出结果。</p>
<p><strong>Class.forName()和ClassLoader.loadClass()区别</strong></p>
<ul>
<li><code>Class.forName()</code>：将类的.class文件加载到jvm中之外，还会对类进行解释，执行类中的static块；  </li>
<li><code>ClassLoader.loadClass()</code>：只干一件事情，就是将.class文件加载到jvm中，不会执行static中的内容,只有在newInstance才会去执行static块。  </li>
<li><code>Class.forName(name, initialize, loader)</code>带参函数也可控制是否加载static块。并且只有调用了newInstance()方法采用调用构造函数，创建类的对象 。</li>
</ul>
<h2 id="5、双亲委派模型"><a href="#5、双亲委派模型" class="headerlink" title="5、双亲委派模型"></a>5、双亲委派模型</h2><p>双亲委派模型的工作流程是：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把请求委托给父加载器去完成，依次向上，因此，所有的类加载请求最终都应该被传递到顶层的启动类加载器中，只有当父加载器在它的搜索范围中没有找到所需的类时，即无法完成该加载，子加载器才会尝试自己去加载该类。</p>
<p>双亲委派机制:</p>
<ul>
<li>1、当<code>AppClassLoader</code>加载一个class时，它首先不会自己去尝试加载这个类，而是把类加载请求委派给父类加载器<code>ExtClassLoader</code>去完成。  </li>
<li>2、当<code>ExtClassLoader</code>加载一个class时，它首先也不会自己去尝试加载这个类，而是把类加载请求委派给<br><code>BootStrapClassLoader</code>去完成。  </li>
<li>3、如果<code>BootStrapClassLoader</code>加载失败（例如在<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">- 4、若ExtClassLoader也加载失败，则会使用`AppClassLoader`来加载，如果`AppClassLoader`也加载失败，则会报出异常`ClassNotFoundException`。  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ClassLoader源码分析：</span><br><span class="line"></span><br><span class="line">``` java</span><br><span class="line">public Class&lt;?&gt; loadClass(String name)throws ClassNotFoundException &#123;</span><br><span class="line">        return loadClass(name, false);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve)throws ClassNotFoundException &#123;</span><br><span class="line">        // 首先判断该类型是否已经被加载</span><br><span class="line">        Class c = findLoadedClass(name);</span><br><span class="line">        if (c == null) &#123;</span><br><span class="line">            //如果没有被加载，就委托给父类加载或者委派给启动类加载器加载</span><br><span class="line">            try &#123;</span><br><span class="line">                if (parent != null) &#123;</span><br><span class="line">                     //如果存在父类加载器，就委派给父类加载器加载</span><br><span class="line">                    c = parent.loadClass(name, false);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                //如果不存在父类加载器，就检查是否是由启动类加载器加载的类，通过调用本地方法native Class findBootstrapClass(String name)</span><br><span class="line">                    c = findBootstrapClass0(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">             // 如果父类加载器和启动类加载器都不能完成加载任务，才调用自身的加载功能</span><br><span class="line">                c = findClass(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>双亲委派模型意义：</p>
<ul>
<li>系统类防止内存中出现多份同样的字节码  </li>
<li>保证Java程序安全稳定运行</li>
</ul>
<h2 id="6、自定义类加载器"><a href="#6、自定义类加载器" class="headerlink" title="6、自定义类加载器"></a>6、自定义类加载器</h2><p>通常情况下，我们都是直接使用系统类加载器。但是，有的时候，我们也需要自定义类加载器。比如应用是通过网络来传输 Java类的字节码，为保证安全性，这些字节码经过了加密处理，这时系统类加载器就无法对其进行加载，这样则需要自定义类加载器来实现。自定义类加载器一般都是继承自<code>ClassLoader</code>类，从上面对<code>loadClass</code>方法来分析来看，我们只需要重写 findClass 方法即可。下面我们通过一个示例来演示自定义类加载器的流程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.neo.classloader;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] classData = loadClassData(name);</span><br><span class="line">        <span class="keyword">if</span> (classData == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ClassNotFoundException();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] loadClassData(String className) &#123;</span><br><span class="line">        String fileName = root + File.separatorChar</span><br><span class="line">                + className.replace(<span class="string">'.'</span>, File.separatorChar) + <span class="string">".class"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream ins = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">            ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            <span class="keyword">int</span> bufferSize = <span class="number">1024</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[bufferSize];</span><br><span class="line">            <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> ((length = ins.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                baos.write(buffer, <span class="number">0</span>, length);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoot</span><span class="params">(String root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.root = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyClassLoader classLoader = <span class="keyword">new</span> MyClassLoader();</span><br><span class="line">        classLoader.setRoot(<span class="string">"E:\\temp"</span>);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; testClass = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            testClass = classLoader.loadClass(<span class="string">"com.neo.classloader.Test2"</span>);</span><br><span class="line">            Object object = testClass.newInstance();</span><br><span class="line">            System.out.println(object.getClass().getClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义类加载器的核心在于对字节码文件的获取，如果是加密的字节码则需要在该类中对文件进行解密。由于这里只是演示，我并未对class文件进行加密，因此没有解密的过程。这里有几点需要注意：</p>
<ul>
<li>1、这里传递的文件名需要是类的全限定性名称，即<code>com.paddx.test.classloading.Test</code>格式的，因为 defineClass 方法是按这种格式进行处理的。  </li>
<li>2、最好不要重写loadClass方法，因为这样容易破坏双亲委托模式。  </li>
<li>3、这类Test 类本身可以被 <code>AppClassLoader</code>类加载，因此我们不能把<code>com/paddx/test/classloading/Test.class</code>放在类路径下。否则，由于双亲委托机制的存在，会直接导致该类由<code>AppClassLoader</code>加载，而不会通过我们自定义类加载器来加载。</li>
</ul>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a href="http://blog.csdn.net/ns_code/article/details/17881581" target="_blank" rel="noopener">【深入Java虚拟机】之四：类加载机制</a><br><a href="https://segmentfault.com/a/1190000005608960" target="_blank" rel="noopener">JAVA类加载机制全解析</a><br><a href="http://www.importnew.com/18548.html" target="_blank" rel="noopener">Java虚拟机类加载机制</a><br><a href="http://zyjustin9.iteye.com/blog/2092131" target="_blank" rel="noopener">深入研究Java类加载机制</a><br><a href="http://www.codeceo.com/article/java-class-loader-learn.html" target="_blank" rel="noopener">Java 类加载机制详解</a>  </p>
<p>全文转载自：<a href="http://www.ityouknow.com/jvm/2017/08/19/class-loading-principle.html" target="_blank" rel="noopener">http://www.ityouknow.com/jvm/2017/08/19/class-loading-principle.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;类加载机制的奥妙。&lt;/p&gt;
&lt;h2 id=&quot;1、什么是类的加载&quot;&gt;&lt;a href=&quot;#1、什么是类的加载&quot; class=&quot;headerlink&quot; title=&quot;1、什么是类的加载&quot;&gt;&lt;/a&gt;1、什么是类的加载&lt;/h2&gt;&lt;p&gt;类的加载指的是将类的.class文件中的二进制数据
    
    </summary>
    
      <category term="JVM" scheme="https://faithlove.github.io/categories/JVM/"/>
    
    
      <category term="JVM" scheme="https://faithlove.github.io/tags/JVM/"/>
    
  </entry>
  
</feed>
